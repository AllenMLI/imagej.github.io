[[Image:inilogo.png|right|320px]]
{{ComponentStats:net.imagej:MTV_Tracker}}
== Description ==
The Microtubule Tracker is a tool to track and analyze the Microtubules that grow and shrink as filaments. It was developed for experiments done in-vitro with a TIRF microscope with seeded Microtubules which grow and shrink over time. 

The visualized data comprises of a 2D seed image from which the Microtubules grow followed by a time-lapse sequence of dynamically growing seed ends. The file format required for the tracker is TIF.

The images can be taken in single or double channel. In the single channel imaging the seed is always present and the dynamic ends are tracked over time. In the double channel imaging the seed is present only in the first image and is missing in the succeeding images.

For running the tracker in the single channel select, {{bc | Plugins | MTV Tracker | Microtubule Velocity Tracker (Single Channel)}}, for double channel images select the Double Channel option instead. In the description that follows we assume that the user is working with double channel images, without the loss of generality as the same is true for the single channel image analysis as well.

The Microtubule tracker comes as a tri-modular tool. The first module is live tracking of the growing seed ends, the second module requires the track files generated by the first module to obtain the growth, shrinkage rates and catastrophe and rescue frequencies. A subset of the second module compute statistics such as the length and lifetime distribution when analyzing track files in batch mode.

== Starting the Tracker ==
The opening screen of the program is the file chooser where the user chooses the mode in which to run the program in and upload the image files to perform the tracking with. There are three modes in which the program can be run 1) Simple Mode, 2) Advanced Mode, 3) Batch Mode. The Simple mode gives user with some default settings with few choices to make to obtain the tracks. The Advanced mode gives user the full freedom with respect to their choices to obtain the tracks. The image intensity is normalized between 0 and 1 at this stage.

[[Image:FileChooser.png|400px]]

For the first time users the program has to be run in Simple or Advanced Mode before the parameters can be saved for a batch mode run. The users have to upload the image file of the time-lapse experiment and optionally a pre-processed image file. If the pre-processed image file is not uploaded this step will be carried out by the tracker internally. Pre-processed image is very crucial as the first part of the tracker is object recognition where it locates the Microtubules in the image. Such an object recognition works perfectly only on the pre-processed image. The recommended preprocessing for the tracker is flat-field correction followed by Median filter. 

The user also has to enter the SigmaX and SigmaY of the Point-Spread-Function (PSF) of the microscope used to image the Microtubules in the file chooser panel. 

After running the program once and being satisfied with the parameter selection the user is offered to save the parameters for batch run. If the user clicks the button the program is closed and the parameters are saved in the IJ prefs file, please save your work before clicking this button as the parameters are only saved after the program is closed and clicking of this button triggers close of the program with all the windows open. 

Now the user can run in Batch mode with saved parameters on a directory of Microtubule time-lapse images. Batch mode is run in parallel and the user gets a visual feedback of the progress of the tracker for each image file currently being operated upon.

=== Pre-Processing ===

If the user intends to upload their own preprocessed image it is recommended to do a flat field correction. To do this correction in Fiji, open your image and duplicate it by selecting {{bc | Image | Duplicate}} from the Fiji menu and click Duplicate Stack. On the duplicated image apply a Gaussian blur of radius about a tenth of the size of the image, to do so click {{bc | Process | Filters | Gaussian Blur}} and enter the radius of the blur, for example if the image is 512 by 512 pixels the blur radius would be 50. 

After this the resulting blurred image has to be subtracted from the original image, to do so click  {{bc | Process | Image Calculator}} In that menu you have to choose Image1, which is the original image and image2, which is the resulting image after applying the Gaussian Blur in the previous step. The operation to be chosen in the menu is "Subtract" and check the box "Create new window". This operation opens a new stack of flat field corrected image. In order to enhance the edges of the Microtubules we also apply a Median filter, to do so click {{bc | Process | Filters | Median FIlter}} and enter the radius of 1 or 2 pixels. Now you have created the pre-processed image to be uploaded into the tracker. Alternatively the tracker performs these operations internally if you do not upload such a pre-processed image.

=== Simple Mode ===

This mode should be used by the user if the Microtubules are not too densely packed in the image. The tracker breaks down the operation of tracking the dynamic Microtubule ends is broken into a series of short steps the user has to take. The first step is to select an output filename for their tracks and choose the directory to store these tracks in. The track files are written in TXT format in the current working directory and by default it has the name of the image that is currently being analyzed.

Tracking requires an object recognition method to locate the object of interest in the image, in our case the object of interest are the Microtubules and the default algorithms to locate them on the image is Maximally Stable Extremal Regions (MSER) [http://www.sciencedirect.com/science/article/pii/S0262885604000435]. MSER is computed on a unsignedByteType image (Intensity levels between 0-255 ) and the following table explains the MSER parameters to be chosen in this mode.

{| border="1" style="border-collapse:collapse;"
| style="padding: 5px;" | Grey Level Separation
| style="padding: 5px;" | Difference between succeeding thresholds applied to make the component tree.
|-
| style="padding: 5px;" | Unstability Score
| style="padding: 5px;" | A normalized measure of the lifetime of each component.
|-
| style="padding: 5px;" | Min #of pixels
| style="padding: 5px;" | Minimum number of pixels contained in a stable region.
|}

MSER applies successive thresholds and builds a component tree as shown in the Figure [https://link.springer.com/chapter/10.1007/978-3-540-88688-4_14]. If the grey level separation is small (0 - 20) more stable regions will be found, if it is high then only few regions will be found. The lifetime of each component is measured by the unstability score and is normalized between 0 and 1. For values close to 1 many regions will be deemed stable and for values close to 0 only very few extremely stable regions will be found. MSER detected regions as shown as red ellipses. The line along which each of the Microtubules lie is assumed to be the semi-major axis of the MSER ellipse.
Optimization using Gaussian line models is done in order to localize the end points of the seeds.

[[Image:GreyLevel.png|400px]]   

The nodes of the tree are vertical boxes and vertical extent of the box shows the grey-level life span of each component.

The user can change the MSER parameters using the adjustable sliders and see the effect of their selection on the image. Once the Microtubules are recognized by the algorithm click on "Find endpoints" to obtain the end-points of the Microtubules on the image with sub-pixel accuracy. The found end points will be shown as green circles on the image.

[[Image:SimpleStep1.png|350px]]
[[Image:Mserdet.png|350px]]
[[Image:Mserseeddet.png|350px]]

The program gets all of the seed ends correctly except the seeds that overlap and appear to be inseparable, as shown in the example image above.

=== Advanced Mode ===
In this mode apart from making result filename and directory selection the user also has several options of choosing their method of object recognition and seed end determination. These methods include Distance transform based watershedding followed by Hough Transform to determine the line parameters along which the seeds lie, MSER detection and a combination of MSER and Hough Transform to determine the above mentioned line parameters. 

[[Image:AdvancedMode1.png|500px]]

In order to enhance the Microtubule image pixels a Canny edge detection followed by a mean filter with the radius determined by the SigmaX and SigmaY of the PSF of the microscope is used. The radius factor is a factor multiplying that radius and is user adjustable, in the simple mode this factor is 1 and is adjustable here. Increasing this parameter causes the MSER elliptical region to increase in size while decreasing it has the reverse effect.

Advanced mode comes with three object recognition algorithms namely MSER, Watershed followed by line-Hough transform and MSER followed by line-Hough transform. 
Watershed based object recognition is a method of choice for dense seed images, watershedding allows demarcation of close lying seeds, something that is not possible with MSER. Once the regions in which the Microtubules lie is determined, Line based Hough transform is performed to determine the line parameters of the Microtubules. This is needed to make an initial guess for the optimizer which then fits a Gaussian line model to localize the end points of the Microtubules.
The drawback of watershed based method is the speed of performing Hough transform in each watershed label followed by optimization using Gaussian Line models which is immensely faster in MSER based methods, which however should be the method of choice when the Microtubules are sparsely distributed in the image. 

If the user selects watershed followed by Hough transform the following panel would be displayed:

[[Image:AdvancedMode2Hough.png|500px]] 

Adjustable sliders here include:

A) Threshold value to be used to create a binary image to perform watershedding. 
B) Size of pixel Hough space in relation to the size of pixel in image space. Value of 1 implies same size as in pixel space a value less than 1 implies a bigger Hough space making the detection more accurate, however too small values may not lead to an increase in accuracy, a value between 0.5 and 1 is recommended.

Also after the user makes a selection for the threshold value to be used, they can display the Bitimage and also the watershed image to see if the image was not over or under segmented. To display the watershed image properly the user may have to adjust the brightness and contrast of that image. To do so click {{bc | Image | Adjust | Brightness/Contrast}} and click Auto. If the image is properly segmented the watershed labels displayed should correspond roughly to the number of the Microtubules in the image, after this the user can click on find endpoint to localize Microtubule endpoints.

If the user selects MSER method the following panel is displayed:

[[Image:AdvancedMode2mser.png|500px]]

MSER based object recognition are fast methods to locate and localize the seed ends, but should only be used for sparsely populated Microtubule images as mentioned before. The Microtubules lie along the semi-major axis of the MSER ellipse. Following which the optimization using the Gaussian line models is done to localize the seed ends.

It may happen that some of the Microtubules do not lie along the major axis of the ellipse, in which case the user has to select the method of MSERwHOUGH, in this method Hough transform is performed inside each of the MSER ellipses to determine the required axis, followed by optimization using the Gaussian line models to localize seed ends. In this selection the following panel appears with the user having to select a combination of parameters from above two methods.

[[Image:AdvancedMode2MH.png|500px]]

==  Tracking the growing ends  ==

After the user has obtained the seed ends, the next step is to track the growth emanating from the ends. At this stage the user can make a choice of deselecting some ends they do not want to be tracked or mark the random nucleated ends which they want to be tracked. To do so the user should first ascertain the time-point in the image they want to navigate to make such a selection, it can be the immediate time-point after the seed image or any other. This step is however optional, if the user does not want to make such a selection they can simply skip it and click on confirm seed ends in the panel. In the simple and advanced mode the panel for making this selection appears as:

[[Image:SimpleMode2.png|500px]] [[Image:AdvancedMode3.png|500px]]

A) For the user to select or deselect seed ends from which the growth has to be tracked (optional) in simple and advanced mode.

B) In the simple mode the user can select the start and the end time over which the tracking has to be performed, by default the Microtubule growth is tracked from the first image in the dynamic channel till the last one. This option appears in the advanced mode in the next panel.

C) The user can either do only MSER segmentation at each time point or has the option of doing it after doing a Watershed based segmentation to demarcate close lying Microtubules. In the simple mode only MSER segmentation is performed.

In the example images below we show the implication of the user deselecting some seed ends from which they do not wish to track the growth. By doing a left click the green ends are deselected and become pink, if some end was deselected by mistake a shift+left click can reselect it. If the user wishes to make a selection that is not a detection by the program an alt+shift+left click would mark a user selected seed in orange. After the user confirms the selection MSER ellipses around the seeds to be tracked will always be marked yellow and other stable regions will be marked red.

[[Image:Deselect.png|500px]] [[Image:Confirm.png|500px]]
