[[Image:MTracker_NewLogo-04.png|right|250px]]
{{ComponentStats:net.imagej:MTrack}}

MTrack is a tool, which detects, tracks, and measures the behavior of fluorescently labeled microtubules imaged by TIRF (total internal reflection fluorescence) microscopy. In such an in vitro reconstitution approach, stabilized, non-dynamic microtubule seeds serve as nucleation points for dynamically growing microtubules. 

MTrack is a bi-modular tool. The first module detects microtubule seeds and tracks the growing microtubule ends and creates trajectories. The second module uses these trajectories to fit models of dynamic behavior (polymerization and depolymerization velocities, catastrophe and rescue frequencies) and is able to compute population statistics such as length distributions.
 
 To make yourself familiar with MTrack, please consult the [[MicrotubuleTracker|Example]] section below.


Logo designed by Tobias Kletter.

== Installation ==

# Click ''Help ▶ Update....''
# Click the ''Manage update sites'' button.
# Select the ''MTrack'' update site in the list.
# Click Close and then click ''Apply changes''.
# Restart Fiji.
# Launch the plugin with ''Plugins ▶ MTrack''.

== Usage ==

=== Module 1 - Microtubule Detection & Tracking===
A typical dataset consists of a single two-dimensional (2d) image of the non-dynamic microtubule seeds followed by a 2d time-lapse of the dynamically growing microtubules. The file format
can be any format readable by Fiji/Bioformats (.tif, .nd2, … ). To run the tracker select {{bc|Plugins|MTrack|Tracking}}

The welcome panel will open.

[[Image:WelcomeA.png|500px]][[Image:WelcomeB.png|500px]]

==== Choose Mode====
For a first analysis of your data, we suggest using the simple mode, in which we have pre-selected a number of parameters. In case you are unsatisfied with the outcome of the tracking you can use the
[[advanced mode(MTrack)]] to fine-tune settings. When analyzing more than one movie, you can select [[batch mode(MTrack)]] and run many movies simultaneously. However, before running the program in batch mode, you
have to at least run the program once in single or advanced mode to select and save the required parameters. The following intro is on simple mode.

==== Select Movie====

Next, the user selects the movie. The movie to be uploaded is the original movie coming out of the microscope. Object recognition of Microtubules requires a preprocessed movie  and such a preprocessed movie is only used for locating where the microtubules are in the image and not for end-points detection, which is always performed on the original image. In simple mode the program does a pseudo flat field correction by default and the user only has to input the microscope parameters and go next to start the tracking module.

In the advanced mode the user has the option to either perform a flat-field correction and apply a median filter of chosen radius or user can also upload their own preprocessed movie.
(Read more about [[Preprocessing(MTrack)]]).
For the movie type choose one of the three supported options:
* Two channel image as hyper stack (both channels in one image)
* Concatenated seed image followed by time-lapse images
* Single channel time-lapse images
Please choose an output file name and directory. The trajectory files will be written as .txt files. By default trajectories will be saved in the current working directory with the name of the movie.

==== Microscope Parameters====
The program automatically reads the metadata shown as pixel size (micrometer in x and y) and frame rate (in seconds). If the metadata could not be read properly, the user can change the values. In addition, the user is asked to enter the Sigma(X) and Sigma(Y) of the Point-Spread-Function (PSF) of the microscope in pixel units see here for [[more explanation]]. For your convenience, our software comes with an inbuilt PSF analyzer tool, which
can optionally determine the PSF of your microscope from bead images by fitting a Gaussian function.

==== Preprocessing====
As mentioned before, for recognizing microtubules in the image, preprocessing is essential, in advanced mode we provide the user with an option to do pseudo-flat field correction and to apply a median filter of certain radius (e.g. r=2 pixels). Optionally user can load their own preprocessed movie.
Please note that this blurring will not be used during subsequent tracking. In simple mode only pseudo-flat field correction is done.

Press Next to proceed, and 3 screens and one panel will open. They show the original movie, the preprocessed movie, and the “active image”, which representing the seeds and is typically the first frame of the movie. Every successfully recognized seed will be marked with a red ellipse.

==== MSER parameters====
The default algorithm to identify the seeds as objects is called Maximally Stable Extremal Regions (MSER) <ref>  
Robust wide-baseline stereo from maximally stable extremal regions, J Matas, O Chum, M Urban, T Pajdla Image and vision computing 22 (10), 761-767.  </ref>.Read more about [[MSER parameters]]. If seeds are not recognized or two very close seeds are recognized as one, the user can change the MSER parameters using the adjustable sliders. The effect will be displayed live on the “active image”. Once most seeds are correctly recognized as objects, click “Find endpoints” to detect the ends of each seed with sub-pixel accuracy. 

The end-points will be displayed as green circles and a “Next” button appears on the panel which allows the user to flip to the next panel.

[[Image:MserSimple.png|300px]]

==== Options====

In this panel the user will see some options before starting the tracking. They are described in this section

[[Image:Options.png|300px]]

Deselect and select ends

Before starting the actual tracking of the dynamically growing microtubules, the program will give you several options. Before choosing endpoints to remove or add you check all frames of the movie by moving the slider in the “Deselect and select ends” dialog. Select or deselect ends. If an end was wrongly recognized or two points are too close to each other you can deselect an end by left clicking on it in the image (will appear as pink circle instead of green). The program will remember and allow to re-select this end by clicking left click again near to the end point of interest (the pink circle becomes green again). In case an end has not been recognized or a randomly nucleated end has to be selected, use Shift + left click to select a user defined end (orange circle will mark the end). Making a left click near the user defined seed end deselects it and marks it as red, the user can make as many clicks to select the ends they want to. Read more on [[microtubule polarity and (+) end vs. (-) end tracking]].


Select time

The tracking is performed from the first frame till the end frame by default, if the user however wishes to alter the start and the end frame of tracking they can do so here. The tracking will then be performed from the user chosen start frame till the user chosen end frame.

Click on confirm seed ends and track button to start the tracking. The program displays yellow ellipses showing the  marked seeds that are being tracked, red ellipses mark seeds, which won”t be tracked. Green circles mark ends to be tracked. Orange circles mark user defined ends and will be tracked.
The actual tracking is  performed “live” (progress bar will show the current time in relation to the end time-point). A crosshair will show the current position of the found end on each marked microtubule end. A faint grey line is also drawn along the detected track enabling the user to ensure the correctness of the tracks obtained by the program.

At the end of tracking a Log file will appear with the message to inform the user about the end of tracking and about the text files written with the track information.  The results are also displayed as two movies, the “Track ID” movie, which can be used to link the trajectories to individual microtubules and an “Overlay movie”, in which the user can recapitulate the tracking. The trajectory of each end is individually saved as .txt file and numbered according to the track ID.

Save parameters

After successful tracking, the user has the option to save the program parameters, so that the movie can be run (again) in batch mode. This choice can also be made without doing the tracking after just making the parameter selection. Clicking on this button triggers the close of the program and saves the program parameters in IJ.log file of FIJI, this close of program is done to ensure that the log file is properly updated by FIJI.



===Module 2- Microtubule dynamics===
Microtubules show a dynamic behavior known as dynamic instability, which is characterized by four parameters (1) polymerization velocity (vp, nm/sec), (2) depolymerization velocity (vd, nm/sec), (3) catastrophe frequency (fcat, sec-1), and (4) rescue frequency (fres, sec-1). Using the trajectories created in Module 1 (The .txt file contains frame number, total length (in px and μm), track ID, x and y position
(pixel and μm) and the length increment from the previous frame (px and micrometer). Module 2 derives these dynamic parameters by fitting models using RANSAC. (Read more on [[MTrack-RANSAC models]]).

If not forwarded by Module 1, Module 2 can be selected by  {{bc|Plugins|MTrack|Rate Analyzer}}

The panel that opens will allow the user to select individual files containing trajectories displayed as length versus time plots on which RANSAC fits a model of microtubule dynamics using
the default parameters. Read more about the [[MTrack-RANSAC parameters]]. If the default parameters work well the rates and averages are displayed in front of the file in the table. If the program notices that two succeeding growth events follow without any catastrophe event that row will be marked red indicating to the user that they need to change the parameters for this file for getting proper Ransac fits. 

After the user has gone through certain files in the table shown in the panel below they can click "compute rates and frequencies" in which case average growth/shrink rates and a count of each growth and shrink event along with catastrophe and rescue frequency for each trajectory is computed and stored in the current directory. Program creates two files labelled "Allrates.txt" and "Allaverages.txt", in the first file it contains the information about the start and end time and rates of each growth and shrink events along with the trajectory filename for easy identification of to which movie does the computation belongs to. In the second file it contains the averaged rate and frequency information of each trajectory analyzed up to then.

Additionally user can also obtain Lifetime and Length distribution for a certain time point or a time-averaged distribution. In the length distribution plot the mean length and standard deviation will also be displayed in the plot after fitting an exponential decay curve to the obtained distribution.

After completing the analysis for one directory of trajectory files the user can again select another directory and all the tracker generated files will be updated in the table. Now the user can repeat the same process as above for analysis of these set of files and continue to compile results for as many directory of files as they wish to.

[[Image:Ransacfirst.png|600px]]
Click here to see some examples of the [[MTrack-Ransac fits]].

== Example ==

An example movie showing several growing/shrinking microtubules is available for download [here]. To perform the analysis of this movie we suggest using the following parameters, listed in order they have to be selected in the GUI:

# Put the example file 'MTrack_Demo.tif' into an empty directory, the results will be stored here
# Run the MicroTubule Tracker
# Select 'Simple Mode', 'Concatenated Seed Image followed by time-lapse images', choose the file, microscope parameters are automatically loaded from file
