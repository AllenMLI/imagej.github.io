<seo metak="sholl,plugin,arbor,neuron,morphometry,dendrite" metad="sholl,plugin,arbor,neuron,morphometry,dendrite" />
<div style="float:right;">
{{Infobox Plugin
| software       = ImageJ/Fiji
| name           = Sholl Analysis
| author         = Tiago Ferreira, Tom Maddock
| maintainer     = [mailto:tiago_dot_ferreira_at_mail_dot_mcgill_dot_ca Tiago Ferreira]
| source         = [https://github.com/tferr/ASA on GitHub]
| filename       = [http://jenkins.imagej.net/job/Stable-Fiji/ws/Fiji.app/plugins/Sholl_Analysis-3.4.1.jar Sholl_Analysis.jar]
| released       = December 2012
| latest version = '''3.4.1''' March 2014 ([https://github.com/tferr/ASA/blob/master/Notes.md#release-notes-for-sholl-analysis Release Notes])
| status         = See [[#Release Notes and Pre-releases|Pre-releases]] and [https://github.com/tferr/ASA/blob/master/Notes.md#development-builds Development Notes]
| category       = [[:Category:Plugins|Plugins]], [[:Category:Analysis|Analysis]]
}}

<!-- Create a short TOC next to main Contents -->
&nbsp;<br /> <br /> <br /> <br /> <br /> <br />
<div style="font-size:175%;border-bottom:1px dotted #ccc;margin-bottom:0.55em;">Quick links</div>

'''Analysis of traced arbors?'''
:Jump to [[#Importing_Profiles_Obtained_Elsewhere|Importing Profiles]]
'''Having Problems?'''
:Jump to [[#FAQ|FAQs]]
'''Non-Fiji User?'''
:Jump to [[#Non-Fiji_users|Installation notes]]
</div>

Automated bitmap Sholl for direct analysis of fluorescent images of neuronal arbors, featuring powerful quantifications  based on curve fitting. Analysis of previously traced arbors is also possible.

== Introduction ==
[[ File:BitmapSholl-CA1mask.png|frame|[[Skeletonize3D|Skeletonized]] Mouse hippocampal CA1 cell <ref name="Gross">TA Ferreira, LL Iacono and CT Gross. Serotonin receptor 1A modulates actin dynamics and restricts dendritic growth in hippocampal neurons. Eur J Neurosci 32(1):18-26, Jul 2010 [http://www.ncbi.nlm.nih.gov/pubmed?term=20561047 PMID: 20561047]</ref> in which apical and basal dendrites have been analyzed separately and color coded according to their Sholl profile. Warmer hues indicate higher number of Intersections (''N''). [[#CriticalRadius|Critical radius]] (''rc'') and [[#MeanValueOfFunction|Mean value]] (''Nav'') are indicated.]]

The Sholl technique<ref name="Sholl">DA Sholl. Dendritic organization in the neurons of the visual and motor cortices of the cat. J Anat, 87(4):387–406, Sep 1953, [http://www.ncbi.nlm.nih.gov/pubmed?term=13117757  PMID: 13117757]</ref> is used to describe neuronal arbors. This plugin performs  Sholl directly on 2D and 3D grayscale images of isolated neurons. Its internal algorithm to collect data is based upon how Sholl analysis is done by hand — it creates a series of concentric ''shells'' (circles or spheres) around the focus of a neuronal arbor, and counts how many times the arbor intersects the sampling shells.
The major advantages of this plugin over other implementations are:
* It does not require previous tracing of the arbor (although analysis can be applied to [[#Importing_Profiles_Obtained_Elsewhere|previously traced arbors]])
* It combines [[#MethodsTable|curve fitting]] with several [[#Sholl Plots|methods]] to automatically retrieve [[#Metrics|quantitative descriptors]] from sampled data, which allows direct statistical comparisons between arbors
* It allows [[#Multiple Samples and Noise Reduction|continuous and repeated sampling]] around user-defined foci
* It allows [[#Batch Processing|batch processing]]

== Usage ==
The plugin requires a binary image or a segmented grayscale image containing a single neuron.

# Segment the neuronal arbor using <span style="border-bottom:1px dotted #ccc;">Image▷ Adjust▷ Threshold...</span>
# Select the center of analysis with the <span style="border-bottom:1px dotted #ccc;">Point Selection Tool</span>. Alternatively, make a straight line (<span style="border-bottom:1px dotted #ccc;">Straight Line Selection Tool</span>) from the focus of the arbor to its most distal point. This will automatically set both the center and [[#EndRadius|Ending radius]].
# Run <span style="border-bottom:1px dotted #ccc;">Analyze▷ Sholl Analysis...</span>, adjusting the default [[#Parameters|Parameters]] in the dialog prompt.
# Problems? Read the  [[#FAQ|FAQs]].

== Parameters ==
Input values take into account the scale information of the image that can be set using the <span style="border-bottom:1px dotted #ccc;">Analyze▷ Set Scale...</span> or <span style="border-bottom:1px dotted #ccc;">Image▷ Properties...</span> The prompt is organized into 5 sections:

==== Definition of Shells ====
* <span id="StartRadius"></span>'''Starting radius''' <sup>&nbsp;</sup>The radius of the smallest sampling circle/sphere, i.e., the first distance to be sampled.

* <span id="EndRadius"></span>'''Ending radius''' <sup>&nbsp;</sup>The radius of the largest sampling circle/sphere. Note that this distance may not be actually sampled, if ''Radius step size'' is not a divisor of ''Ending radius''-''Starting radius''.
: '''Tip:''' You can clear this field (or set it to ''NaN'') to sample the entire image. This is particularly useful when running the plugin from a [[#Batch_Processing|macro]] that processes images with different dimensions.

* <span id="StepSize"></span>'''Radius step size''' <sup>&nbsp;</sup>The sampling interval between radii of consecutive sampling circles/spheres. This value may be set to zero for continuous (1-voxel increment) measurements.
:For stacks with anisotropic voxel size, setting ''Radius step size'' to zero, sets the step length to the dimension of the matching isotropic voxel, i.e., the cube root of the product of the voxel dimensions or the square root of the product of the pixel dimensions (2D images).

* '''Restrict analysis to hemicircle/hemisphere''' <sup>&nbsp;</sup>This option is only available when an orthogonal radius has been created (by holding ''Shift'' while using the <span style="border-bottom:1px dotted #ccc;">Straight Line Selection Tool</span>). It can be used to limit the analysis to sub-compartments of the arbor (e.g., apical vs basal dendrites, in the case of pyramidal neurons, as in illustration [[#Introduction|above]]).
:For horizontal lines, this option instructs the algorithm to measure intersections at sites equidistant from the center that have y-coordinates above/below the drawn line. For vertical lines, it instructs the plugin to measure intersections at sites equidistant from the center that have x-coordinates to the left/right of the drawn line.

==== Multiple Samples and Noise Reduction ====
[[ File:BitmapSholl-Prompt_v3.png|320px|right |Main prompt (version 3.4.1)]]
* '''Samples per radius ''(2D images only)''''' <sup>&nbsp;</sup>Defines the number of measurements to be performed at each sampling circumference. These measurements are then combined into a single value according to the chosen [[#SamplesIntegration|integration method]]. This strategy, a break from previous approaches, increases the accuracy of non-continuos profiles by diluting out the effect of processes extending tangent to the sampling circumference.
:Visually, this option can be imagined as the "thickness" of the sampling circumference: e.g., for a radius of 100 pixels and a value of 3 ''Samples per radius'', the final number of intersections would integrate the measurements sampled at distances 99, 100 and 101.
:Note that it would not make sense to increase the number of samples beyond the length (in pixels) of ''Radius step size''. For this reason, this option is limited to a draconian (and arbitrary) maximum of 10 samples.

* <span id="SamplesIntegration"></span>'''Samples integration ''(2D images only)''''' <sup>&nbsp;</sup>The statistical function used to combine intersection counts when multiple ''Samples per radius'' are used. Options are mean or median.

* '''Ignore isolated (6-connected) voxels ''(3D images only)''''' <sup>&nbsp;</sup>If checked, single isolated voxels intersecting the surface of sampling spheres are not taken into account, which may allow for smoother profiles on noisy image stacks. However, it should be noted that connectivity in the stack volume may not reflect connectivity on the surface of a digitized sphere. Indeed, in certain contexts, it is possible (though unlikely) to obtain higher intersection counts when this filtering option is active.
:Please keep in mind that this is just a refinement feature, and you should not expect it to mitigate the effects derived from poorly-segmented arbors.

==== Descriptors and Curve Fitting ====
* <span id="EnclosingRadiusCutoff"></span>'''Enclosing radius cutoff''' The number of intersections to be used in the definition of [[#EnclosingRadius|Enclosing radius]].

* <span id="PrimaryBranches"></span>'''Number of primary branches''' The number of primary branches (i.e., those originating directly from cell soma when the center of analysis is the perikaryon) to be used in the calculation of [[#SchoenenSampled|Schoenen ramification indices]].<br><br>
** '''Infer from starting radius''' If checked, the ''Number of Primary branches'' is inferred from the count of intersections at [[#StartRadius|Starting radius]].

* '''Fit profile and compute descriptors''' <sup>&nbsp;</sup>If checked, data is fitted according to the chosen [[#Sholl_Methods|method]] and appropriate [[#Metrics|metrics]] calculated automatically. If unchecked, only sampled data is plotted.<br><br>
** '''Show fitting details''' <sup>&nbsp;</sup>Choose this option to have all of the parameters of the simplex fitting printed to the Log window. The [http://en.wikipedia.org/wiki/Coefficient_of_determination coefficient of determination] (''R<sup>2</sup>'', a measure of goodness of fit) is always stored in the ''Sholl Results'' table even when this option is not selected.

==== Choice of Method(s) ====
<span id="Sholl_Methods"></span>The [[#MethodsTable|type of profile(s)]] to be obtained. ''Linear'' (profile without normalization), or normalized profiles: ''Linear-norm'', ''Semi-log'', or ''Log-log''.
* '''Polynomial''' <sup>&nbsp;</sup> Specifies the degree of the [[#MethodsTable|polynomial]] to be fitted to the ''Linear'' profile<ref name="Stulic">D Ristanović, NT Milosević and V Stulić. Application of modified Sholl analysis to neuronal dendritic arborization of the cat spinal cord. J Neurosci Methods, 158(2):212–8, Dec 2006, [http://www.ncbi.nlm.nih.gov/pubmed?term=16814868 PMID: 16814868]</ref>. While the polynomial of best approximation, or "best fit", should be empirically determined for each analyzed cell type, it is possible to ask the plugin to predict the order of the fitting polynomial (or at least try) using the choice ''Best fitting degree''. In this case, the plugin will loop through all the available choices of polynomials, perform each fit in the background and choose the one with the highest coefficient of determination.
* '''Most informative''' <sup>&nbsp;</sup> Select this option when you cannot predict which type of normalized profile best describes the dataset. If chosen, the plugin will use the [[#Dratio|Determination ratio]] to determine which of ''Semi-log'' or ''Log-log'' methods is more appropriate.  ''Linear-norm'' is not performed.
:The ''Best fitting degree'' and ''Most informative'' choices are obviously more computer-intensive and can be monitored by activating the ''Show fitting details'' checkbox.
* <span id="Normalizer"></span>'''Normalizer''' The property of the sampling shell to be used in the normalization of ''Linear-norm'', ''Semi-log'', and ''Log-log'' profiles. It is [[#MethodsTable|described below]].

==== Output Options ====
* '''Create intersections mask''' <sup>&nbsp;</sup>If checked, a 16–bit maximum intensity projection of the analyzed image is generated in which the measured arbor is painted according to its Sholl profile.<p>The default Lookup Table (LUT) used by the mask is modeled after the [http://www.mathworks.com/help/matlab/ref/colormap.html MATLAB "jet" color map] (a rainbow color map based on a fluid-jet simulation by NCSA) but you can apply any of your favorite LUTs using the <span style="border-bottom:1px dotted #ccc;">Image▷ Lookup Tables▷</span> submenu. WYSIWYG versions (RGB images) of these masks can be otained using by pressing {{key press|Shift|F}} (shortcut for <span style="border-bottom:1px dotted #ccc;">Image▷ Overlay▷ Flatten</span>) or by running <span style="border-bottom:1px dotted #ccc;">Analyze▷ Tools▷ Calibration Bar...</span></p>
** '''Background''' <sup>&nbsp;</sup>The background color (gray level) of the mask from 0 (black) to 255 (white). It can be changed at any later point using <span style="border-bottom:1px dotted #ccc;">Image▷ Color▷ Edit Lut...</span>

* '''Save results on image directory ''(only available when image is saved locally)''''' <sup>&nbsp;</sup> If checked, all the results (with the exception of the ''[[#Metrics|Sholl Table]]'') are saved to the image directory. These include: 1) Sholl plots (saved as PNG images), 2) A table containing detailed data (saved according to the extension and format specified in <span style="border-bottom:1px dotted #ccc;">Edit▷ Options▷ Input/Output...</span>) and 3) The Sholl mask (saved as a 16-bit TIFF).<p>Files are named after the image filename and analysis method. When this option is not available, profiles can always be retrieved using the ''List'', ''Save...'' and ''Copy...'' commands of plot windows.</p>
** '''Do not display saved files''' If checked, saved files are directly saved to disk and are not displayed. Activate this option when [[#Batch_Processing|batch processing]] files.

== Sholl Plots ==
<center>
<span id="ShollPlots"></span>[[File:ShollPlots.png|center|]]

'''''Linear'', ''Linear-norm'', ''Semi-log'' and ''Log-log'' profiles for the ddaC cell (<span style="border-bottom:1px dotted #ccc;">File▷ Open Samples▷ ddaC Neuron</span>), version 3.0'''.
Most of the retrieved [[#Metrics_based_on_fitted_data|metrics]] are automatically highlighted by the plugin. ''Linear profile'': [[#MeanValueOfFunction|Mean value]] (horizontal grid line) and [[#Centroid|Centroid]] (colored mark). Logarithmic profiles: The [[#ShollDecay|Sholl regression coefficient]] (also known as Sholl decay) can be retrieved by linear regression using either the full range of data (blue line) or data within percentiles 10–90 (red line).  For this particular cell type, the Semi-log method is more [[#Dratio|informative]] when compared to the Log-log method.


<span id="MethodsTable"></span>
{| style="padding: 60px;" rules="rows"
! align="Center"| &nbsp;
!style="height: 2em;"| Method
! Fit
! Description
|-
| <span id="eq1">(1)</span>&nbsp;&nbsp;
|style="white-space:nowrap"| Linear
|style="white-space:nowrap"|&nbsp;&nbsp; <i>N</i> = a + br + cr<sup>2</sup> + dr<sup>3</sup>  + er<sup>4</sup> + fr<sup>5</sup> + ... + xr<sup>n</sup>&nbsp;&nbsp;
| &nbsp;&nbsp;&nbsp;<br>Outputs a ''N vs Distance'' profile. Data is fitted to a polynomial function<ref name="Stulic"/>. [[#CriticalRadius|Critical radius]], [[#CriticalValue|Critical value]] and [[#MeanValueOfFunction|Mean value of function]] are calculated<br>&nbsp;
|-
| <span id="eq2">(2)</span>&nbsp;&nbsp;
|style="white-space:nowrap"|  Linear-norm
|style="white-space:nowrap"|&nbsp;&nbsp; ''N/S'' = a r<sup>b</sup>
| &nbsp;<br>Outputs a <i>N/S vs Distance</i> profile. Points are fitted to a power function. It is an intermediate representation of the data that can be used to gauge the choice of [[#Normalizer|normalizer]]. Once plotted under a logarithmic scale the Linear-norm curve is similar to the Semi-log profile<br>&nbsp;
|-
| <span id="eq3">(3)</span>&nbsp;&nbsp;
|style="white-space:nowrap"|  Semi-log
|style="white-space:nowrap"|&nbsp;&nbsp; log(''N/S'') = -k r + m
|&nbsp;<br>Outputs a <i>log(N/S) vs Distance</i> profile. A linear regression is fitted to the sampled data. The [[#ShollDecay|Sholl regression coefficient]] (''k'') is calculated<br>&nbsp;
|-
| <span id="eq4">(4)</span>&nbsp;&nbsp;
|style="white-space:nowrap"| Log-log
|style="white-space:nowrap"|&nbsp;&nbsp;  log(''N/S'') = -k × log(r) + m
|&nbsp;<br>Outputs a <i>log(N/S) vs log(Distance)</i> profile. Data is also fitted to a straight line. This is an alternative approach<ref name="Ristanovic"></ref> of obtaining a relevant [[#ShollDecay|regression coefficient]], when the Semi-log method returns a poor fit<br>&nbsp;
|-
|
|}
</center>


<span style="display: inline-block; width: 25px">'''''N'''''</span> For 2D images, the <u>N</u>umber of clusters of pixels (8–connected) intersecting the circumference of radius ''r''<br>
<span style="display: inline-block; width: 25px">&nbsp;</span> For 3D images, the <u>N</u>umber of clusters of voxels (26-connected) intersecting the surface of the sphere of radius ''r''

<span style="display: inline-block; width: 25px">'''''r'''''</span> Distance from center of analysis (<u>r</u>adius of Sholl circle/sphere)

<span style="display: inline-block; width: 25px">'''''log'''''</span>Natural logarithm, the logarithm to the base ''e''

<span style="display: inline-block; width: 25px">'''''S'''''</span>The [[#Choice_of_Method(s)|chosen property ]] of the sampling shell to be used in the normalization of ''Linear-norm'', ''Semi-log'', and ''Log-log'' profiles.<br> <span style="display: inline-block; width: 25px">&nbsp;</span>For 2D images, the ''Perimeter'' of the sampling circumference (2πr) or the ''Area'' of the corresponding circle (πr<sup>2</sup>)<br> <span style="display: inline-block; width: 25px">&nbsp;</span>For 3D images, the ''Surface'' of the sampling sphere (4πr<sup>2</sup>) or its respective ''Volume'' (4/3πr<sup>3</sup>)<br>

'''N.B.''' A third [[#Normalizer|normalization option]] is also available when performing [[#StepSize|non-continuous sampling]]: ''Annulus'' / ''Spherical shell''.<br>
In this case, the normalization is performed against the area of the annulus formed between the circumferences at ''r'' ± ''Radius step size''/2 (2D images), or against the volume between the two spheres at ''r'' ± ''Radius step size''/2 (3D images).<br>

== Metrics ==
Morphometric descriptors and other properties of the arbor are printed to a dedicated table named ''Sholl Results''. Listed values can be displayed in scientific notation and with the precision specified in <span style="border-bottom:1px dotted #ccc;">Analyze▷ Set Measurements...</span> The first columns log analysis parameters: ''Image filename and voxel unit'', ''Lower'' and ''Upper Threshold levels'', ''X,Y'' (in pixels) and ''Z'' (slice number) coordinates of center of analysis, ''Starting'' and ''Ending radius'', ''Radius step'', ''Number of Samples per Radius'', etc. Other parameters are described below.

[[File:BitmapSholl-Table.png|100%|center|Descriptors and metrics are listed in the Sholl Table]]

=== Metrics based on sampled data ===
;Intersecting radii
:The number of sampling radii intersecting the arbor at least once.

;Sum of intersections (''Sum inters.'')
:The sum of all intersections.

;Mean of intersections (''Mean inters.'')
:''Sum inters.'' divided by ''Intersecting radii''.
: See also [[#MeanValueOfFunction|Mean value]]

;Median of intersections (''Median Inters.'')
:The median value of sampled intersections.

;Skewness<span id="Skewness"></span>
:The [http://en.wikipedia.org/wiki/Skewness skewness] of the sampled data, an indication of how symmetrical the distribution is around its mean. Positive values indicate an asymmetrical distribution with a longer tail to the right. Negative values indicate data with a longer tail to the left. A popular rule of thumb considers that if the skewness is greater than 1.0 (or less than -1.0), the distribution may be considered far from symmetrical.
: See also [[#Skewness-fitted|Skewness (fitted data)]]

;Kurtosis<span id="Kurtosis"></span>
:The [http://en.wikipedia.org/wiki/Kurtosis kurtosis] of the sampled data, which quantifies whether the shape of the distribution matches the Gaussian distribution, assuming that a Gaussian distribution has a kurtosis of 0. A distribution more peaked than a Gaussian has a positive kurtosis while a negative value indicates a flatter distribution.
: See also [[#Kurtosis-fitted|Kurtosis (fitted data)]]

;<span id="MaxInters"></span>Highest count of intersections (''Max inters.'')
:The maximum value of sampled intersections, i.e., the maximum in a linear [''N'' vs ''Distance''] profile, reflecting the highest number of processes/branches in the arbor.
: See also [[#CriticalValue|Critical value]]

<div id="LocalMaxima" style="float:center;
            border: 1px solid #ccc;
            padding: 5px !important;
            text-align:center;
            margin-top: 1em;
            margin-bottom: 2em;
            background-color: #ffefbe;
            {{border-radius|.75em}}{{box-shadow}}">
By default only the absolute maximum is noted. However, it is possible to apply peak detection techniques to the profile to retrieve other sites of high density branching. [[Find Peaks]] is a script that retrieves local maxima directly from data output by ''Sholl Analysis''.</div>

;<span id="MaxIntersRadius"></span>Radius of highest count of intersections (''Max inters. radius'')
:The distance at which the ''Highest count of intersections'' occurred, reflecting sites of highest branch density. Note that if the same maximum occurs multiple times, only the first distance is considered.
: See also [[#CriticalRadius|Critical radius]]

;<span id="SchoenenSampled"></span>Schoenen Ramification index (''Ramification index (sampled)'')
:A measure of ramification<ref name="Schoenen">J Schoenen. The dendritic organization of the human spinal cord: the dorsal horn. Neuroscience, 7(9):2057–87, Jan 1982, [http://www.ncbi.nlm.nih.gov/pubmed?term=7145088 PMID: 7145088]</ref>: the ratio between ''Max inters.'' and the number of [[#PrimaryBranches|primary branches]].
: See also [[#SchoenenFitted|Ramification index (CV)]]

;<span id="Centroid">Centroid radius
:The abcissa of the [http://en.wikipedia.org/wiki/Centroid centroid] (i.e., the geometric center or barycenter) of the linear profile. It is [[#ShollPlots|highlighted]] on the ''N'' vs ''Distance'' plot.

;Centroid value
:The ordinate of the [http://en.wikipedia.org/wiki/Centroid centroid] (i.e., the geometric center or barycenter) of the linear profile. It is [[#ShollPlots|highlighted]] on the ''N'' vs ''Distance'' plot.

;<span id="EnclosingRadius"></span>Enclosing radius
:The last (thus, the widest) of ''Intersecting radii'' to be associated with the number of intersections specified by [[#EnclosingRadiusCutoff|Enclosing radius cutoff]]. For a cutoff of 1 (the default) ''Enclosing radius'' is the widest of ''Intersecting radii''. It reflects the [http://en.wikipedia.org/wiki/Feret_diameter Feret length] of the arbor.

=== Metrics based on fitted data ===
;<span id="Dratio"></span>Determination ratio
:The ratio of the [[#RegR2|coefficient of determination]] for the semi-log method and that for the log–log method<ref name="Ristanovic">NT Milosević and D Ristanović. The Sholl analysis of neuronal cell images: Semi-log or log-log method? J Theor Biol, 245(1):130–40, Mar 2007, [http://www.ncbi.nlm.nih.gov/pubmed?term=17084415 PMID: 17084415]</ref>. If the semi-log method is better relatively to the log–log method, the ''Determination ratio'' becomes larger than 1. It is the parameter used by the plugin to silently predict the normalization method that is the [[#Choice_of_Method(s)|most informative]]. The prediction can be monitored by activating the [[#Descriptors and Curve Fitting|Show fitting details ]] checkbox.

;<span id="ShollDecay"></span>Sholl regression coefficient (''Regression coefficient'')
:The slope (multiplied by -1) of the linear regression described in [[#eq3|(3)]] and [[#eq4|(4)]], i.e., ''k'', a measure of the rate of decay of the number of branches with distance from the center of analysis. Higher ''k'' values reflect larger changes in the function log(N/S). To optimize the fit, the plugin retrieves a [[#ShollPlots|second linear regression]] centered around the median distance, excluding distances at the edges of the profile. Details of this second fit are also registered on the [[#Metrics|''Sholl table'']] under dedicated columns, e.g., ''Sholl regression coefficient [P10-P90]'', when data within the 10<sup>th</sup>–90<sup>th</sup> percentile is used.

;Regression intercept
:The y-coordinate ''m'' described in [[#eq3|(3)]] and [[#eq4|(4)]].

;<span id="RegR2"></span>Regression R<sup>2</sup> (''Regression R^2'')
:The coefficient of determination of the linear regression described in [[#eq3|(3)]] and [[#eq4|(4)]].

;<span id="CriticalValue"></span>Critical value
:The local maximum of the polynomial fit, i.e, ''N'' at ''Critical radius'' in [[#eq1|(1)]]. Sometimes abbreviated as ''N<sub>m</sub>''.
: See also [[#MaxInters|Max inters.]]

;<span id="CriticalRadius"></span>Critical radius
:The distance at which ''Critical value'' occurs. Calculated with a precision of 1/1000 of ''Radius step size''. Sometimes abbreviated as ''r<sub>c</sub>''.
: See also [[#MaxIntersRadius|Max inters. radius]]

<div id="Nomenclature" style="float:center;
            border: 1px solid #ccc;
            padding: 5px !important;
            text-align:center;
            margin-top: 1em;
            margin-bottom: 2em;
            background-color: #ffefbe;
            {{border-radius|.75em}}{{box-shadow}}">
Previous authors have used different terms to describe the largest value taken by the Sholl profile (cf. [http://en.wikipedia.org/wiki/Sholl_analysis Wikipedia], [[#References|References]]). Since the Sholl technique is not restricted to dendritic arbors (it can be applied to any tree-like structure such as axonal arbors, mammary ducts or blood vessels), this plugin introduces the term [[#CriticalRadius|Critical radius]], renaming ''Dendrite maximum'' (''N<sub>m</sub>'') to [[#CriticalValue|Critical value]]. Thus, we may not follow the conventions adopted by [[Simple_Neurite_Tracer:_Sholl_analysis|Simple Neurite Tracer]].</div>

;<span id="MeanValueOfFunction"></span>Mean value
:The mean value<ref name="Stulic"></ref> of the fitted polynomial function [[#eq1|(1)]], representing the average of intersections over the whole area occupied by the arbor. Sometimes abbreviated as MV or Nav.
:On the Sholl plot, it is [[#ShollPlots|highlighted]] as the height of the rectangle that has the width of ''Enclosing radius'' − ''First intersecting radius'' and the same area of the area under the fitted curve on that discrete interval. It is analogous to '''''Mean inters.''''', the arithmetic mean of sampled intersections throughout the arbor (cf. [[#Metrics_based_on_sampled_data|Metrics based on sampled data]]).

;<span id="SchoenenFitted"></span>Schoenen Ramification index (''Ramification index (CV)'')
:Schoenen Ramification index retrieved from fitted profile:  The ration between [[#CriticalValue|Critical value]] and  [[#PrimaryBranches|Number of primary branches]].
: See also [[#SchoenenSampled|Ramification index (sampled)]]

;Skewness<span id="Skewness-fitted"></span>
:The [[#Skewness|skewness]] of the fitted polynomial distribution between [[#StartRadius|Starting radius]] and [[#EndRadius|Ending radius]].

;Kurtosis<span id="Kurtosis-fitted"></span>
:The [[#Kurtosis|kurtosis]] of the fitted polynomial distribution between [[#StartRadius|Starting radius]] and [[#EndRadius|Ending radius]].

;Polynomial R<sup>2</sup> (''Polyn. R^2'')
:The coefficient of determination of the polynomial fit described in [[#eq1|(1)]].

<span id="Importing"></span>

== Importing Profiles Obtained Elsewhere ==
[[ File:BitmapSholl-TabularPrompt.png|320px|right |Tabular prompt (version 3.1)]]As of version 3.1 it is possible to analyze profiles obtained from traced data. This feature is specifically targeted at users of [[Simple Neurite Tracer]], Fiji's framework for semi-automated reconstruction of neuronal arbors, but can be extended to tracings obtained with other software.


This option is triggered by holding {{key press|Alt}} while running  <span style="border-bottom:1px dotted #ccc;">Analyze▷ Sholl Analysis...</span>, which prompts a simplified version of the [[#Multiple Samples and Noise Reduction|main dialog]].

#Load tracings (typically a .swc or a .traces file) into [[Simple_Neurite_Tracer:_Basic_Instructions|Simple Neurite Tracer]]
#Retrieve the linear Sholl profile by following these [[Simple_Neurite_Tracer:_Sholl_analysis|instructions]]
#Export ''detailed data''  (.csv file). You now have two options:
:If data does not need to be edited:
:#Close the ImageJ Results Table (if open) and run the plugin while holding {{key press|Alt}}.  You will be prompted to indicate the path of the saved  profile. Because the plugin is aware of the file's directory, saving options are available.
:If data needs to be modified, the profile must be first loaded by ImageJ:
:#You can do so by dragging & dropping its file into the main ImageJ window, or by using <span style="border-bottom:1px dotted #ccc;">File▷ Import▷ Results...</span>
:#Press {{key press|Backspace}} over selected rows to exclude them from the analysis.
:#Run the plugin while holding {{key press|Alt}}. Because the plugin did not keep track of any directory, saving options are disabled.

Notes:
*For ''Annulus/Spherical shell'' [[#Normalizer|normalization]], [[#StepSize|Radius step size]] is calculated from the difference between the first two rows in ''Distance column''.
*In a [[#Batch_Analysis_of_Previously_Obtained_Profiles|macro]], the [http://imagej.nih.gov/ij/developer/macro/functions.html#setKeyDown setKeyDown("alt")] macro function can be used input tabular data.

== Batch Processing ==
It is fairly simple to [[Scripting Help|automate]] the analysis of multiple images using any of the scripting languages supported by ImageJ and Fiji ([[Introduction into Macro Programming|ImageJ Macro Language]], [[Beanshell_Scripting|Beanshell]], [[Javascript_Scripting|Javascript]], [[JRuby_Scripting|JRuby]], [[Jython_Scripting|Jython]], [[Clojure_Scripting|Clojure]], ...).

=== Batch Analysis of Bitmap Images ===
Any macro or script must allow the Sholl Analysis plugin to access the ROI marking the center of analysis. One could instruct ImageJ to read the coordinates of pre-existing ROIs from a text file, store a list of line selections in the ROI Manager, or write a morphology-based routine that detects the center of the arbor. However, marking the center of analysis is probably something that you will want to do manually. Here is a workflow:

#Place all the .tif images to be processed in a single folder.
#Select the <span style="border-bottom:1px dotted #ccc;">Point Selection Tool</span> in the main ImageJ window and press {{key press|Shift|T}} to activate the Threshold widget (<span style="border-bottom:1px dotted #ccc;">Image▷ Adjust▷ Threshold...</span>). Make sure ''Set stack positions'' is active in the <span style="border-bottom:1px dotted #ccc;">Image▷ Overlay▷ Overlay Options...</span> prompt. Open the first image.
#Adjust threshold levels. Press the ''Apply'' button of the Threshold widget to create a binary image.
#Select the z-slice containing the center of analysis. Click over the center with the <span style="border-bottom:1px dotted #ccc;">Point Selection Tool</span> and press {{key press|B}} (shortcut for <span style="border-bottom:1px dotted #ccc;">Image▷ Overlay▷ Add Selection...</span>). This will add the point ROI to the image overlay. Save the image as .TIFF by pressing {{key press|S}} (<span style="border-bottom:1px dotted #ccc;">File▷ Save As...▷ Tiff...</span>).
#Repeat the last 2 steps until all images are marked, using {{key press|Shift|O}} (shortcut for <span style="border-bottom:1px dotted #ccc;">File▷ Open Next</span>) to iterate through all the images.

<div style="float:center;
            border: 1px solid #ccc;
            padding: 5px !important;
            text-align:center;
            margin-top: 1em;
            margin-bottom: 2em;
            background-color: #ffefbe;
            {{border-radius|.75em}}{{box-shadow}}">
When working with ROIs, it is critical that you work with .tif files because only this format keeps track of image overlays. The <span style="border-bottom:1px dotted #ccc;">Process▷ Batch▷ Convert...</span> command allows bulk conversion between image formats.</div>

Now that all the images are marked, we just need to ask ImageJ to generate some lines of code. We will open the Macro Recorder (<span style="border-bottom:1px dotted #ccc;">Plugins▷ Macros▷ Record...</span>) and run ''Sholl Analysis'' on one of the images to find out how to call the plugin with suitable parameters. In this example, we will use the ImageJ macro language. The single line of code that appears in the recorder window will look something like this:
<source lang="java">
run("Sholl Analysis...", "starting=10 ending=400 radius_step=0 infer fit linear polynomial=[8th degree] semi-log normalizer=Volume create save do");
</source>

Now, we just need to assemble a working macro to be pasted in the <span style="border-bottom:1px dotted #ccc;">Process▷ Batch▷ Macro...</span> prompt:
<source lang="java">
// Get the number of ROIs of the image overlay
nROIs = Overlay.size;

// We cannot proceed if no ROI is available (safety check)
if (nROIs==0)
   exit("No ROI was found. Cannot proceed.");

// Select the last ROI of the overlay. Because we have activated the "Set stack positions" option,
// this will automatically activate the Z-slice in which the ROI was created (3D images)
Overlay.activateSelection(nROIs-1);

// We now call the plugin as detailed by the Macro Recorder. We'll set 'Ending radius' to a non-numeric
// value (NaN, "Not a Value") to make sure the maximum length for each individual image is used
run("Sholl Analysis...", "starting=10 ending=NaN radius_step=0 infer fit linear polynomial=[8th degree] semi-log normalizer=Volume create save do");
</source>
Of course you can also automate any preceding steps. However, do not forget to ensure that the center of analysis will be available when the plugin is called:
<source lang="java">
// Impose spatial calibration
     run("Properties...", "unit=um pixel_width=1.5 pixel_height=1.5 voxel_depth=3.0");
// Subtract background
     run("Subtract Background...", "rolling=50 sliding stack");
// Apply a favorite threshold
    setAutoThreshold("Huang dark stack");
// >>>> Make sure the initial point selection remains available <<<<
    Overlay.activateSelection( Overlay.size - 1 );
// Run the plugin
run("Sholl Analysis...", "starting=10 ending=NaN radius_step=0 infer fit linear polynomial=[8th degree] semi-log normalizer=Volume create save do");
</source>
That's it. Use the Macro Recorder to generate the customizations you will need before parsing the entire folder of images with <span style="border-bottom:1px dotted #ccc;">Process▷ Batch▷ Macro...</span>

'''Tip:''' As you may have noticed, ImageJ plugins are controlled by a single sentence  in which arguments are separated by a space. Input fields and choice lists appear as ''keyword=value'' pairs, active checkboxes by a single keyword. Options that are not needed can be omitted. This makes it easier to generate customizable macros:
<source lang="java">
start = 10;  // variable that controls starting radius
end   = 200; // variable that controls ending radius
step  = 2;   // variable that controls step size

// Run the plugin
run("Sholl Analysis...", "starting="+ start +" ending="+ end +"radius_step="+ step +" infer linear save do");
</source>
=== Batch Analysis of Previously Obtained Profiles ===
If you already have obtained profiles from traced cells and would like to retrieve the same [[#Metrics|metrics]] calculated by the plugin when analyzing bitmap images, you can use the [http://imagej.nih.gov/ij/developer/macro/functions.html#setKeyDown setKeyDown("alt")] as when [[#Importing|triggering this option]] through the ImageJ menu. Here is an example macro that runs the plugin over a folder of .csv files containing Sholl profiles produced by [[Simple_Neurite_Tracer:_Sholl_analysis|Simple Neurite Tracer]]:

<source lang="java">
distanceCol = "Radius";		// Column in .csv file listing distances
intersecCol = "Crossings";	// Column in .csv file listing intersections

dir = getDirectory("Choose the directory containing the profiles");
list = getFileList(dir);

for (i=0; i<list.length; i++) {
	if (endsWith(list[i], ".csv")) {
		closeResults();
		path = dir+list[i];
		setKeyDown("alt");
		run("Sholl Analysis...", "open="+ path
				+ " name="+ list[i]
				+ " distance="+ distanceCol
				+ " intersections="+ intersecCol
				+ " 3d enclosing=1 infer linear polynomial=[Best fitting degree]"
				+ " semi-log log-log normalizer=Area/Volume show save do");
	}
}

function closeResults() {
	if (isOpen("Results"))
		{ selectWindow("Results"); run("Close"); }
}
</source>
== Pre-processing ==
As mentioned, the quality of the analysis relies on how the arbor was segmented. Unfortunately, it is not possible to generalize universal routines that efficiently binarise grayscale images and any procedure must be tailored to the characteristics of each individual dataset. However, noise in imagery from fluorescence microscopy can be mitigated through the usage of processing filters, specially edge-preserving ones:
* Median Filtering (2D/3D), e.g., <span style="border-bottom:1px dotted #ccc;">Process▷ Filters▷</span>, <span style="border-bottom:1px dotted #ccc;">Plugins▷ 3D▷</span>
* [[Anisotropic_Diffusion_2D|Anisotropic Diffusion]], <span style="border-bottom:1px dotted #ccc;">Plugins▷ Process▷ Anisotropic Diffusion 2D</span>
* Sobel Edge Detection, e.g., <span style="border-bottom:1px dotted #ccc;">Process▷ Find Edges</span>
* Frequency filters, e.g., <span style="border-bottom:1px dotted #ccc;">Process▷ FFT▷ Bandpass Filter...</span> 
* [[Rolling_Ball_Background_Subtraction|Rolling Ball]] or "Top hat" filters, e.g., <span style="border-bottom:1px dotted #ccc;">Process▷ Subtract Background...</span>


On the other hand, it is possible to adopt more sophisticated [[:Category:Segmentation|segmentation algorithms]] when [[Auto_Threshold|global thresholding methods]] do not yield satisfactory results:
* [[Auto Local Threshold|Local Threshold]], <span style="border-bottom:1px dotted #ccc;">Image▷ Adjust▷</span>
* [[RATS:_Robust_Automatic_Threshold_Selection|Robust Automatic Threshold Selection]], <span style="border-bottom:1px dotted #ccc;">Plugins▷ Segmentation▷</span>
* [[Level_Sets|Level Sets]], <span style="border-bottom:1px dotted #ccc;">Plugins▷ Segmentation▷</span>

Semi-automated segmentation can also be improved through the usage of simple [[:Category:Scripting|scripts]] that automate frequently used commands, including the ones in this [https://github.com/tferr/Scripts#scripts Github repository]. For more information about image processing have a look at the [http://imagej.nih.gov/ij/docs/guide/ ImageJ User Guide], the Fiji [[Cookbook]], Fiji [[:Category:Tutorials|tutorials]], the [http://imagejdocu.tudor.lu ImageJ Information and Documentation Portal], and remaining documentation resources (<span style="border-bottom:1px dotted #ccc;">Help▷ Documentation...</span>).

== Auxiliary Commands ==
;File▷ Open Samples▷ ddaC Neuron
:Opens a sample image of a Drosophila class IV ddaC sensory neuron in which dendrites have been previously segmented (2D arbor). Use it to get acquainted with the plugin. Run <span style="border-bottom:1px dotted #ccc;">Image▷ Show Info...</span> (shortcut: {{key press|I}} ) to know more about this cell type.

;Help▷ About Plugins▷ About Sholl Analysis...
:Retrieves information about the plugin version and a link to its Git source code [https://github.com/tferr/ASA repository].

== FAQ ==
#<span id="faq1"></span>'''What is the difference between ''Sholl Analysis'' and an homonymous plugin released by the Ghosh laboratory in 2005'''?
#:The [http://labs.biology.ucsd.edu/ghosh/software/ original Sholl Analysis plugin] by Tom Maddock (version 1.0) was released for ImageJ 1.35 and is now deprecated software. The current implementation inherits Tom's initial 2D algorithm, but has numerous [[#Release_Notes|added features]] to enhance its utility. Note that throughout 2012 the plugin was temporarily called ''Advanced Sholl Analysis''. You can follow the entire history of the plugin on [https://github.com/tferr/ASA GitHub]. 
#<span id="faq2"></span>'''Why do I need to threshold the cell?'''
#: Counting intersections is really a binary procedure: a shell either intercepts a branch or it doesn't. For this reason the image must be split in two phases: arbor and background.
#<span id="faq3"></span>'''The plugin complains about a wrong image type. Why?'''
#: Although ImageJ can threshold RGB images, the plugin can only parse grayscale images (8-bit and 16-bit). Images of fluorescence-labeled cells are typically non-RGB images. Conversions between different image types is explained in the [http://imagej.nih.gov/ij/docs/guide/ ImageJ User Guide].
#<span id="faq4"></span>'''I cannot see the hemicircle/hemisphere option. Why?'''
#: This option is only available if an orthogonal line has been created by holding {{key press|Shift}} when using the <span style="border-bottom:1px dotted #ccc;">Straight Line Selection Tool</span>. See the [http://imagej.nih.gov/ij/docs/guide/ ImageJ User Guide] for the full list of key modifiers that can be used while creating straight line ROIs.
#<span id="faq5"></span>'''With 3D images, how do I set the Z-position of the center?'''
#: The Z-position (depth) of the center of analysis is the active Z-slice of the stack. It is reported in the ''Sholl Results'' table.
#<span id="faq6"></span>'''Why so many parameters?'''
#:The plugin is designed for the analysis of a wide diversity of arbors and it is not biased to any particular cell type. The only way to ensure this broad applicability is to give users full control over the mathematical techniques used by the plugin to analyze sampled data.
#<span id="faq7"></span>'''How can I save/edit the ''Sholl Results'' table?'''
#: Select the table, then choose <span style="border-bottom:1px dotted #ccc;">File▷ Save As…</span>The filename extension can be specified using <span style="border-bottom:1px dotted #ccc;">Edit▷ Options▷ Input/Output…</span> (see the [http://imagej.nih.gov/ij/docs/guide/ ImageJ User Guide] for details). Single cells cannot be modified from within ImageJ, but custom extensions (e.g., .csv, .xls or .ods) will allow the table to be imported by other spreadsheet applications.
#<span id="faq8"></span>'''Can I modify the number of decimal places used by the ''Sholl Results'' table?'''
#: Yes. Use the options ''Decimal places'' and ''Scientific notation'' in <span style="border-bottom:1px dotted #ccc;">Analyze▷ Set Measurements…</span>
#<span id="faq9"></span>'''I cannot see the option to save the results. Why?'''
#: The image you are trying to analyze is not saved locally. Saving it to a local directory (e.g., your Desktop or Home folder) should re-enable it.
#<span id="faq10"></span>'''What is the ''Sholl mask''?'''
#: The Sholl mask ([[#Introduction|see example above]]) is simply an illustration: a maximum intensity projection of the analyzed cell in which intersection counts are used as pixel intensities. As explained in [[#Output_Options|Output Options]], its LUT can be modified, and intensities calibrated using ImageJ default commands.
#<span id="faq11"></span>'''The 3D profile looks ''worse'' than the 2D profile of the Maximum Intensity Projection of the same cell. Why?'''
#: An anisotropic voxel size will have a strong impact on [[#StepSize|step size]]. On the other hand, 2D and 3D images can be sampled differently depending on the [[#Parameters|options chosen]]. If <span style="border-bottom:1px dotted #ccc;">Image▷ Properties…</span> (shortcut: {{key press|Shift|P}} ) reports the appropriate spatial calibration, make sure to read [[#Multiple_Samples_and_Noise_Reduction|Multiple Samples and Noise Reduction]] before deciding which type of images to use.
#<span id="faq12"></span>'''The shape of the polynomial changes at the edges of the profile. Why?'''
#: Inflection points at [[#StartRadius|starting/ending radius]] are usually associated with a poor fit and/or the fact that all the radii in which no intersections were counted are ignored. The latter is required to calculate the [[#ShollDecay|Sholl regression coefficient]], as ''log(0)'' is undefined.
#<span id="faq13"></span>'''My images do not look that great. How can I treat them prior to analysis?'''
#: Have a look at [[#Pre-processing| Pre-processing]].
#<span id="faq14"></span>'''None of the fitting options is suitable for my datasets. What should I do?'''
#: You could explore ImageJ's built-in CurveFitter (<span style="border-bottom:1px dotted #ccc;">Analyze▷ Tools▷ Curve Fitting…</span>), but ultimately you may need to use dedicated software. You could also [[#faq15|contact the developers]] to see if it would be possible to extend the repertoire of fitting options.
#<span id="faq15"></span>'''I found a bug. How do I report it?'''
#: Use Fiji's built-in [[Report a Bug]] command. Alternatively, report it to the [http://imagej.nih.gov/ij/list.html ImageJ mailing list]. Don't forget to include the steps needed to reproduce the problem.
#<span id="faq16"></span>'''My version is not the latest after running <span style="border-bottom:1px dotted #ccc;">Help▷ Update Fiji...</span> Why?'''
#:You have manually installed/modified ''Sholl_Analysis.jar'' ([[#Release Notes and Pre-releases|Development build]]?). Run the [[Update Fiji|Updater]], choose ''Advanced Mode'' then ''View locally modified files'' under ''View Options''. Type "Sholl" in the ''Search'' field, selecting ''Sholl_Analysis.jar'' from the list of files. If the ''Details pane'' indicates an available update, click on ''Locally modified'' under ''Status/Action'' and choose ''Install/Update''. The latest release version will be available once you press ''Apply changes''.
#<span id="faq17"></span>'''This documentation is not that useful. How long do I have to wait until it gets improved?'''
#: Around 20 seconds. This is the time it will take you to [[Help:Contents#New_accounts|create an account]] on this wiki. Once you have created one, you will be able to improve this page yourself.

== Non-Fiji users ==
If you are not using Fiji, download ''Sholl_Analysis.jar'' from the direct link listed on the [[#top|top of this page]] and place it in the ''ImageJ/plugins/'' directory. Alternatively, drag the downloaded jar and drop it on the main window. Restart ImageJ and run the new <span style="border-bottom:1px dotted #ccc;">Analyze▷ Sholl Analysis...</span> command.

Please note that Fiji is the most convenient way of keeping your ImageJ distribution up-to-date. Without access to Fiji's [[Update_Fiji|built-in updater]], you are strongly advised to upgrade ImageJ to its latest version using <span style="border-bottom:1px dotted #ccc;">Help▷ Update ImageJ...</span> Without Fiji, you will also have to manually update the Sholl Analysis plugin by checking the [https://github.com/tferr/ASA/blob/master/Notes.md#release-notes-for-sholl-analysis Release Notes].

== Release Notes and Pre-releases ==
Releases notes are available on [https://github.com/tferr/ASA/blob/master/Notes.md#release-notes-for-sholl-analysis Github]. If you do not mind unstable software, [https://github.com/tferr/ASA/blob/master/Notes.md#development-builds development builds] may be found [http://jenkins.imagej.net/job/Sholl-Analysis here]. Once new features mature and no major issues are found these development versions will be made available as usual.

== Related Links ==
* '''[[Simple_Neurite_Tracer|Simple Neurite Tracer]]''' Mark Longair's plugin for semi-automated three-dimensional tracing, featuring [[Simple_Neurite_Tracer:_Sholl_analysis|Sholl analysis]] for traced cells

* '''[[Strahler_Analysis|Strahler_Analysis]]''' Strahler Analysis on [[Skeletonize3D|skeletonized]] arbors.

* '''[http://www.imagescience.org/meijering/software/neuronj/ NeuronJ]''' ImageJ plugin for semi-automated tracing and quantification of two-dimensional arbors

* '''[http://www.reading.ac.uk/neuromantic/ Neuromantic]''' Standalone program for (semi-manual/semi-automatic) neuronal reconstruction

== References ==
<references/>

== License ==
This program is free software; you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the [http://www.gnu.org/licenses/gpl.txt Free Software Foundation]. This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License for more details.

[[Category:Plugins]]
[[Category:Analysis]]
