{{Infobox Plugin
| software        = ImageJ
| name             = Bitmap Sholl Analysis
| author           = Tiago Ferreira
| source           = {{GitLink|jar=Sholl_Analysis}}
| filename        =  [http://jenkins.imagej.net/job/Stable-Fiji/ws/Fiji.app/plugins/Sholl_Analysis-3.0.0-SNAPSHOT.jar Sholl_Analysis.jar]
| latest version = v3.1 (July 2013)
| released         = December 2012
| status            = stable, active
| category       = [[:Category:Plugins|Plugins]], [[:Category:Analysis|Analysis]]
}}

Bitmap Sholl for 2D and 3D images. For analysis of traced arbors have a look at [[#Importing|Importing Profiles Obtained Elsewhere]].

<div style="float:right;
            border: 1px solid #ccc;
            padding: 5px !important;
            border-radius: .75em;
            -moz-border-radius: .75em;
            -webkit-border-radius: .75em;
            margin-top: 11em;
            background-color: #f9f9f9;">
'''Non-Fiji User?'''
: Jump to [[#Non-Fiji_users|Installation notes]]
'''Having Problems?'''
: Jump to [[#FAQ|FAQs]]
</div>

== Introduction ==
[[ File:BitmapSholl-CA1mask.png|frame|[[Skeletonize3D|Skeletonized]] Mouse hippocampal CA1 cell <ref name="Gross">TA Ferreira, LL Iacono and CT Gross. Serotonin receptor 1A modulates actin dynamics and restricts dendritic growth in hippocampal neurons. Eur J Neurosci 32(1):18-26, Jul 2010 [http://www.ncbi.nlm.nih.gov/pubmed?term=20561047 PMID: 20561047]</ref> in which apical and basal dendrites have been analyzed separately and color coded according to their Sholl profile. Warmer hues indicate higher number of Intersections (''N''). [[#CriticalRadius|Critical radius]] (''rc'') and [[#MeanValueOfFunction|Mean value]] (''Nav'') are indicated.]]
This plugin performs 2D and 3D Sholl on grayscale images of single neurons. Sholl<ref name="Sholl">DA Sholl. Dendritic organization in the neurons of the visual and motor cortices of the cat. J Anat, 87(4):387–406, Sep 1953, [http://www.ncbi.nlm.nih.gov/pubmed?term=13117757  PMID: 13117757]</ref> is a popular technique used by neuroanatomists to describe neuronal arbors. The major advantages of this plugin over other implementations are:
* It does not require previous tracing of the arbor
* Retrieves quantitative descriptors from the Sholl profile, allowing statistical comparisons between arbors
* Performs <i>Continuous Sholl</i> around arbitrary foci

Its internal algorithm is based upon how Sholl analysis is done by hand — it creates a series of concentric circles/spheres around the focus of a neuronal arbor, and counts how many times the arbor intersects the sampling circles/spheres. Nevertheless, it takes this task beyond conventional approaches by offering [[#Multiple Samples and Noise Reduction|repeated sampling]] and several [[#Sholl Methods|analysis methods]] including Linear with [[#MeanValueOfFunction|mean value of function]]<ref name="Stulic">D Ristanović, NT Milosević and V Stulić. Application of modified Sholl analysis to neuronal dendritic arborization of the cat spinal cord. J Neurosci Methods, 158(2):212–8, Dec 2006, [http://www.ncbi.nlm.nih.gov/pubmed?term=16814868 PMID: 16814868]</ref>, Semi-log and Log–log.


== Usage ==
The plugin requires a binary image or a segmented grayscale image containing a single neuron.

# Segment the arbor using <u>Image▷Adjust▷Threshold...</u>
# Select the center of analysis with the Point Selection Tool. Alternatively, make a Straight Line Selection from the focus of the arbor to its most distal point. This will automatically set both the center and [[#EndRadius|Ending radius]].
# Run <u>Analyze▷Sholl Analysis...</u>, adjusting the default [[#Parameters|Parameters]] in the dialog prompt.
# '''Problems? Read the  [[#FAQ|FAQs]]'''.

== Parameters ==
Input values take into account the scale information of the image that can be set using the <u>Analyze▷Set Scale...</u> or <u>Image▷Properties...</u> commands. The prompt is organized into 5 sections:

==== Definition of Shells ====
* <span id="StartRadius"></span>'''Starting radius''' <sup>&nbsp;</sup>The radius of the smallest sampling circle/sphere, i.e., the first distance to be sampled.

* <span id="EndRadius"></span>'''Ending radius''' <sup>&nbsp;</sup>The radius of the largest sampling circle/sphere. Note that this distance may not be actually sampled, if ''Radius step size'' is not a divisor of ''Ending radius''-''Starting radius''.
: '''Tip:''' You can clear this field (or set it to ''NaN'') to sample the entire image. This is particularly useful when running the plugin from a [[#Batch_Processing|macro]] that processes images with different dimensions.

* <span id="StepSize"></span>'''Radius step size''' <sup>&nbsp;</sup>The sampling interval between radii of consecutive sampling circles/spheres. This value may be set to zero for continuous (1-voxel increment) measurements.
:For anisotropic images, setting ''Radius step size'' to zero, sets the step length to the dimension of a matching isotropic voxel, i.e., the square root of the product of the pixel dimensions (2D images) or the cube root of the product of the voxel dimensions (image stacks).

* '''Restrict analysis to hemicircle/hemisphere''' <sup>&nbsp;</sup>This option is only available when an orthogonal radius has been created (by holding Shift when using the Straight Line Selection Tool). It can be used to limit the analysis to sub-compartments of the arbor (e.g., apical vs basal dendrites, in the case of pyramidal neurons, as in illustration above).
:For horizontal lines, this option instructs the algorithm to measure intersections at sites equidistant from the center that have y-coordinates above/below the drawn line. For vertical lines, it instructs the plugin to measure intersections at sites equidistant from the center that have x-coordinates to the left/right of the drawn line.

==== Multiple Samples and Noise Reduction ====
[[ File:BitmapSholl-Prompt_v3.png|right ]]
* '''Samples per radius ''(2D images only)''''' <sup>&nbsp;</sup>Defines the number of measurements to be performed at each sampling circumference. These measurements are then combined into a single value according to the chosen [[#SamplesIntegration|integration method]]. This strategy, a break from previous approaches, increases the accuracy of non-continuos profiles by diluting out the effect of processes extending tangent to the sampling circumference.
:Visually, this option can be imagined as the "thickness" of the sampling circumference: e.g.: for a radius of 100 pixels and a value of 3 ''Samples per radius'', the final number of intersections would integrate the measurements sampled at distances 99, 100 and 101.
:Note that it would not make sense to increase the number of samples beyond the length of ''Radius step size''. For this reason, this option is limited to a draconian (and arbitrary) maximum of 10 samples.

* <span id="SamplesIntegration"></span>'''Samples integration ''(2D images only)''''' <sup>&nbsp;</sup>The statistical function used to combine intersection counts when multiple ''Samples per radius'' are used. Options are mean or median.

* '''Ignore isolated (6-connected) voxels ''(3D images only)''''' <sup>&nbsp;</sup>If checked, single isolated voxels intersecting the surface of sampling spheres are not taken into account, which may allow for smoother profiles on noisy stacks. However, it should be noted that connectivity in the stack volume may not reflect connectivity on the surface of a digitized sphere. Indeed, in certain contexts, it is possible (though unlikely) to obtain higher intersection counts when this filtering option is active.
:Please keep in mind that this is just a refinement feature, and you should not expect it to mitigate the effects derived from ill-segmented arbors.

==== Ramification Indices and Curve Fitting ====
* <span id="PrimaryBranches"></span>'''Number of Primary branches''' The number of primary branches (i.e., those originating directly from cell soma when the center of analysis is the perikaryon) to be used in the calculation of [[#SchoenenSampled|Schoenen ramification indices]].<br><br>
** '''Infer from Starting radius''' If checked, the ''Number of Primary branches'' is inferred from the count of intersections at [[#StartRadius|Starting radius]].

* '''Fit profile and compute descriptors''' <sup>&nbsp;</sup>If checked, data is fitted according to the chosen  [[#Sholl_Methods|method]] and appropriate [[#Descriptors|descriptors]] calculated. If unchecked, only sampled data is plotted.<br><br>
** '''Show fitting details''' <sup>&nbsp;</sup>Choose this option to have all of the parameters of the simplex fitting printed to the Log window. The [http://en.wikipedia.org/wiki/Coefficient_of_determination coefficient of determination] (''R<sup>2</sup>'', a measure of goodness of fit) is always stored in the ''Sholl Results'' table even when this option is not selected.

==== Choice of Method(s) ====
The [[#MethodsTable|type]] of profile(s) to be obtained. ''Linear'' (profile without normalization), or normalized profiles: ''Linear-norm'', ''Semi-log'', or ''Log-log''.
* '''Polynomial''' <sup>&nbsp;</sup> Specifies the degree of the [[#MethodsTable|polynomial]] to be fitted to the ''Linear'' profile: 4<sup>th</sup>–8<sup>th</sup> degree. While the polynomial of best approximation, or "best fit", should be empirically determined for each analyzed cell type, it is possible to ask the plugin to predict the order of the fitting polynomial (or at least try) using the choice ''Best fitting degree''. In this case, the plugin will loop through all the available choices of polynomials, perform each fit int the background and choose the one with the highest coefficient of determination.
:The ''Best fitting degree'' choice is obviously much more computer-intensive and can be monitored by activating the ''Show fitting details'' checkbox.
* <span id="Normalizer"></span>'''Normalizer''' The property of the sampling shell to be used in the normalization of ''Linear-norm'', ''Semi-log'', and ''Log-log'' profiles. It is [[#MethodsTable|described below]].

==== Output Options ====
* '''Create intersections mask''' <sup>&nbsp;</sup>If checked, a 16–bit maximum intensity projection of the analyzed image is generated in which the measured arbor is painted according to its Sholl profile.<p>The default Lookup Table used by the mask is modeled after the [http://www.mathworks.com/help/matlab/ref/colormap.html MATLAB "jet" color map] (a rainbow color map based on a fluid-jet simulation by NCSA) but you can apply any of your favorite LUTs using the <u>Image▷Lookup Tables▷</u> submenu. WYSIWYG versions (RGB images) of these masks can be otained using <u>Image▷Overlay▷Flatten</u> or <u>Analyze▷Tools▷Calibration Bar...</u></p>
** '''Background''' <sup>&nbsp;</sup>The background color (gray level) of the mask from 0 (black) to 255 (white). It can be changed at any later point using <u>Image▷Color▷Edit Lut...</u> or <u>Image▷Lookup Tables▷[[#Auxiliary Commands|Sholl LUT]]</u>.

* '''Save results on image directory ''(only available when image is saved locally)''''' <sup>&nbsp;</sup> If checked, all the results (with the exception of the ''[[#Descriptors|Sholl Table]]'') are saved to the image directory. These include: 1) Sholl plots (saved as PNG images), 2) A table containing detailed data (saved according to the extension and format specified in <u>Edit▷Options▷Input/Output...</u>) and 3) The Sholl mask (saved as a 16-bit TIFF).<p>Files are named after the image filename and analysis method. When this option is not available, profiles can always be retrieved using the ''List'', ''Save...'' and ''Copy...'' commands at the bottom of plot windows.</p>
** '''Do not display saved files''' If checked, saved files are directly saved to disk and are not displayed. Activate this option when [[#Batch_Processing|batch processing]] files.


== Sholl Methods ==
<center>
<span id="ShollPlots"></span>[[File:ShollPlots.png|center|]]

'''''Linear'', ''Linear-norm'', ''Semi-log'' and ''Log-log'' profiles for the ddaC cell (File▷Open Samples▷ddaC Neuron)'''. Most of the retrieved [[#Descriptors_based_on_fitted_data|Descriptors]] are automatically highlighted by the plugin. ''Linear profile'': [[#MeanValueOfFunction|Mean value]] (horizontal grid line) and [[#Centroid|Centroid]] (colored mark). Logarithmic profiles: The [[#ShollDecay|Sholl regression coefficient]] (also known as Sholl decay) can be retrieved by linear regression using either the full range of data (blue line) or data within percentiles 10–90 (red line).  For this particular cell type, the Semi-log method is more informative when compared to the Log-log method.


<span id="MethodsTable"></span>
{| style="padding: 60px;" rules="rows"
! align="Center"| &nbsp;
!style="height: 2em;"| Method
! Fit
! Description
|-
| <span id="eq1">(1)</span>&nbsp;&nbsp;
|style="white-space:nowrap"| Linear
|style="white-space:nowrap"|&nbsp;&nbsp; <i>N</i> = a + br + cr<sup>2</sup> + dr<sup>3</sup>  + er<sup>4</sup> + fr<sup>5</sup> + ... + ir<sup>8</sup>&nbsp;&nbsp;
| &nbsp;&nbsp;&nbsp;<br>Outputs a ''N vs Distance'' profile. Data is fitted to a polynomial function<ref name="Stulic"/>. [[#CriticalRadius|Critical radius]], [[#CriticalValue|Critical value]] and [[#MeanValueOfFunction|Mean value of function]] are calculated<br>&nbsp;
|-
| <span id="eq2">(2)</span>&nbsp;&nbsp;
|style="white-space:nowrap"|  Linear-norm
|style="white-space:nowrap"|&nbsp;&nbsp; ''N/S'' = a r<sup>b</sup>
| &nbsp;<br>Outputs a <i>N/S vs Distance</i> profile. Points are fitted to a power function. It is an intermediate representation of the data that can be used to gauge the choice of [[#Normalizer|normalizer]]. Once plotted under a logarithmic scale the Linear-norm curve is similar to the Semi-log profile<br>&nbsp;
|-
| <span id="eq3">(3)</span>&nbsp;&nbsp;
|style="white-space:nowrap"|  Semi-log
|style="white-space:nowrap"|&nbsp;&nbsp; log(''N/S'') = -k r + m
|&nbsp;<br>Outputs a <i>log(N/S) vs Distance</i> profile. A linear regression is fitted to the sampled data. The [[#ShollDecay|Sholl regression coefficient]] (''k'') is calculated<br>&nbsp;
|-
| <span id="eq4">(4)</span>&nbsp;&nbsp;
|style="white-space:nowrap"| Log-log
|style="white-space:nowrap"|&nbsp;&nbsp;  log(''N/S'') = -k × log(r) + m
|&nbsp;<br>Outputs a <i>log(N/S) vs log(Distance)</i> profile. Data is also fitted to a straight line. This is an alternative approach<ref name="Ristanovic"></ref> of obtaining a relevant [[#ShollDecay|regression coefficient]], when the Semi-log method returns a poor fit<br>&nbsp;
|}
</center>


<span style="display: inline-block; width: 25px">'''''N'''''</span> For 2D images, the <u>N</u>umber of clusters of pixels (8–connected) intersecting the circumference of radius ''r''<br>
<span style="display: inline-block; width: 25px">&nbsp;</span> For 3D images, the <u>N</u>umber of clusters of voxels (26-connected) intersecting the surface of the sphere of radius ''r''

<span style="display: inline-block; width: 25px">'''''r'''''</span> Distance from center of analysis (<u>r</u>adius of Sholl circle/sphere)

<span style="display: inline-block; width: 25px">'''''log'''''</span>Natural logarithm, the logarithm to the base ''e''

<span style="display: inline-block; width: 25px">'''''S'''''</span>The [[#Choice_of_Method(s)|chosen property ]] of the sampling shell to be used in the normalization of ''Linear-norm'', ''Semi-log'', and ''Log-log'' profiles.<br> <span style="display: inline-block; width: 25px">&nbsp;</span>For 2D images, the ''Perimeter'' of the sampling circumference (2πr) or the ''Area'' of the corresponding circle (πr<sup>2</sup>)<br> <span style="display: inline-block; width: 25px">&nbsp;</span>For 3D images, the ''Surface'' of the sampling sphere (4πr<sup>2</sup>) or its respective ''Volume'' (4/3πr<sup>3</sup>)<br>

'''N.B.''' A third [[#Normalizer|normalization option]] is also available when performing [[#StepSize|non-continuous sampling]]: ''Annulus'' / ''Spherical shell''.<br>
In this case, the normalization is performed against the area of the annulus formed between the circumferences at ''r'' ± ''Radius step size''/2 (2D images), or against the volume between the two spheres at ''r'' ± ''Radius step size''/2 (3D images).<br>



== Descriptors ==
Morphometric descriptors and other properties of the arbor are printed to a dedicated results table named ''Sholl Results''. Listed values can be displayed in scientific notation and with the precision specified in <u>Analyze▷Set Measurements...</u> The first columns log analysis parameters: ''Image filename and voxel unit'', ''Lower'' and ''Upper Threshold levels'', ''X,Y'' (in pixels) and ''Z'' (slice number) coordinates of center of analysis, ''Starting'' and ''Ending radius'', ''Radius step'', ''Number of Samples per Radius'', etc. Other parameters are described below.

[[File:BitmapSholl-Table.png|100%|center|Sholl Table]]


=== Descriptors based on sampled data ===
;Intersecting radii
:The number of sampling radii intersecting the arbor at least once.

;Sum of intersections (''Sum inters.'')
:The sum of all intersections.

;Mean of intersections (''Mean inters.'')
:''Sum inters.'' divided by ''Intersecting radii''.
: See also [[#MeanValueOfFunction|Mean value]]

;Median of intersections (''Median Inters.'')
:The median value of sampled intersections.

;<span id="MaxInters></span>Highest count of intersections (''Max inters.'')
:The maximum value of sampled intersections, i.e., the maximum in a linear [''N'' vs ''Distance''] profile (raw data), reflecting the number of processes/branches in the arbor. Note that if the same maximum occurs multiple times, only the first occurrence is considered.
: See also [[#CriticalValue|Critical value]]

;<span id="MaxIntersRadius></span>Radius of highest count of intersections (''Max inters. radius'')
:The distance at which the ''Highest count of intersections'' occurred, reflecting sites of highest branch density.
: See also [[#CriticalRadius|Critical radius]]

;<span id="SchoenenSampled"></span>Schoenen Ramification index (''Ramification index (sampled)'')
:A measure of ramification<ref name="Schoenen">J Schoenen. The dendritic organization of the human spinal cord: the dorsal horn. Neuroscience, 7(9):2057–87, Jan 1982, [http://www.ncbi.nlm.nih.gov/pubmed?term=7145088 PMID: 7145088]</ref>: the ratio between ''Max inters.'' and the number of [[#PrimaryBranches|primary branches]].
: See also [[#SchoenenFitted|Ramification index (CV)]]

;<span id="Centroid">Radius of centroid (''Centroid radius'')
:The abcissa of the centroid (i.e., the geometric center or barycenter) of the linear profile. It is [[#ShollPlots|highlighted]] on the ''N'' vs ''Distance'' plot.

;Centroid intersections (''Centroid inters.'')
:The ordinate of the centroid (i.e., the geometric center or barycenter) of the linear profile. It is [[#ShollPlots|highlighted]] on the ''N'' vs ''Distance'' plot.

;Enclosing radius
:The last (thus, the widest) of ''Intersecting radii''.


=== Descriptors based on fitted data ===
;<span id="ShollDecay"></span>Sholl regression coefficient (''Regression coefficient'')
:The | slope | ''k'' of the linear regression described in [[#eq3|(3)]] and [[#eq4|(4)]], a measure of the rate of decay of the number of branches with distance from the center of analysis<ref name="Ristanovic">NT Milosević and D Ristanović. The Sholl analysis of neuronal cell images: Semi-log or log-log method? J Theor Biol, 245(1):130–40, Mar 2007, [http://www.ncbi.nlm.nih.gov/pubmed?term=17084415 PMID: 17084415]</ref>. Higher ''k'' values reflect larger changes in the function log(N/S). To optimize the fit, the plugin retrieves a [[#ShollPlots|second linear regression]] centered around the median distance, excluding distances at the edges of the profile. Details of this second fit are also registered on the [[#Descriptors|''Sholl table'']] under dedicated columns, e.g., ''Sholl regression coefficient [P10-P90]'', when data within the 10<sup>th</sup>–90<sup>th</sup> percentile is used.

;Regression intercept
:The y-coordinate ''m'' described in [[#eq3|(3)]] and [[#eq4|(4)]].

;Regression R<sup>2</sup> (''Regression R^2'')
:The coefficient of determination of the linear regression described in [[#eq3|(3)]] and [[#eq4|(4)]].

;<span id="CriticalValue"></span>Critical value (CV)
:The local maximum of the polynomial fit, i.e, ''N'' at ''CR'' in [[#eq1|(1)]]. Sometimes abbreviated as ''N<sub>m</sub>''.
: See also [[#MaxInters|Max inters.]]

;<span id="CriticalRadius"></span>Critical radius (CR)
:The distance at which ''Critical value'' occurs. Calculated with a precision of 1/1000 of ''Radius step size''. Sometimes abbreviated as ''r<sub>c</sub>''.
: See also [[#MaxIntersRadius|Max inters. radius]]

<div style="float:center;
            border: 1px solid #ccc;
            padding: 5px !important;
            border-radius: .75em;
            -moz-border-radius: .75em;
            -webkit-border-radius: .75em;
            margin-bottom: 1em;
            background-color: #ffefbe;">
The terms [[#CriticalRadius|Critical radius (CR)]] and [[#CriticalValue|Critical value (CV)]] are arbitrary, and previous authors have used different terms to describe the largest value taken by the Sholl profile (cf. [http://en.wikipedia.org/wiki/Sholl_analysis Wikipedia]). Since Sholl analysis is not restricted to dendritic arbors (it can be applied to any tree-like structure such as axonal arbors,  mammary glands or blood vessels), this plugin introduces the term ''Critical radius'', renaming ''Dendrite maximum'' (''N<sub>m</sub>'') to ''Critical value''. Thus, we may not follow the conventions adopted by [[Simple_Neurite_Tracer:_Sholl_analysis|Simple Neurite Tracer]].</div>

;<span id="MeanValueOfFunction"></span>Mean value
:The mean value<ref name="Stulic"></ref> of the fitted polynomial function [[#eq1|(1)]], representing the average of intersections over the whole area occupied by the arbor. Sometimes abbreviated as MV or Nav.
:On the Sholl plot, it is [[#ShollPlots|highlighted]] as the height of the rectangle that has the width of ''Enclosing radius'' − ''First intersecting radius'' and the same area of the area under the fitted curve on that discrete interval. It is analogous to '''''Mean inters.''''', the arithmetic mean of sampled intersections throughout the arbor (cf. [[#Descriptors_based_on_sampled_data|Descriptors based on sampled data]]).

;<span id="SchoenenFitted"></span>Schoenen Ramification index (''Ramification index (CV)'')
:Schoenen Ramification index retrieved from fitted profile:  The ration between [[#CriticalValue|Critical value]] and  [[#PrimaryBranches|Number of primary branches]].
: See also [[#SchoenenSampled|Ramification index (sampled)]]

;Polynomial R<sup>2</sup> (''Polyn. R^2'')
:The coefficient of determination of the polynomial fit described in [[#eq1|(1)]].

<span id="Importing"></span>
== Importing Profiles Obtained Elsewhere ==
[[ File:BitmapSholl-TabularPrompt.png|right ]]As of version 3.1 it is possible to analyze profiles obtained from traced data. This feature is specifically targeted at users of [[Simple Neurite Tracer]], Fiji's remarkable framework for semi-automated reconstruction of neuronal arbors, but can be extended to tracings obtained by other programs.


This option is triggered by running  <u>Analyze▷ Sholl Analysis...</u> while holding the ''Alt'' key, which prompts a simplified version of the main dialog [[#Ramification Indices and Curve Fitting|described above]].

#Load tracings (typically a .swc or a .traces file) into [[Simple_Neurite_Tracer:_Basic_Instructions|Simple Neurite Tracer]]
#Retrieve the linear Sholl profile by following these [[Simple_Neurite_Tracer:_Sholl_analysis|instructions]]
#Export ''detailed data''  (.csv file). You now have two options:
:If data does not need to be edited:
:#Empty/close the ImageJ Results Table (if open) and run the plugin while holding the ''Alt'' key.  You will be prompted to indicate the path of the saved  profile. Because the plugin is aware of the file's directory, saving options are available.
:If data needs to be modified, the profile must be first loaded by ImageJ:
:#You can do so by dragging & dropping its file into the main ImageJ window, or by using <u>File▷ Import▷ Results...</u>
:#Press the backspace key over selected rows to exclude them from the analysis.
:#Run the plugin while holding the ''Alt'' key. Because the plugin did not keep track of any directory, saving options are disabled.

Notes:
*For ''Annulus/Spherical shell'' normalization [[#StepSize|Radius step size]] is calculated from the difference between the first two rows in ''Distance column''.
*In a [[#Batch_Processing|macro]], the [http://imagej.nih.gov/ij/developer/macro/functions.html#setKeyDown setKeyDown("alt")] macro function can be used to prompt tabular data.


== Batch Processing ==
It is fairly simple to automate the analysis of multiple images using any of the scripting languages supported by ImageJ and Fiji (see  [[Introduction into Macro Programming|ImageJ Macro Language]], [[Beanshell_Scripting|Beanshell]], [[Javascript_Scripting|Javascript]], [[JRuby_Scripting|JRuby]], [[Jython_Scripting|Jython]], and [[Clojure_Scripting|Clojure]] (see also [[Script Editor]] and  [[Scripting Help]]).

Independently of which strategy is used, the Sholl Analysis plugin will need to access the ROI marking the center of analysis.  One could instruct ImageJ to read the coordinates of pre-existing ROIs from a text file, store a list of line selections in the ROI Manager, or write a morphology-based routine that detects the center of analysis. However, marking the center of analysis is probably something that you will want to do manually.

:'''When working with ROIs, it is critical that you work with .tif files because only this format keeps track of image overlays'''. If you use any other format, any selection you create is lost as soon as you close the image. The <u>Process▷ Batch▷ Convert...</u> command allows bulk conversion between image formats.

Here is a routine using the ImageJ macro language:

#'''Place all the .tif images to be processed in a single folder'''.
#Select the Point Selection Tool in the main ImageJ window and activate the Threshold widget (<u>Image▷ Adjust▷ Threshold...</u>). '''Make sure ''Set stack positions'' is active in the <u>Image▷ Overlay▷ Overlay Options...</u> prompt'''. Open the first image.
#'''Adjust threshold levels'''. Press the ''Apply'' button of the Threshold widget to create a binary image.
#Select the z-slice containing the center of analysis. '''Click over the center with the Point Selection Tool and press ''B''''' (shortcut for <u>Image▷ Overlay▷ Add Selection...</u>). This will add the point ROI to the image overlay. Save the image as .TIFF by pressing ''S'' (<u>File▷ Save As...▷ Tiff...</u>).
#'''Repeat the last 2 steps''' until all images are marked. '''Tip:''' Use ''Shift'' + ''O'' (shortcut for <u>File▷ Open Next</u>) to iterate rapidly through all the images.

Now that all the images are marked, we just need a working macro. We will open the Macro Recorder (<u>Plugins▷ Macros▷ Record...</u>) and run ''Sholl Analysis'' on one of the images to find out how to call the plugin with suitable parameters. The single line of code that appears in the recorder window will look something like this:
<source lang="java">
run("Sholl Analysis...", "starting=10 ending=400 radius_step=0 infer fit linear polynomial=[8th degree] semi-log normalizer=Volume create save do");
</source>


Now, we just need to assemble a working macro to be pasted in the <u>Process▷ Batch▷ Macro...</u> prompt:
<source lang="java">
// Get the number of ROIs of the image overlay
nROIs = Overlay.size;

// We cannot proceed if no ROI is available (safety check)
if (nROIs==0)
   exit("No ROI was found. Cannot proceed.");

// Select the last ROI of the overlay. Because we have activated the "Set stack positions" option,
// this will automatically activate the Z-slice in which the ROI was created (3D images)
Overlay.activateSelection(nROIs-1);

// We now call the plugin as detailed by the Macro Recorder. We'll set 'Ending radius' to a non-numeric
// value (NaN, "Not a Value") to make sure the maximum length for each individual image is used
run("Sholl Analysis...", "starting=10 ending=NaN radius_step=0 infer fit linear polynomial=[8th degree] semi-log normalizer=Volume create save do");
</source>


Of course you can also automate any preceding steps. However, do not forget to ensure that the center of analysis will be available when the plugin is called:

<source lang="java">
// Impose spatial calibration
     run("Properties...", "unit=um pixel_width=1.5 pixel_height=1.5 voxel_depth=3.0");
// Subtract background
     run("Subtract Background...", "rolling=50 sliding stack");
// Apply a favorite threshold
    setAutoThreshold("Huang dark stack");
// >>>> Make sure the initial point selection remains available <<<<
    Overlay.activateSelection( Overlay.size - 1 );
// Run the plugin
run("Sholl Analysis...", "starting=10 ending=NaN radius_step=0 infer fit linear polynomial=[8th degree] semi-log normalizer=Volume create save do");
</source>

That's it. Use the Macro Recorder to generate the customizations you will need before parsing the entire folder of images with <u>Process▷ Batch▷ Macro...</u>

'''Tip:''' As you may have noticed, ImageJ plugins are controlled by a single sentence  in which arguments are separated by a space. Input fields and choice lists appear as ''keyword=value'' pairs, active checkboxes by a single keyword. Options that are not needed can be omitted. This makes it easier to generate customizable macros:

<source lang="java">
start = 10;  // variable that controls starting radius
end   = 200; // variable that controls ending radius
step  = 2;   // variable that controls step size

// Enter batch mode
setBatchMode(true);
// Run the plugin
run("Sholl Analysis...", "starting="+ start +" ending="+ end +"radius_step="+ step +" infer linear save do");
</source>

== Auxiliary Commands ==
;File▷Open Samples▷ddaC Neuron
:Opens a sample image of a Drosophila class IV ddaC sensory neuron in which dendrites have been previously segmented (2D arbor). Use it to get acquainted with the plugin. Run <u>Image▷Show Info...</u> to know more about this cell type.

;Image▷Lookup Tables▷Sholl LUT
: Adjusts the background color of the Sholl lookup table as specified in the main [[#Parameters|dialog prompt]].

;Help▷About Plugins▷About Sholl Analysis...
:Retrieves information about the plugin version and a link to its Git source code repository.

== FAQ ==
#'''Why do I need to threshold the cell?'''
#: Counting intersections is really a binary procedure: a shell either intercepts a branch or it doesn't. For this reason the image must be split in two phases: arbor and background.
#'''The plugin complains about a wrong image type. Why?'''
#: Although ImageJ can threshold RGB images, the plugin can only parse grayscale images (8-bit and 16-bit). Images of fluorescent-labeled cells are typically non-RGB images. Conversions between different image types is explained in the [http://imagej.nih.gov/ij/docs/guide/ ImageJ User Guide].
#'''I cannot see the hemicircle/hemisphere option. Why?'''
#: This option is only available if an orthogonal line has been created by holding Shift when using the Straight Line Selection Tool. See the [http://imagej.nih.gov/ij/docs/guide/ ImageJ User Guide] for the full list of key modifiers that can be used while creating straight line ROIS.
#'''With 3D images, How do I set the Z-position of the center?'''
#: The Z-position (depth) of the center of analysis is the active Z-slice of the stack. It is reported in the ''Sholl Results'' table.
#'''Why so many parameters?'''
#:The plugin is designed for the analysis of a wide diversity of arbors and it is not biased to any particular cell type. The only way to ensure this is by giving users full control over the mathematical techniques used by the plugin to analyze sampled data.
#'''How can I save/edit the ''Sholl Results'' table?'''
#: Select the table, then choose <u>File▷ Save As…</u>The filename extension can be specified using the <u>Edit▷ Options▷ Input/Output…</u> command (see the [http://imagej.nih.gov/ij/docs/guide/ ImageJ User Guide] for details). Single cells cannot be modified from within ImageJ, but custom extensions (e.g., .csv, .xls or .ods) will allow the table to be imported by other spreadsheet applications.
#'''Can I modify the number of decimal places used by the ''Sholl Results'' table?'''
#: Yes. Use the options ''Decimal places'' and ''Scientific notation'' in <u>Analyze▷ Set Measurements…</u>
#'''I cannot see the option to save the results. Why?'''
#: The image you are trying to analyze is not saved locally. Saving it to a local directory (e.g., your Desktop or Home folder) should re-enable it.
#'''What can I do with the ''Sholl mask''?'''
#:
#'''The 3D profile looks worse than the 2D profile of the Maximum Intensity Projection of the same cell. Why?'''
#:
#'''The shape of the polynomial changes at the edges of the profile. Why?'''
#:
#'''My images do not look that great. How can I treat them prior to analysis?'''
#:
#'''I found a bug. How do I report it?'''
#: Use Fiji's built-in [[Report a Bug]] command. Alternatively, report it to the [http://imagej.nih.gov/ij/list.html ImageJ mailing list]. Don't forget to include the steps needed to reproduce the problem.
#'''This documentation is not that useful. How long do I have to wait until it gets improved?'''
#: Around 20 seconds. This is the time it will take you to [[Help:Contents#New_accounts|create an account]] on this wiki. Once you have created one, you will be able to improve this page yourself.

== Non-Fiji users ==
If you are not using Fiji, download ''Sholl_Analysis.jar'' from the direct link listed on the [[#top|top of this page]] and place it in the ''ImageJ/plugins/'' directory. Alternatively, drag the downloaded jar and drop it on the main window. Restart ImageJ and run the new <u>Analyze▷Sholl Analysis...</u> command.

Please note that Fiji is the most convenient way of keeping your ImageJ distribution up-to-date. Without access to Fiji's [[Update_Fiji|built-in updater]], you are strongly advised to upgrade ImageJ to its latest version using <u>Help▷Update ImageJ...</u>. Without Fiji, you will also have to manually update the Sholl Analysis plugin by checking the [https://github.com/tferr/ASA/blob/master/Notes Release Notes].

== Related Links ==
* '''[[Simple_Neurite_Tracer|Simple Neurite Tracer]]''' Mark Longair's plugin for semi-automated three-dimensional tracing, featuring [[Simple_Neurite_Tracer:_Sholl_analysis|Sholl analysis]] for traced cells

* '''[[Strahler_Analysis|Strahler_Analysis]]''' Strahler Analysis on [[Skeletonize3D|skeletonized]] arbors.

* '''[http://www.imagescience.org/meijering/software/neuronj/ NeuronJ]''' ImageJ plugin for semi-automated tracing and quantification of two-dimensional arbors

* '''[http://www.reading.ac.uk/neuromantic/ Neuromantic]''' Standalone program for (semi-manual/semi-automatic) neuronal reconstruction

== References ==
<references/>

== Release Notes ==
Available [https://github.com/tferr/ASA/blob/master/Notes here].

== License ==
This program is free software; you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the [http://www.gnu.org/licenses/gpl.txt Free Software Foundation]. This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License for more details.

[[Category:Plugins]]
[[Category:Analysis]]
