{{Infobox Plugin
| software        = ImageJ
| name            = Bitmap Sholl Analysis
| author          = Tiago Ferreira
| source          = {{GitLink|jar=Sholl_Analysis}}
| filename        =  [http://jenkins.imagej.net/job/Stable-Fiji/ws/Fiji.app/plugins/Sholl_Analysis-3.0.0-SNAPSHOT.jar Sholl_Analysis.jar]
| released        = December 2012
| status          = stable
| category       = [[:Category:Plugins|Plugins]], [[:Category:Analysis|Analysis]]
}}

Bitmap Sholl for 2D and 3D images. For the ImageJ plugin, visit the  [http://imagejdocu.tudor.lu/doku.php?id=plugin:analysis:asa:start ImageJ wikipage]. For analysis of traced arbors have a look at [[Simple_Neurite_Tracer:_Sholl_analysis|Simple Neurite Tracer]].

== Introduction ==
[[ File:BitmapSholl-CA1mask.png|frame|Mouse hippocampal CA1 cell <ref name="Gross">TA Ferreira, LL Iacono and CT Gross. Serotonin receptor 1A modulates actin dynamics and restricts dendritic growth in hippocampal neurons. Eur J Neurosci 32(1):18-26, Jul 2010 [http://www.ncbi.nlm.nih.gov/pubmed?term=20561047 PMID: 20561047]</ref> in which apical and basal dendrites have been analyzed separately and color coded according to their Sholl profile. Warmer hues indicate higher number of Intersections (''N''). Critical radius (''rc'') and average number of intersections (''Nav'') are indicated.]]
This plugin performs 2D and 3D Sholl on grayscale images of single neurons. Sholl<ref name="Sholl">DA Sholl. Dendritic organization in the neurons of the visual and motor cortices of the cat. J Anat, 87(4):387–406, Sep 1953, [http://www.ncbi.nlm.nih.gov/pubmed?term=13117757  PMID: 13117757]</ref> is a popular technique used by neuroanatomists to describe neuronal arbors. The major advantages of this plugin over other implementations are:
* It does not require previous tracing of the arbor
* Retrieves quantitative descriptors from the Sholl profile, allowing statistical comparisons between arbors
* Performs <i>Continuous</i> Sholl around arbitrary foci

Its internal algorithm is based upon how Sholl analysis is done by hand — it creates a series of concentric circles/spheres around the focus of a neuronal arbor, and counts how many times the arbor intersects the sampling circles/spheres. Nevertheless, it takes this task beyond conventional approaches offering several [[#Sholl Methods|analysis methods]]: Linear (N) with mean value of function<ref name="Stulic">D Ristanović, NT Milosević and V Stulić. Application of modified Sholl analysis to neuronal dendritic arborization of the cat spinal cord. J Neurosci Methods, 158(2):212–8, Dec 2006, [http://www.ncbi.nlm.nih.gov/pubmed?term=16814868 PMID: 16814868]</ref>, Linear (N/S), Semi-log and Log–log.


== Usage ==
The plugin requires a binary image or a segmented grayscale image containing a single neuron.

# Segment the arbor using <u>Image▷Adjust▷Threshold...</u>
# Select the center of analysis with thePoint Selection Tool. Alternatively, make a Straight Line Selection from the focus of the arbor to its most distal point. This will automatically set both the center and ''Ending radius''.
# Run <u>Analyze▷Sholl Analysis...</u>, adjusting the default [[#Parameters|Parameters]] in the dialog prompt.
# '''Problems? See the  [[#FAQ|FAQs section]]'''.

== Parameters ==
Input values take into account the scale information of the image that can be set using the <u>Analyze▷Set Scale...</u> or <u>Image▷Properties...</u> commands.

* '''Starting radius''' <sup>&nbsp;</sup>The radius of the smallest sampling circle/sphere, i.e., the first distance to be sampled. The [[#Descriptors|Schoenen Ramification index (RI)]] assumes that this radius intercepts only primary branches.

* '''Ending radius''' <sup>&nbsp;</sup>The radius of the largest sampling circle/sphere. Note that this distance may not be actually sampled, if ''Radius step size'' is not a divisor of ''Ending radius''-''Starting radius''. '''You can clear this field''' (or set it to ''max'' or ''NaN'') to sample the entire image. This is particularly useful when running the plugin from a macro that processes images with different dimensions.

* '''Radius step size''' <sup>&nbsp;</sup>The sampling interval between radii of consecutive sampling circles/spheres. This value may be set to zero for continuous (1-voxel increment) measurements.
:For anisotropic images, setting ''Radius step size'' to zero, sets the step length to the dimension of a matching isotropic voxel, i.e., the square root of the product of the pixel dimensions (2D images) or the cube root of the product of the voxel dimensions (image stacks).
[[ File:BitmapSholl-Prompt_v3.png|right ]]

* '''Samples per radius ''(2D images only)''''' <sup>&nbsp;</sup>Defines the number of measurements to be performed at each sampling circumference. These measurements are then combined into a single value according to the chosen integration method (see ''Samples integration''). This strategy, a break from previous approaches, increases the accuracy of non-continuos profiles by diluting out the effect of processes extending tangent to the sampling circumference.
:Visually, this option can be imagined as the "thickness" of the sampling circumference: e.g.: for a radius of 100 pixels and a value of 3 ''Samples per radius'', the final number of intersections would integrate the measurements sampled at distances 99, 100 and 101.
:Note that it would not make sense to increase the number of samples beyond the length of ''Radius step size''. For this reason, this option is limited to a draconian (and arbitrary) maximum of 10 samples.

* '''Samples integration ''(2D images only)''''' <sup>&nbsp;</sup>The statistical function used to combine intersection counts when multiple ''Samples per radius'' are used. Options are mean or median.

* '''Sholl Method''' <sup>&nbsp;</sup>The type of profile to be retrieved: Intersections (N), Intersections/Area (N/S), Semi-log or Log–log. These are described [[#Sholl Methods|below]].

* '''Restrict analysis to hemicircle/hemisphere''' <sup>&nbsp;</sup>This option is only available when an orthogonal radius has been created (by holding Shift when using the Straight Line Selection Tool).
:It can be used to limit the analysis to sub-compartments of the arbor (e.g., apical vs basal dendrites, in the case of pyramidal neurons, as in illustration above).
:For horizontal lines, this option instructs the algorithm to measure intersections at sites equidistant from the center that have y-coordinates above/below the drawn line. For vertical lines, it instructs the plugin to measure intersections at sites equidistant from the center that have x-coordinates to the left/right of the drawn line.

* '''Ignore isolated (6-connected) voxels ''(3D images only)''''' <sup>&nbsp;</sup>If checked, single isolated voxels intersecting the surface of sampling spheres are not taken into account, which may allow for smoother profiles on noisy stacks. However, it should be noted that connectivity in the stack volume may not reflect connectivity on the surface of a digitized sphere. Indeed, in certain contexts, it is possible (though unlikely) to obtain higher intersection counts when this filtering option is active.
:Please keep in mind that this is just a refinement feature, and you should not expect it to mitigate the effects derived from ill-segmented arbors.

* '''Fit profile and compute descriptors''' <sup>&nbsp;</sup>If checked, data is fitted according to the chosen Sholl Method and respective [[#Descriptors|descriptors]] calculated. If unchecked, only sampled data is plotted.
** '''Polynomial''' <sup>&nbsp;</sup> Specifies the degree of the polynomial to be fitted to the ''Intersections'' profile ("Traditional Sholl"): 4<sup>th</sup>-8<sup>th</sup> degree. Note that the "polynomial of best fit" must be empirically determined for each analyzed cell type.
** '''Show parameters''' <sup>&nbsp;</sup>Choose this option to have all the details on the simplex fitting printed to the Log window. The coefficient of determination (''R<sup>2</sup>'', a measure of goodness of fit) is always stored in the ''Sholl Results'' table even when this option is not selected.

* '''Create intersections mask''' <sup>&nbsp;</sup>If checked, a 32–bit maximum intensity projection of the analyzed image is generated in which the measured arbor is painted according to its Sholl profile. The analysis method is indicated on the mask title and label, the line of information above the image canvas.<p>The default Lookup Table used by the mask is modeled after the [http://www.mathworks.com/help/matlab/ref/colormap.html MATLAB "jet" color map] (a rainbow color map based on a fluid-jet simulation by NCSA) but you can apply any of your favorite LUTs using the <u>Image▷Lookup Tables▷</u> submenu. WYSIWYG (RGB) versions of these masks can be otained using <u>Image▷Overlay▷Flatten</u> or <u>Analyze▷Tools▷Calibration Bar...</u></p>
** '''Background''' <sup>&nbsp;</sup>The background color (gray level) of the mask from 0 (black) to 255 (white). It can be changed at any later point using <u>Image▷Color▷Edit Lut...</u> or <u>Image▷Lookup Tables▷[[#Auxiliary Commands|Sholl LUT]]</u>.

* '''Save results on image directory ''(only available when image is saved locally)''''' <sup>&nbsp;</sup> If checked, all the results (with the exception of the ''[[#Descriptors|Sholl Table]]'') are saved to the image directory. These include: 1) The Sholl plot (saved as PNG image), 2) A table containing sampled, transformed, normalized and fitted data (saved according to the extension and format specified in <u>Edit▷Options▷Input/Output...</u>) and 3) The Sholl mask (saved as a 32-bit TIFF). Files are named after the image filename and ''Sholl Method'' choice.
:When this option is not available, profile values can always be retrieved using the ''List'', ''Save...'' and ''Copy...'' commands at the bottom of the plot window.

== Sholl Methods ==
<br>
<center>
{| style="padding: 60px;" rules="rows"
! align="Center"| &nbsp;
!style="height: 2em;"| Method
! Fit
! Description
|-
| (1)&nbsp;&nbsp;
| Linear (N)
|style="white-space:nowrap"|&nbsp;&nbsp; <i>N</i> = a + br + cr<sup>2</sup> + dr<sup>3</sup>  + er<sup>4</sup> + fr<sup>5</sup> + ... + ir<sup>8</sup>&nbsp;&nbsp;
| &nbsp;<br>Outputs a "traditional" [''N'' vs ''Distance''] profile. Data is fitted to a 5<sup>th</sup>-8<sup>th</sup> order polynomial<ref name="Stulic"/> .Critical radius (C<sub>r</sub>), Critical value (C<sub>v</sub> or N<sub>m</sub>) and Mean value of function (N<sub>avg</sub>) are calculated<br>&nbsp;
|-
| (2)&nbsp;&nbsp;
| Intersections/Area&nbsp;(N/S)&nbsp;&nbsp;
| ''N/S'' = a r<sup>b</sup>
| &nbsp;<br>Outputs a [<i>N/S</i> vs <i>Distance</i>] profile. Data is fitted to a power function<br>&nbsp;
|-
| (3)&nbsp;&nbsp;
| Semi-log
| log(''N/S'') = -k r + m
|&nbsp;<br>Outputs a 'Sholl decay plot', i.e., a [<i>log(N/S)</i> vs <i>Distance</i>] profile. A linear regression is fittedto the sampled data. The Sholl regression coefficient (''k'', the absolute value of the regression slope) is calculated.<br>''k'' is always calculated in the background even when other methods are chosen<br>&nbsp;
|-
| (4)&nbsp;&nbsp;
| Log-log
| log(''N/S'') = a <i>e</i><sup>−b &times; log(r)</sup> + c
|&nbsp;<br>Outputs a [<i>log(N/S)</i> vs <i>log(Distance)</i>] profile. Sampled data is fitted to an exponential with offset<br>&nbsp;
|-
|style="border: 0px;" |'''''N'''''
|style="border: 0px;" colspan="3"|For 2D images, the <u>N</u>umber of 8–connected particles intersecting the circumference of radius ''r''<sup>&nbsp;</sup><br>For 3D images, the <u>N</u>umber of 26-connected particles intersecting the surface of the sphere of radius ''r''
|-
|style="border: 0px;"|'''''r'''''
|style="border: 0px;" colspan="3"|Distance from center of analysis (<u>r</u>adius of Sholl circle/sphere)<sup>&nbsp;</sup>
|-
|style="border: 0px;"|'''''S'''''
|style="border: 0px;" colspan="3"|Area (<u>S</u>urface) of sampling circle (πr<sup>2</sup>) / volume of sampling sphere (4/3πr<sup>3</sup>)
|-
|style="border: 0px;"|'''''log'''''
|style="border: 0px;" colspan="3"|Natural logarithm, the logarithm to the base ''e''<sup>&nbsp;</sup>
|}
</center>
<br>
<div style="float:center;
            border: 1px solid #ccc;
            padding: 5px !important;
            border-radius: .75em;
            -moz-border-radius: .75em;
            -webkit-border-radius: .75em;
            margin-bottom: 1em;
            background-color: #ffefbe;">
The terms ''Critical radius'' (''C<sub>r</sub>'') and ''Critical value'' (''C<sub>v</sub>'') are arbitrary, and previous authors have used different terms to describe the largest value taken by the Sholl profile (cf. [http://en.wikipedia.org/wiki/Sholl_analysis Wikipedia]). Since Sholl analysis is not restricted to dendritic arbors (it can be applied to any tree-like structure such as axonal arbors,  mammary glands or blood vessels), this plugin introduces the term ''critical radius'', renaming ''Dendrite maximum'' (''N<sub>m</sub>'') to ''Critical value''. Thus, we may not follow the conventions adopted by [[Simple_Neurite_Tracer:_Sholl_analysis|Simple Neurite Tracer]].</div>
<br>

== Descriptors ==
Morphometric descriptors and other properties of the arbor are printed to a dedicated results table named ''Sholl Results''. Listed values can be displayed in scientific notation and with the precision specified in <u>Analyze▷Set Measurements...</u> The first columns log analysis parameters: Image filename and voxel unit; Lower and Upper Threshold levels; Method choice; X,Y (in pixels) and Z (slice number) coordinates of center of analysis; ''Starting'' and ''Ending radius''; ''Radius step'' and ''Number of Samples per Radius''. Other parameters are described below.

[[File:BitmapSholl-Table.png|100%|center|Sholl Table]]


=== Descriptors based on sampled data ===
[[File:BitmapSholl-Plot.png|right|Sholl Plot]]

;Intersecting radii
:The number of sampling radii intersecting the arbor at least once.

;Sum of intersections (''Sum inters.'')
:The sum of all intersections.

;Mean of intersections (''Mean inters.'')
:''Sum inters.'' divided by ''Intersecting radii''.

;Median of intersections (''Median Inters.'')
:The median value of sampled intersections.

;Highest count of intersections (''Max inters.'')
:The maximum value of sampled intersections, i.e., the maximum in a "traditional" [''N'' vs ''Distance''] profile (raw data), reflecting the number of processes/branches in the arbor. Note that if the same maximum occurs multiple times, only the first occurrence is considered.
: See also '''''Critical value''''' in [[#Descriptors_based_on_fitted_data|Descriptors based on fitted data]].

;Radius of highest count of intersections (''Max inters. radius'')
:The distance at which the ''Highest count of intersections'' occurred, reflecting sites of highest branch density.
: See also '''''Critical radius''''' in [[#Descriptors_based_on_fitted_data|Descriptors based on fitted data]].

;Schoenen Ramification index (''Ramification index (sampled)'')
:A measure of ramification<ref name="Schoenen">J Schoenen. The dendritic organization of the human spinal cord: the dorsal horn. Neuroscience, 7(9):2057–87, Jan 1982, [http://www.ncbi.nlm.nih.gov/pubmed?term=7145088 PMID: 7145088]</ref>: the ratio between ''Max inters.'' and the number of primary branches. Primary branches are those originating directly from cell soma (when the center of analysis is the perikaryon) and are inferred from the number of intersections at ''Starting radius''.
: See also '''''Ramification index (Cv)''''' in [[#Descriptors_based_on_fitted_data|Descriptors based on fitted data]].

;Radius of centroid (''Centroid radius'')
:The abcissa of the centroid (i.e., the geometric center or barycenter) of the linear ("traditional" [''N'' vs ''Distance'']) Sholl profile.

;Centroid intersections (''Centroid inters.'')
:The ordinate of the centroid (i.e., the geometric center or barycenter) of the linear ("traditional" [''N'' vs ''Distance'']) Sholl profile.

;Enclosing radius
:The last (thus, the widest) of ''Intersecting radii''.

;Enclosed field
:For 2D images, the area of the smallest circle enclosing the arbor. For stacks, the volume of the smallest sphere enclosing the arbor. It is derived from ''Enclosing radius''.

=== Descriptors based on fitted data ===

;Sholl regression coefficient
:The | slope | ''k'' of the linear regression described in [[#Sholl Methods|(3)]]<ref name="Stulic"></ref> <ref name="Ristanovic">NT Milosević and D Ristanović. The Sholl analysis of neuronal cell images: Semi-log or log-log method? J Theor Biol, 245(1):130–40, Mar 2007, [http://www.ncbi.nlm.nih.gov/pubmed?term=17084415 PMID: 17084415]</ref>, a measure of the rate of decay of the number of branches with distance from the center of analysis. Higher ''k'' values reflect larger changes in the function log(N/S).

;Regression intercept
:The y-coordinate ''m'' described in [[#Sholl Methods|(3)]].

;Regression R<sup>2</sup> (''Regression R^2'')
:The coefficient of determination of the linear regression described in [[#Sholl Methods|(3)]].

;Critical value
:The local maximum of the polynomial fit, i.e, ''N'' at ''C<sub>r</sub>'' in [[#Sholl Methods|(1)]]. Sometimes abbreviated as ''N<sub>m</sub>'' or ''C<sub>v</sub>'' .
: See also '''''Max inters.''''' in [[#Descriptors_based_on_sampled_data|Descriptors based on sampled data]].

;Critical radius
:The distance at which ''Critical value'' occurs. Calculated with a precision of 1/1000 of ''Radius step size''. Sometimes abbreviated as ''C<sub>r</sub>'' or ''r<sub>c</sub>'' .
: See also '''''Max inters. radius''''' in [[#Descriptors_based_on_sampled_data|Descriptors based on sampled data]].

;Mean value
:The mean value<ref name="Stulic"></ref> of the fitted polynomial function [[#Sholl Methods|(1)]], representing the average of intersections over the whole area occupied by the arbor. Sometimes abbreviated as M<sub>v</sub> or N<sub>avg</sub> .
:On the Sholl plot, it is highlighted as the height of the rectangle that has the width of ''Enclosing radius'' − ''First intersecting radius'' and the same area of the area under the fitted curve on that discrete interval. It is analogous to '''''Mean inters.''''', the arithmetic mean of sampled intersections throughout the arbor (cf. [[#Descriptors_based_on_sampled_data|Descriptors based on sampled data]]).

;Ramification index (Cv)
:Schoenen Ramification index retrieved from fitted profile:  The ration between ''Critical value'' and  ''Number of primary branches''. As mentioned earlier, the number of primary branches is inferred from the number of intersections at ''Starting radius''.
: See also '''''Ramification index (sampled)''''' in [[#Descriptors_based_on_sampled_data|Descriptors based on sampled data]].

== Auxiliary Commands ==

;File▷Open Samples▷ddaC Neuron
:Opens a sample image of a Drosophila class IV ddaC sensory neuron in which dendrites have been previously segmented (2D arbor). Use it to get acquainted with the plugin. Run <u>Image▷Show Info...</u> to know more about this cell type.

;Image▷Lookup Tables▷Sholl LUT
: Adjusts the background color of the Sholl lookup table as specified in the main [[#Parameters|dialog prompt]].

;Help▷About Plugins▷Sholl Plugins...
:Retrieves information about the plugin version and a link to its Git source code.


== FAQ ==
#'''Why do I need to threshold the cell?'''
#: Counting intersections is really a binary procedure: a shell either intercepts a branch or it doesn't. For this reason the image must be split in two phases: arbor and background. 
#'''My images don't look that great. How can I treat them prior to analysis?'''
#: 
#'''The plugin complains about a wrong image type. Why?'''
#: Although ImageJ can threshold RGB images, the plugin can only parse grayscale images (8-bit and 16-bit). Images of fluorescent-labeled cells are typically non-RGB images. Conversions between different image types is explained in the [http://imagej.nih.gov/ij/docs/guide/ ImageJ User Guide].
#'''How can I save/edit the ''Sholl Results'' table?'''
#: Select the table, then choose <u>File▷ Save As…</u> As with any other ImageJ table, the file extension to be used when saving the ''Sholl Results'' can be specified using the <u>Edit▷ Options▷ Input/Output…</u> command (see the [http://imagej.nih.gov/ij/docs/guide/ ImageJ User Guide] for details). Single cells cannot be modified from within ImageJ, but custom extensions (e.g., .csv, .xls or .ods) will allow the table to be imported by other spreadsheet applications.
#'''Can I modify the number of decimal places used by the ''Sholl Results'' table?'''
#: Yes. Use the ''Decimal places'' field in <u>Analyze▷ Set Measurements…</u>
#'''I cannot see the option to save the results. Why?'''
#: The image you are trying to analyze is not saved locally. Saving it to a local directory (e.g., your Desktop or Home folder) should re-enable it.
#'''I cannot see the hemicircle/hemisphere option. Why?'''
#: This option is only available if an orthogonal line has been created by holding Shift when using the Straight Line Selection Tool. See the [http://imagej.nih.gov/ij/docs/guide/ ImageJ User Guide] for the full list of key modifiers that can be used while creating straight line ROIS.
#'''With 3D images, How do I set the Z-position of the center?'''
#: The Z-position (depth) of the center of analysis is the active Z-slice of the stack. It is reported in the ''Sholl Results'' table.
#'''The shape of the polynomial curve changes at the edges. Why?'''
#: 
#'''Why do I have to manually chose the order of the polynomial function?'''
#: 
#'''The 3D profile looks worse than the 2D profile of the Maximum Intensity Projection of the same cell. Why?'''
#:
#'''I have several images I would like to batch process. What is the procedure?'''
#:

== Related Links ==

* '''[[Simple_Neurite_Tracer|Simple Neurite Tracer]]''' Mark Longair's plugin for semi-automated three-dimensional tracing, featuring [[Simple_Neurite_Tracer:_Sholl_analysis|Sholl analysis]] for traced cells

* '''[[Strahler_Analysis|Strahler_Analysis]]''' Strahler Analysis on skeletonized arbors.

* '''[http://www.imagescience.org/meijering/software/neuronj/ NeuronJ]''' ImageJ plugin for semi-automated tracing and quantification of two-dimensional arbors

* '''[http://www.reading.ac.uk/neuromantic/ Neuromantic]''' Standalone program for (semi-manual/semi-automatic) neuronal reconstruction, performing Sholl on traced cells

== References ==
<references/>


== Release Notes ==
Available [https://github.com/tferr/ASA/blob/master/Notes here].


== License ==
This program is free software; you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the [http://www.gnu.org/licenses/gpl.txt Free Software Foundation]. This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License for more details.

[[Category:Plugins]]
[[Category:Analysis]]
