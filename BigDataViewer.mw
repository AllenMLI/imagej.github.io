{{Infobox Plugin
| name                  = spim_viewer
| software              = Fiji
| author                = [[User:Pietzsch|TobiasPietzsch]]
| maintainer            = [mailto:pietzsch@mpi-cbg.de Tobias Pietzsch]
| source                = [https://github.com/tpietzsch/spimviewer on GitHub]
<!-- | released              = January 5<sup>th</sup>, 2014 -->
| status                = beta
| category              = [[:Category:Visualization|Visualization]], [[:Category:Transform|Transform]]
}}

__TOC__

== Description ==
The BigDataViewer is a re-slicing browser for terabyte-sized multi-view image sequences.
BigDataViewer was developed with multi-view light-sheet microscopy data in mind and integrates well with Fiji's SPIMage processing pipeline.

Conceptually, the visualized data comprises multiple ''data sources''.
Each source provides one 3D image (for each time-point in the case of a time-lapse sequence)
For example, in a multi-angle SPIM sequence, each angle is a source.
In a multi-angle, multi-channel SPIM sequence, each channel of each angle is a source.

BigDataViewer comes with a custom data format that is is optimized for fast random access to very large data sets.
This permits browsing to any location within a multi-terabyte recording in a fraction of a second.

The file format is based on XML and HDF5.
Images are represented as tiled multi-resolution pyramids, and stored in HDF5 chunked multi-dimensional arrays.
The XML file contains metadata, for example the registration of sources to the global coordinate system.

== Installation ==
To get BigDataViewer you need to enable its update site in the Fiji Updater.
Select ''Help > Update Fiji'' from the Fiji menu to start the updater.

[[Image:bdv-imagej-updater-1.png|500px]]

Click on ''Manage update sites''. This brings up a dialog where you can activate additional update sites.

[[Image:bdv-manage-update-sites-1.png|500px]]

Activate the BigDataViewer update site and ''Close'' the dialog.
Now you should see additional files appearing for download.

[[Image:bdv-imagej-updater-2.png|500px]]

Click ''Apply changes'' and restart Fiji.

You should now have a sub-menu ''Plugins > BigDataViewer''.

== Usage ==
To use the BigDataViewer we need some example dataset to browse.
You can download a small dataset from
[http://fly.mpi-cbg.de/~pietzsch/bdv-example/ here], comprising two views and three time-points.
This is an excerpt of a 6 angle 715 time-point sequence of ''drosophila melanogaster'' embryonal development, imaged with a Zeiss Lightsheet Z.1.
Download both the XML and the HDF5 file and place them somewhere next to each other.

Alternatively, you can create a dataset by exporting your own data as described below.

=== Opening Dataset ===
To start BigDataViewer, select ''Plugins > BigDataViewer > Open XML/HDF5'' from the Fiji menu.
This brings up a file open dialog. Open the XML file of your test dataset.

=== Basic Navigation ===
You should see something like this:

[[Image:bdv-bdv-start.png]]

On startup, the middle slice of the first source (angle) is shown.
You can browse the stack using the keyboard or the mouse.
To get started, try the following:
* Use the mouse-wheel or {{key press|<}} and {{key press|>}} keys to scroll through z slices.
* {{key press|right-click|drag}} anywhere on the canvas to translate the image.
* Use {{key press|Ctrl|Shift|mouse-wheel}}, or {{key press|Up}} and {{key press|Down}} keys to zoom in and out.
* {{key press|left-click|drag}} anywhere on the canvas to rotate (reslice) the image.


The following table shows the available navigation commands using the mouse:

{| border="1" style="border-collapse:collapse;"
| style="padding: 5px;" | {{key press|left-click|drag}}
| style="padding: 5px;" | Rotate (pan and tilt) around the point where the mouse was clicked.
|-
| style="padding: 5px;" | {{key press|right-click|drag}} or {{key press|middle-click|drag}}
| style="padding: 5px;" | Translate in the XY-plane.
|-
| style="padding: 5px;" | {{key press|mouse-wheel}}
| style="padding: 5px;" | Move along the z-axis.
|-
| style="padding: 5px;" | {{key press|Cmd|mouse-wheel}} or {{key press|Shift|Ctrl|mouse-wheel}}
| style="padding: 5px;" | Zoom in and out.
|}


The following table shows the available navigation commands using keyboard shortcuts:
{| border="1" style="border-collapse:collapse;"
| style="padding: 5px;" | {{key press|X}}, {{key press|Y}}, {{key press|Z}}
| style="padding: 5px;" | Select keyboard rotation axis.
|-
| style="padding: 5px;" | {{key press|Left}}, {{key press|Right}}
| style="padding: 5px;" | Rotate clockwise or counter-clockwise around the choosen rotation axis.
|-
| style="padding: 5px;" | {{key press|Up}}, {{key press|Down}}
| style="padding: 5px;" | Zoom in or out.
|-
| style="padding: 5px;" | {{key press|,}}, {{key press|.}}
| style="padding: 5px;" | Move forward or backward along the Z-axis.
|-
| style="padding: 5px;" | {{key press|Shift|X}}
| style="padding: 5px;" | Rotate to the ZY-plane of the current source. (Look along the X-axis of the current source.)
|-
| style="padding: 5px;" | {{key press|Shift|Y}} or {{key press|Shift|A}}
| style="padding: 5px;" | Rotate to the XZ-plane of the current source. (Look along the Y-axis of the current source.)
|-
| style="padding: 5px;" | {{key press|Shift|Z}}
| style="padding: 5px;" | Rotate to the XY-plane of the current source. (Look along the Z-axis of the current source.)
|-
| style="padding: 5px;" | {{key press|[}} or {{key press|N}}
| style="padding: 5px;" | Move to previous timepoint.
|-
| style="padding: 5px;" | {{key press|]}} or {{key press|M}}
| style="padding: 5px;" | Move to next timepoint.
|}


For all navigation commands you can hold {{key press|Shift}} to rotate and browse
10x faster, or hold {{key press|Ctrl}} to rotate and browse
10x slower.
For example, {{key press|Left}} rotates by
1° clockwise, while {{key press|Shift|Left}} rotates by
10°, and {{key press|Ctrl|Left}} rotates by
0.1°.

=== Interpolation Mode ===
Using {{key press|I}} you can switch between nearest-neighbor and trilinear interpolation schemes.
The difference is clearly visible when you zoom in such that individual source pixels are visible.

[[Image:bdv-interpolation.png]]

Trilinear interpolation results in smoother images but is a bit more expensive computationally.
Nearest-neighbor is faster but looks more pixelated.

=== Displaying Multiple Sources ===
BigDataViewer datasets typically contain more than one source.
For a SPIM sequence one usually has multiple angles and possibly fused and deconvoled data on top.

Select ''Settings > Visibility & Grouping'' from the BigDataViewer menu to bring up a dialog to control source visibility.
You can also bring up this dialog by the shortcut {{key press|F6}}.

[[Image:bdv-visibility.png|500px]]

Using the current source checkboxes (A in the figure above), you can switch between available sources.
The first ten sources can also be made current by the number keys {{key press|1}} through {{key press|0}} in the main BigDataViewer window.

To view multiple sources overlaid at the same time, switch to ''fused mode'' using the checkbox (B).
You can also switch between normal and fused mode using the shortcut {{key press|F}} in the main window.
In fused mode individual sources can be turned on and off using the checkboxes (C) or shortcuts {{key press|Shift|1}} through {{key press|Shift|0}} in the main window.

Whether in normal or fused mode, the (unselectable) boxes (D) provide feedback on which sources are actually currently displayed.
Also the main window provides feedback:

[[Image:bdv-overlays-1.png|500px]]

In the top-left corner an overview of the dataset is displayed (E).
Visible sources are displayed as green/magenta wireframe boxes, invisible sources are displayed as grey wireframe boxes.
The dimensions of the boxes illustrate the size of the source images. The filled grey rectangle illustrates the screen area, i.e., the portion of the currently displayed slice.
For the visible sources, the part that is in front of the screen is green, the part that is behind the screen is magenta.

At the top of the window, the name of the current source is shown (F).

Note, that also in fused mode there is always a ''current source'', although this source may not even be visible.
Commands such as {{key press|Shift|X}} (rotate to ZY-plane) refer to the local coordinate system of the current source.

=== Setting Brightness and Color ===

=== Grouping Sources ===

=== Opening BigDataViewer Datasets as Fiji Stacks ===

== Exporting Datasets for the BigDataViewer ==
