(Return to the main [[SNT]] page)
<div class="toclimit-3">

=Tracing=
These instructions assume that you have done the preliminary steps described on the [[Simple Neurite Tracer: Basic Instructions]] page including starting up the plugin, enabling A* search, and turning on "Hessian-based analysis".

==I. Pick A Start Point==
[[Image:Snt-cropped-before-starting-2.png|right|thumb|400px|Choosing a starting point]]
You may notice that, by default, the cursor snaps to the local maximum intensity pixel in its vicinity. To accomplish this, it takes the cuboid of the specified dimensions (in pixels) centered on the current cursor position and searches quickly for the brightest voxel(s) in that neighborhood, moving the cursor to that position. If the "Z" parameter is greater than 0, it moves to the z-plane in which that maximum was found.  
Several things should be noted:
* It assumes signal is brighter than background as typically found in fluorescent images.
[[File:cursor-snap.png|right|border]]
* If multiple maxima exist (e.g., when signal is saturated), it snaps to their centroid.
* To streamline the computation:  XYZ dimensions are constrained to even numbers and limited range.
* Snapping occurs in 2D if Z=0.
* The XZ, ZY views are synchronized when 3D snapping is active (i.e., Z>0).

If you prefer to manually control the placement of nodes, feel free to disable this feature. Now, to begin tracing, move through the image stack to find the start point of a path then click there with the left mouse button.

==II. Pick A Subsequent Point==
[[Image:Snt-cropped-after-starting-2.png|right|thumb|400px|First point of a path selected]]
[[Image:Snt-cropped-mid-tracing-2.png|right|thumb|400px|A* search animated progress]]
A small circle should appear, highlighting the start of the path. Move through the stack to find a subsequent point further along the same structure to be traced (neuron, blood vessel, etc.), and click there.

If a path between the two points cannot be found immediately, you may see the animated progress of the search. You can scroll through the stack while such a search progresses: If it appears to not be making good progress, it's probably best to press the "Cancel/Esc" button (shortcut: {{key|C}}/{{key|Esc}}) and pick a point closer to the start point.
{{Tip| id = external-traces|tip = Increase''Z'' in the ''Cursor Auto-snapping'' panel for automated Z-navigation on signal mouseover.}}

==III. Confirm A Temporary Segment==
Once the search has reached the target point, the path is shown in cyan (to indicate that this is still a temporary path) and you are asked to confirm (by clicking "Yes" or pressing  {{key|Y}}) that this path is following the route through the image that you expect. If it is not, then click "No" {{key|N}} and you'll go back to the [[#II. Picking a Subsequent Point|previous step]]. Assuming you confirmed the path, the confirmed path will appear in red. Now you are essentially back at [[#II. Picking a Subsequent Point|step II]]. Normally you will go on to pick further points along the structure. However, if you have finished with that path, click "Finish Path" {{key|F}} and you will go back to [[#I. Picking a Start Point|step I]]. If you completed that path it would be shown in magenta.
<div align="center">
<ul> 
<li style="display:inline-block;"> [[Image:Snt-cropped-confirmation-2.png|none|thumb|250px|A* search completed]] </li>
<li style="display:inline-block;"> [[Image:Snt-cropped-confirmed-2.png|none|thumb|250px|A confirmed segment]] </li>
<li style="display:inline-block;"> [[Image:Snt-cropped-completed-path-2.png|none|thumb|250px|A completed path]] </li>
</ul>
</div>


==Branching: Start A Path On An Existing Path==
===I. Select The Path To Branch Off===
To select the path you want to branch off from, you can either select it in the Path Manager, or press {{key|G}} while the mouse pointer is near the path. When the path is first selected, it will be shown in the default green color.
[[Image:Snt-sb-selecting-by-G.gif|center|thumb|600px|[[SNT:_Key_Shortcuts#Path_Handling|Holding 'G']] will select the closest path to the mouse pointer]]

===II. Select The Fork Point===
[[Image:Snt-sb-started-branch-2.png|right|thumb|400px|A newly created fork point]]
To force the start of the new path to be a branch off the selected path, hold down the {{key|Alt|Shift}} keys while you move the mouse to find the branch point under the red cross-hairs, now decorated with a "Fork Point" annotation. With {{key|Alt|Shift}} held down, click with the left mouse button. Finally, release the keys. Note that it is also possible to zoom into the branch point, right-click on the image and choose ''Fork at Nearest Node'' from the contextual menu.

===III. Extend The Path===
From this point on, you can carry on adding nodes to the branched path as [[#II._Pick_A_Subsequent_Point|above]], i.e., 1) Create a temporary path and 2) Confirm it. When you decide to complete the path you should see in the Path Manager that it has been recorded as starting on the existing path.
<div align="center">
<ul> 
<li style="display:inline-block;"> [[Image:Snt-sb-temporary-path-2.png|none|thumb|250px|1) Temporary path branching-off]] </li>
<li style="display:inline-block;"> [[Image:Snt-sb-confirmed-path-2.png|none|thumb|250px|2) Temporary path confirmed]] </li>
<li style="display:inline-block;"> [[Image:Snt-sb-completed-branch-2.png|none|thumb|250px|3) Branched (child) path completed]] </li>
</ul>
</div>

==Joining: End A Path On An Existing Path==
Supposing you want the end of a path that you're tracing to join onto an existing path, you just use the same modifier key when selecting the end point of the last part of the path. To go into that in more detail, if you're half way through tracing a path like this:
[[Image:Snt-ej-cropped-half-finished-2.png|center|thumb|400px|Unfinished join segment, in red - disconnected]]

... and you want the final part of that path to join up with the existing path running from the top-left to top-right of the image. First, select that path in the path list, so that it turns green:
[[Image:Snt-ej-cropped-selected-destination-path-2.png|center|thumb|400px|Selected path to join to, in green]]

Now hold down {{key|Alt|Shift}} to restrict the end point to be a "join" on that existing path. Click (while still holding down the modifier keys) to start the search for that end point and make it join the existing path. If the search can find a path to the end point, the result should look like this:
[[Image:Snt-ej-cropped-end-join-created-2.png|center|thumb|400px|Connected path to join, unconfirmed]]

If you're happy with that, confirming the temporary path will automatically complete the whole path, since if you're creating an end join there cannot be any more to the path. The result will look like this:
[[Image:Snt-ej-cropped-path-completed-2.png|center|thumb|400px|Confirmed join]]

Note that the path list indicates that this new path (1) ends on the existing one (0).

== Filtered Image==
WIP

==Legacy 3D Viewer==
SNT comes bundled with a 3D viewer with visualization and tracing capabilities. 
===I.Starting the Viewer===
To open the viewer, navigate to the "3D" menu tab in the SNT dialog and look for "Legacy 3D Viewer". You will see 3 parameters:
[[File:SNT-3D-Dialog.png|right|thumb|The 3D part of the dialog]]
* '''Viewer''' 
** ''New with image'' - Instantiate viewer with the currently opened image. This enables one to trace in 3D as well as explore the image stack in an intuitive way.
** ''New without image'' - Instantiate viewer without an image. Useful for visualizing reconstructions and surface meshes (WaveFront or STL).
* '''Mode''' - the render style for the reconstruction
** ''Lines and discs''
** ''Lines'' - Render paths as nodes connected by 1D lines
** ''Surface reconstructions'' - Render paths as tubular surfaces
* '''Actions'''
** ''Apply Color Labels''
** ''Compare reconstruction against''
If you choose "New with image..." for Viewer and press "Apply", a prompt will appear asking you to choose the resampling factor for the image.
[[File:SNT-Image-Resampling-Factor.png|right|thumb]] Then, the viewer window will appear with the currently open image.

[[File:SNT-Legacy-3D-Viewer.png|center|thumb|400px|3D viewer showing OP_1.tif]]

===II.Tracing and Navigation===
In order to select points for tracing in the 3D Viewer, you need to use the "Wand" tool.  In order to rotate the view, you need to either use the "Hand" tool or drag the mouse while holding the scroll wheel. Once you have selected each of these tools once, you should be able to switch between them by pressing the {{key|Esc}} key. To translate the image, hold {{key|Shift}} and the scroll wheel while dragging the mouse. To adjust zoom depth, scroll the mouse wheel.

[[File:Fiji-toolbar-wand-and-hand-2.png]]

The following key shortcuts also work in the 3D Viewer:

* {{key|Y}} confirm the temporary path segment
* {{key|N}} cancel the temporary path segment
* {{key|F}} complete the current path
* {{key|G}} select the current path under the mouse pointer

You can still create branches and joins in the 3D Viewer as you would in the 2D viewer.  First select the path you want to branch off, or join to by pressing {{key|G}} while the mouse pointer is over that path.  (It should turn green.)  Then create the join or branch by holding down the join modifier key ({{key|Alt}} and clicking at the right point on the selected path.

=Fitting=
WIP

=Filling=
There is a simple facility in this plugin for "filling out" paths to volumes. This is not particularly sophisticated, but often good enough for a rough visualization of the shape of a neuron beyond what can be seen from the traced path.
===I.Starting the Fill===
First, select the one or more paths that you want to fill out from in the Path Manager and select "Fill -> Fill Out..." in the Path Manager menu options. The selected paths are shown in green so that you can check that you're starting from the right ones. After a couple of seconds if you scroll through the stack you should be able to see a thick green surround the path:

[[Image:Snt-initial-filling-2.png|center|thumb|400px|A few seconds after selecting "Fill Out..." with 1 path selected]]


The filler continues to explore the image starting from the path until you click "Pause" or "Stop" in the dialog. However, the fill which is shown only includes those points up to a certain threshold distance from the path. (Note that in this section "distance" doesn't mean a real physical distance, but a measure which takes into account the intensity values of the pixels which must be passed through when moving away from the path.) Information about the current threshold and the progress of the search is shown in the dialog.
[[Image:Snt-filling-statistics-2.png|right|thumb|The filling-related part of the dialog.]]
The "Cursor position:" state under "Search Status" is updated as you move your mouse over the image. If the point under the mouse has been reached by the search then it will show you that point's distance from the path. Otherwise, it will read "Not reached by search yet". Two lines above, the "Current threshold distance:" shows your current threshold distance: so if this is set to 0.2 then that means that all points less than 0.2 from the path are included in the fill (and shown in green in the image.) The "Max. explored distance:" state under this line show the maximum distance from the path that has been completely explored.

===II.Adjusting the Fill Threshold===

You can change the fill threshold in one of three ways:
* Clicking on a point in the image that has been reached by the search (This is the most intuitive way of altering the threshold). It may be helpful to disable the "Enable Snapping within: XY-Z" feature for the cursor while doing this.
* Manually changing the threshold in the "Specify manually:" input box and clicking the "Apply" button beside it.
* Clicking the "Use explored maximum" button below the threshold input box and clicking "Apply", which sets the threshold to the maximum explored distance (the value shown in "Max. explored distance:" under the "Search Status" dialog).

Anyway, assuming that you want to use the first of these approaches, you should use the approach described below. It is difficult to set the threshold accurately from the image unless you zoom in, so first zoom on part of the path that you want to set the threshold for:
[[Image:Snt-zoomed-filling-2.png|center|thumb|400px|After having zoomed in on part of the fill]]

{{Clear}}

Since the the solid green fill obscures the intensity value of the points in the fill, I suggest that you switch to the semi-transparent view of the fill at this stage by selecting the "Transparent overlay" option in the "Rendering Options" dialog. Note that this may slow down filling. This should show you something like this:

[[Image:Snt-transparent-filling-2.png|center|thumb|400px|Having made the fill transparent]]

{{Clear}}

As you can see in this image, the threshold is set too far from the path, since there are many completely dark points under the green fill, as well as points on different paths than those of interest. Experiment with clicking on different points closer to the path in order to adjust the threshold until you are happy with it. You might end up with something like this:

[[Image:Snt-refined-filling-2.png|center|thumb|400px|Having refined the fill by clicking closer to the path]]

{{Clear}}

===III.Completing the Fill===
If you are happy with this, then you might as well click "Pause" so that your computer isn't spending all its CPU on continuing to explore the image. Then you can either: 
* Save the fill (which will add it to the fill list) by clicking "Stash Progress". 
* Discard the fill by either clicking "Stop" while filling is in progress or, if you stashed the fill, select it in the fill list and click "Delete Fill(s)". 
* Use the "Image Stack..." button to view the same image stack, but with only the points in that fill preserved. You can choose either a grayscale image or binary mask. One reason why you might want to do this is that you can then smooth that image and use the [[3D Viewer]] to do a surface rendering of the neuron. Perhaps then you could overlay that onto a volume rendering of the complete image (see available [[Simple_Neurite_Tracer#Tutorials|tutorials]]). Or, you could save those fill stacks for each of the neurons you fill and then combine them in ImageJ using "RGB Merge".

The image stack you would get from the image used in this example might look something like this:
[[Image:Snt-filling-viewed-2.png|center|thumb|500px|Having selected the "Image Stack... -> As Grayscale Image..." option]]

{{Clear}}
