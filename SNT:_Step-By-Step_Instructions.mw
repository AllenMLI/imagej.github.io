(Return to the main [[SNT]] page)
<div class="toclimit-3">

=Tracing=
These instructions assume that you have read the [[SNT: Overview|Overview]] page, including starting up the plugin, enabling [[SNT:_Overview#Auto-snapping|Cursor Auto-snapping]], and [[SNT:_Overview#Auto-tracing|Auto-tracing]] options.

==Starting A Path==
===I. Pick The Starting Point===
[[Image:Snt-cropped-before-starting-2.png|right|thumb|400px|Choosing a starting point]]
You may notice that, by default, the cursor [[SNT:_Overview#Auto-snapping|snaps]] to the brightest pixel in its vicinity. If you prefer to manually control the placement of nodes, feel free to toggle feature by pressing {{key|S}}. Now, to begin tracing, move through the image stack to find the start point of a path then click there with the left mouse button.

===II. Pick A Subsequent Point===
[[Image:Snt-cropped-after-starting-2.png|right|thumb|400px|First point of a path selected]]
[[Image:Snt-cropped-mid-tracing-2.png|right|thumb|400px|A* search animated progress]]
A small circle should appear, highlighting the start of the path. Move through the stack to find a subsequent point further along the same structure to be traced (neuron, blood vessel, etc.), and click there.

If a path between the two points cannot be found immediately, you may see the animated progress of the search. You can scroll through the stack while such a search progresses: If it appears to not be making good progress, it's probably best to press the "Cancel/Esc" button (shortcut: {{key|C}}/{{key|Esc}}) and pick a point closer to the start point.
{{Tip| id = external-traces|tip = Increase''Z'' in the ''Cursor Auto-snapping'' panel for automated Z-navigation on signal mouseover.}}

===III. Confirm The Temporary Segment===
Once the search has reached the target point, the path is shown in cyan (to indicate that this is still a temporary path) and you are asked to confirm (by clicking "Yes" or pressing  {{key|Y}}) that this path is following the route through the image that you expect. If it is not, then click "No" {{key|N}} and you'll go back to the [[#II. Picking a Subsequent Point|previous step]]. Assuming you confirmed the path, the confirmed path will appear in red. Now you are essentially back at [[#II. Picking a Subsequent Point|step II]]. Normally you will go on to pick further points along the structure. However, if you have finished with that path, click "Finish Path" {{key|F}} and you will go back to [[#I. Picking a Start Point|step I]]. If you completed that path it would be shown in magenta.
<div align="center">
<ul> 
<li style="display:inline-block;"> [[Image:Snt-cropped-confirmation-2.png|none|thumb|250px|A* search completed]] </li>
<li style="display:inline-block;"> [[Image:Snt-cropped-confirmed-2.png|none|thumb|250px|A confirmed segment]] </li>
<li style="display:inline-block;"> [[Image:Snt-cropped-completed-path-2.png|none|thumb|250px|A completed path]] </li>
</ul>
</div>


==Branching: Start A Path On An Existing Path==
===I. Select The Path To Branch Off===
To select the path you want to branch off from, you can either select it in the Path Manager, or press {{key|G}} while the mouse pointer is near the path. When the path is first selected, it will be shown in the default green color.
[[Image:Snt-sb-selecting-by-G.gif|center|thumb|600px|[[SNT:_Key_Shortcuts#Path_Handling|Holding 'G']] will select the closest path to the mouse pointer]]

===II. Select The Fork Point===
[[Image:Snt-sb-started-branch-2.png|right|thumb|400px|A newly created fork point]]
To force the start of the new path to be a branch of the selected path, hold down the {{key|Alt|Shift}} keys while you move the mouse to find the branch point under the red cross-hairs, now decorated with a "Fork Point" annotation. With {{key|Alt|Shift}} held down, click with the left mouse button. Finally, release the keys. Note that it is also possible to zoom into the branch point, right-click on the image and choose ''Fork at Nearest Node'' from the contextual menu.

===III. Extend The Path===
From this point on, you can carry on adding nodes to the branched path as [[#II._Pick_A_Subsequent_Point|above]], i.e., Create a temporary path and confirm it. When you decide to complete the path you should see in the Path Manager that it has been recorded as a child of the existing path.
<div align="center">
<ul> 
<li style="display:inline-block;"> [[Image:Snt-sb-temporary-path-2.png|none|thumb|250px|1) Temporary path branching-off]] </li>
<li style="display:inline-block;"> [[Image:Snt-sb-confirmed-path-2.png|none|thumb|250px|2) Temporary path confirmed]] </li>
<li style="display:inline-block;"> [[Image:Snt-sb-completed-branch-2.png|none|thumb|250px|3) Branched (child) path completed]] </li>
</ul>
</div>

==Joining: End A Path On An Existing Path==
Supposing you want the end of a path that you're tracing to join onto an existing path, you just use the same modifier key when selecting the end point of the last part of the path. To go into that in more detail, if you're halfway through tracing a path like this:
[[Image:Snt-ej-cropped-half-finished-2.png|center|thumb|400px|Unfinished join segment, in red - disconnected]]

... and you want the final part of that path to join up with the existing path running from the top-left to top-right of the image. First, select that path in the path list, so that it turns green:
[[Image:Snt-ej-cropped-selected-destination-path-2.png|center|thumb|400px|Selected path to join to, in green]]

Now hold down {{key|Alt|Shift}} to restrict the endpoint to be a "join" on that existing path. Click (while still holding down the modifier keys) to start the search for that endpoint and make it join the existing path. If the search can find a path to the end point, the result should look like this:
[[Image:Snt-ej-cropped-end-join-created-2.png|center|thumb|400px|Connected path to join, unconfirmed]]

If you're happy with that, confirming the temporary path will automatically complete the whole path, since if you're creating an end join there cannot be any more to the path. The result will look like this:
[[Image:Snt-ej-cropped-path-completed-2.png|center|thumb|400px|Confirmed join]]

Note that the path list indicates that this new path (1) ends on the existing one (0).

==Contextual Menu==
Right-clicking on any of the image views will bring up a menu with various editing tools. The corresponding keyboard shortcuts are shown to the right of each option.
[[Image:SNT-Path-Edit-Right-Click-Menu.png|right|thumb|250px|Contextual Menu]]
* '''Select Nearest Path''' {{key|G}} or {{key|Shift}}+{{key|G}} Will select the path closest to the mouse cursor. 
* '''Fork at Nearest Node''' {{key|Shift}}+{{key|Alt}}+{{key|Left Click}} Creates a fork point at the node closest to the mouse cursor. Once a fork point is made, the branch may be extended as described in [[SNT:_Step-By-Step_Instructions#Branching:_Start_A_Path_On_An_Existing_Path|III. Extend The Path]].
* '''Continue Extending Path''' Allows continued tracing of previously finished paths. Note only one path may be extended at a time. To extend a path: first select it, choose this option, then place additional nodes as shown in [[SNT:_Step-By-Step_Instructions#II._Pick_A_Subsequent_Point| II. Pick A Subsequent Point]].
* '''Pause SNT''' Disables core functionality until this option is inactivated. "SNT Paused" [[SNT:_Overview#UI_Interaction|canvas annotations]] in the views indicate this state.
* '''Pause Tracing''' Disables tracing functions until this option is inactivated. "Tracing Paused" [[SNT:_Overview#UI_Interaction|canvas annotations]] in the views indicate this state.
* '''Sholl Analysis at Nearest Node''' {{key|Shift}}+{{key|Alt}}+{{Key|A}} Runs the [[Sholl_Analysis|Sholl Analysis]] plugin found in {{bc|Analyze|Sholl|Sholl Analysis (From Tracings)}}. Note the ''Center'' parameter, which sets the center point of the analysis, is left out as this value is given by the selected node.
===Editing Paths===
Pressing ''Edit Path'' with a single path selected will activate Edit Mode, allowing use of the menu options under the ''Edit Path'' option. When ''Edit Mode'' is active, moving the mouse cursor along the path will activate the nearest node and synchronize the current Z-slice to the location of that node. Note that the ability to create new paths is temporarily disabled when in Edit Mode.
[[Image:SNT-Path-Edit-Right-Click-Menu-Active.png|right|thumb|250px|Edit Mode active]]
* '''Reset Active Node''' Clears the active node from the cursor.
* '''Delete Active Node''' {{key|D}} or {{key|Backspace}} Permanently removes the active node from the path.
* '''Insert New Node At Cursor Position''' {{key|I}} Inserts a new node at the cursor position. The inserted node is placed between the active node and the parent of the active node.
* '''Move Active Node to Cursor Position''' {{key|M}} Moves the active node to the cursor position.
* '''Bring Active Node to Current Z-plane''' {{key|B}} Moves the active node to the current Z-plane in the image view. Note that the translation is only done in Z. XY positions are unchanged.
* '''Connect To (Start Join)''' Allows two existing paths to be merged. To do so, 1) select a path and enter Edit Mode, hovering over the node to join in order to activate it. 2) Select the second path and hover over the second join node to activate it. 3) Open the contextual menu and go to ''Connect To (Start Join)'' and choose the initial path. Now the second path is a child of the first. Note that one of the connecting nodes must be a start or an end node.
<div align="center">
<ul> 
<li style="display:inline-block;"> [[Image:SNT-Edit-Path-Connect-To-Step-1.png|none|thumb|200px|1) Select parent path and activate first join node]] </li>
<li style="display:inline-block;"> [[Image:SNT-Edit-Path-Connect-To-Step-2.png|none|thumb|200px|2) Select second path and activate second join node]] </li>
<li style="display:inline-block;"> [[Image:SNT-Edit-Path-Connect-To-Step-3.png|none|thumb|200px|3) Connect child path to parent path]] </li>
<li style="display:inline-block;"> [[Image:SNT-Edit-Path-Connect-To-Result.png|none|thumb|200px|4) Joined paths result]] </li>
</ul>
</div>

{{clear}}

=Fitting=
SNT can use the fluorescent signal around traced paths to optimize curvatures and estimate the thickness of traced structures. The optimization algorithm uses pixel intensities to fit circular cross-sections around each node. Once computed, fitted cross-sections can be used to: 1) Infer the radius of nodes, and/or 2) refine node positioning, by snapping their coordinates to the cross-section centroid. To fit path(s), select the desired paths in the Path Manager (or select none if you want to fit all paths) and go to the "Refine/Fit" menu in the same window. There are three options:
[[File:Fit-manager.png|right|thumb]]
* '''Fit Paths/Un-fit paths/Apply Existing Fit''' 1) Fits the selected paths or 2) un-fits them if they have alredy been fitted. 3) If you generated a preview of the fit you can apply that result to the path(s). This option will change depending on context.
* '''Explore/Preview Fit''' Carves out a region of the image along and around the path. Scrolling through this image will display the result of the fitting operation for each node on the path.
* '''Discard Fit''' Deletes the existing fit(s) for the selected path(s), or all fits if no paths are selected.
[[File:Fit-parameter-prompt.png|right|thumb|250px|Fitting parameters]]
[[File:Explore-fit-preview.png|right|thumb|250px|Slice in "Explore/Preview Fit" image stack]]

Before computing the fit, SNT will prompt you to specify two parameters:
* '''Type of Refinement'''
** 1) ''Assign radii of fitted cross-sections to nodes''
** 2) ''Snap node coordinates to cross-section centroids''
** 1) & 2) ''Assign fitted radii and snap node coordinates''
* '''Max. Radius''' Defines (in pixels) the largest radius allowed in the fit. It constrains the optimization to minimize fitting artifacts caused by neighboring structures
** Default = 40px on each side of the path

Assuming you chose options 1) & 2) for "Type of Refinement", a fit path might look like the rightmost image below. Notice how the nodes follow the center line of the structure more closely, and how each node now has a non-zero radius approximating that of the tube.
<div align="left">
<ul> 
<li style="display:inline-block;"> [[Image:Before-fitting.png|none|thumb|350px|Before fitting]] </li>
<li style="display:inline-block;"> [[Image:After-fitting.png|none|thumb|350px|Fitted path]] </li>
</ul>
</div>

=Filling=
There is a simple facility in this plugin for "filling out" paths to volumes. This is not particularly sophisticated, but often good enough for a rough visualization of the shape of a neuron beyond what can be seen from the traced path.
===I.Starting the Fill===
First, select the one or more paths that you want to fill out from in the Path Manager and select "Fill -> Fill Out..." in the Path Manager menu options. The selected paths are shown in green so that you can check that you're starting from the right ones. After a couple of seconds if you scroll through the stack you should be able to see a thick green surround the path:

[[Image:Snt-initial-filling-2.png|center|thumb|400px|A few seconds after selecting "Fill Out..." with 1 path selected]]


The filler continues to explore the image starting from the path until you click "Pause" or "Stop" in the dialog. However, the fill which is shown only includes those points up to a certain threshold distance from the path. (Note that in this section "distance" doesn't mean a real physical distance, but a measure which takes into account the intensity values of the pixels which must be passed through when moving away from the path.) Information about the current threshold and the progress of the search is shown in the dialog.
[[Image:Snt-filling-statistics-2.png|right|thumb|The filling-related part of the dialog.]]
The "Cursor position:" state under "Search Status" is updated as you move your mouse over the image. If the point under the mouse has been reached by the search then it will show you that point's distance from the path. Otherwise, it will read "Not reached by search yet". Two lines above, the "Current threshold distance:" shows your current threshold distance: so if this is set to 0.2 then that means that all points less than 0.2 from the path are included in the fill (and shown in green in the image.) The "Max. explored distance:" state under this line shows the maximum distance from the path that has been completely explored.

===II.Adjusting the Fill Threshold===

You can change the fill threshold in one of three ways:
* Clicking on a point in the image that has been reached by the search (This is the most intuitive way of altering the threshold). It may be helpful to disable the "Enable Snapping within: XY-Z" feature for the cursor while doing this.
* Manually changing the threshold in the "Specify manually:" input box and clicking the "Apply" button beside it.
* Clicking the "Use explored maximum" button below the threshold input box and clicking "Apply", which sets the threshold to the maximum explored distance (the value shown in "Max. explored distance:" under the "Search Status" dialog).

Anyway, assuming that you want to use the first of these approaches, you should use the approach described below. It is difficult to set the threshold accurately from the image unless you zoom in, so first zoom on part of the path that you want to set the threshold for.

Since the solid green fill obscures the intensity value of the points in the fill, I suggest that you switch to the semi-transparent view of the fill at this stage by selecting the "Transparent overlay" option in the "Rendering Options" dialog. Note that this may slow down filling.

As you can see in the middle image, the threshold is set too far from the path, since there are many completely dark points under the green fill, as well as points on different paths than those of interest. Experiment with clicking on different points closer to the path in order to adjust the threshold until you are happy with it. You might end up with something like the rightmost image:

<div align="center">
<ul> 
<li style="display:inline-block;"> [[Image:Snt-zoomed-filling-2.png|none|thumb|250px|Fill, opaque]] </li>
<li style="display:inline-block;"> [[Image:Snt-transparent-filling-2.png|none|thumb|250px|Fill, with "Transparent overlay" on]] </li>
<li style="display:inline-block;"> [[Image:Snt-refined-filling-2.png|none|thumb|250px|Fill, refined]] </li>
</ul>
</div>
{{Clear}}

===III.Completing the Fill===
If you are happy with this, then you might as well click "Pause" so that your computer isn't spending all its CPU on continuing to explore the image. Then you can either: 
* Save the fill (which will add it to the fill list) by clicking "Stash Progress". 
* Discard the fill by either clicking "Stop" while filling is in progress or, if you stashed the fill, select it in the fill list and click "Delete Fill(s)". 
* Use the "Image Stack..." button to view the same image stack, but with only the points in that fill preserved. You can choose either a grayscale image or binary mask. One reason why you might want to do this is that you can then smooth that image and use the [[3D Viewer]] to do a surface rendering of the neuron. Perhaps then you could overlay that onto a volume rendering of the complete image (see available [[Simple_Neurite_Tracer#Tutorials|tutorials]]). Or, you could save those fill stacks for each of the neurons you fill and then combine them in ImageJ using "RGB Merge".

The image stack you would get from the image used in this example might look something like this:
[[Image:Snt-filling-viewed-2.png|center|thumb|500px|Having selected the "Image Stack... -> As Grayscale Image..." option]]

==Legacy 3D Viewer==
SNT comes bundled with a 3D viewer with visualization and tracing capabilities. 
===I.Starting the Viewer===
To open the viewer, navigate to the "3D" menu tab in the SNT dialog and look for "Legacy 3D Viewer". You will see 3 parameters:
[[File:SNT-3D-Dialog.png|right|thumb|"Legacy 3D Viewer" widget]]
* '''Viewer''' 
** ''New with image'' - Instantiate viewer with the currently opened image. This enables one to trace in 3D as well as explore the image stack in an intuitive way.
** ''New without image'' - Instantiate viewer without an image. Useful for visualizing reconstructions and surface meshes (WaveFront or STL). For more advanced use cases in this regard, see the dedicated [[SNT:_Reconstruction_Viewer|Reconstruction Viewer]]
* '''Mode''' - the render style for the reconstruction
** ''Lines and discs''
** ''Lines'' - Render paths as nodes connected by 1D lines
** ''Surface reconstructions'' - Render paths as tubular surfaces
* '''Actions'''
** ''Apply Color Labels''
** ''Compare reconstruction against''
If you choose "New with image..." for Viewer and press "Apply", a prompt will appear asking you to choose the resampling factor for the image.
[[File:SNT-Image-Resampling-Factor.png|center|thumb]] Then, the viewer window will appear with the currently open image.

[[File:SNT-Legacy-3D-Viewer.png|center|thumb|400px|3D viewer showing OP_1.tif]]

===II.Tracing and Navigation===
* '''Selecting points for tracing'''  Select the "Wand" tool in the main Fiji toolbar and click over the region you want to trace. Tracing works the same way as in the 2.5D view, i.e., click somewhere in the image to create a starting point, then click further along the structure of interest to find a path between the two points, then confirm or deny the temporary segment, etc...
* '''Rotation'''  Either use the "Hand" tool and left-click while dragging mouse ''or'' drag mouse while holding the scroll wheel.
* '''Translation''' Hold {{key|Shift}} and the scroll wheel while dragging the mouse. 
* '''Adjusting zoom depth''' Scroll the mouse wheel.
Once you have selected each of these tools (Wand and Hand) once, you should be able to switch between them by pressing the {{key|Esc}} key.
[[File:Fiji-toolbar-wand-and-hand-2.png]]

The following key shortcuts also work in the 3D Viewer:

* {{key|Y}} confirm the temporary path segment
* {{key|N}} cancel the temporary path segment
* {{key|F}} complete the current path
* {{key|G}} select the current path under the mouse pointer

You can still create branches and joins in the 3D Viewer as you would in the 2D viewer.  First, select the path you want to branch off, or join to by pressing {{key|G}} while the mouse pointer is over that path.  (It should turn green.)  Then create the join or branch by holding down the join modifier key ({{key|Alt}} and clicking at the right point on the selected path.
