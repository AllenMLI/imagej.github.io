{{Infobox
| name                  = BigWarp                                                                                                                                            
| software              = Fiji
| author                = {{Person|Bogovic}}
| maintainer            = {{Person|Bogovic}}
| source                = {{GitHub|org=saalfeldlab|repo=bigwarp}}
| latest version        = 2.1.1
| status                = stable
}}

== Description ==
Bigwarp is a tool for manual, interactive, landmark-based deformable image alignment. 
It uses the [[BigDataViewer]] for visualization and navigation, and uses a
[[wikipedia:Thin_plate_spline|Thin Plate Spline]] implemented
{{GitHub|org=saalfeldlab|repo=bigwarp|label=in Java}}
to build a deformation from point correspondences.

The interface enables landmark pair placement and displays the effects 
of the warp on-the-fly.

== Installation ==
Bigwarp comes with Fiji.
You can access it via ''Plugins {{arrow}} BigDataViewer {{arrow}} Big Warp'', or by modifying {{GitHub|org=saalfeldlab|repo=bigwarp|path=src/main/resources/scripts/bigwarp_fiji_demo.bsh|label=this example script}}.  If this is not visible in your installation, try updating Fiji with ''Help {{arrow}} Update Fiji.''

== Usage ==

Open two images in ImageJ, one ''moving'' and the other ''target'' and navigate to ''Plugins {{arrow}} BigDataViewer {{arrow}} Big Warp.'' A dialog will appear prompting selection of the moving and target images.

=== Getting Help ===
Press {{key press|F1}} at any time to open a help page with a listing of navigation and editing commands. 

=== Landmark point placement and display in the viewer ===

Landmark placements is done in ''Landmark mode'' which you enter by holding {{key press|Spacebar}}.
Users place pairs of corresponding points on  

The following table shows the available landmark placement commands and keystrokes. 
{| border="1" style="border-collapse:collapse;"
| style="padding: 5px;" | hold {{key press|Spacebar}}
| style="padding: 5px;" | Toggle ''Landmark mode'' 
|-
| style="padding: 5px;" | <''Landmark mode''>+{{key press|left-click}}
| style="padding: 5px;" | Clicking while in landmark mode adds a landmark point or selects and existing landmark.
|-
| style="padding: 5px;" | <''Landmark mode''>+{{key press|left-click}}+{{key press|drag}}
| style="padding: 5px;" | Clicking an existing point and dragging changes it's position. 
|-
| style="padding: 5px;" | <''Landmark mode''>+{{key press|Shift}}+{{key press|left-click}}+{{key press|drag}}
| style="padding: 5px;" | "Move" a point.  The initial click places a
landmark point for the moving image.  The release places a landmark
point for the target image.
|-
| style="padding: 5px;" | <''Landmark mode''>+{{key press|Ctrl}}+{{key press|left-click}}
| style="padding: 5px;" | "Pin" a point.  Add a landmark at the same location for both moving and target images.
|-
| style="padding: 5px;" | {{key press|Ctrl}} + {{key press|Z}}
| style="padding: 5px;" | Undo the last landmark point change.
|-
| style="padding: 5px;" | {{key press|Ctrl}} + {{key press|Y}}
| style="padding: 5px;" | Redo the last landmark point change.
|-
| style="padding: 5px;" | {{key press|V}}
| style="padding: 5px;" | Toggle point visibility in the viewer.
|-
| style="padding: 5px;" | {{key press|N}}
| style="padding: 5px;" | Toggle point name visibility in the viewer.
|}

=== Landmark selection and editing in the table ===

Some changes to landmarks can be done by interacting with the landmark table.

{| border="1" style="border-collapse:collapse;"
| style="padding: 5px;" | {{key press|left-click}}
| style="padding: 5px;" | Select row.
|-
| style="padding: 5px;" | {{key press|Ctrl}}+{{key press|left-click}}
| style="padding: 5px;" | Add row to selection.
|-
| style="padding: 5px;" | {{key press|Shift}}+{{key press|left-click}}
| style="padding: 5px;" | Select range of rows.
|-
| style="padding: 5px;" | {{key press|Esc}}
| style="padding: 5px;" | Deselect all rows.
|-
| style="padding: 5px;" | <''Landmark mode''>+{{key press|left-click}}
| style="padding: 5px;" | Removes one landmark.
|-
| style="padding: 5px;" | {{key press|right-click}} {{arrow}} Delete
| style="padding: 5px;" | Deletes a landmark pair (row in the table).
|-
| style="padding: 5px;" | {{key press|right-click}} {{arrow}} Delete all selected
| style="padding: 5px;" | Deletes all selected landmark pairs (row in the table).
|}

=== Notes on point addition and landmark pair selection ===

* Adding a new landmark pair selects that pair (row) in the table.
* If a row is "missing" a moving (target) landmark point, then it must be selected in order to add that missing point by clicking in the moving (target) viewer.  Then BigWarp will find the "next" row that is missing a moving (target) landmark, and select that row automatically.
* If the selected row is not missing a landmark, the next click will add a new landmark pair.
* If multiple rows are selected when a viewer is clicked, the result will be as though only the first row was selected.

=== Navigation and Visualization ===

Bigwarp inherits many image [[BigDataViewer#Basic_Navigation|navigation]], [[BigDataViewer#Adjusting_Brightness_and_Color|visualization]], and [[BigDataViewer#Grouping_Sources|grouping]] features with BigDataViewer, the details of which can be found on the [[BigDataViewer|BigDataViewer]] page
or on the help page.  BigWarp specific features are documented below.

The following table shows the available navigation commands using the mouse:

{| border="1" style="border-collapse:collapse;"
| style="padding: 5px;" | {{key press|Q}}
| style="padding: 5px;" | Align the non-active viewer with the active viewer. 
|-
| style="padding: 5px;" | {{key press|W}}
| style="padding: 5px;" | Align the active viewer with the non-active viewer.
|-
| style="padding: 5px;" | {{key press|R}}
| style="padding: 5px;" | Resets the active viewer.
|-
| style="padding: 5px;" | {{key press|U}}
| style="padding: 5px;" | Show warp visualization / grid dialog.
|-
| style="padding: 5px;" | {{key press|F6}}
| style="padding: 5px;" | Show moving image panel Visibility & and Grouping dialog.
|-
| style="padding: 5px;" | {{key press|F7}}
| style="padding: 5px;" | Show target image panel Visibility & and Grouping dialog.
|}

=== Import and Export ===

Landmarks can be exported and imported from plain text files using the drop down menu in the landmark table panel ( ''File {{arrow}} Export (Import) landmarks.'' )

[[Image:Bigwarp_export.png]]

The warped moving image can be exported as an in-memory or [http://rsbweb.nih.gov/ij/docs/guide/146-8.html virtual] ImagePlus.
A virtual ImagePlus is generally faster to generate but slower to browse,
whereas an in-memory ImagePlus will be slower to generate but faster to browse.

The exported image will have the same dimensions as the target image.
''Note: Take care when exporting very large data sets.''

[[Category:Plugins]]
[[Category:Visualization]]
[[Category:Transform]]
[[Category:Registration]]
