This page describes how to visualize the various data sets provided as part of the [http://www.diademchallenge.org/ Diadem Challenge] in Fiji, and in particular viewing the traced neurons with [[Simple Neurite Tracer]].

__TOC__

== Olfactory Project Neurons ==

This data set [http://www.diademchallenge.org/olfactory_projection_fibers_readme.html is described here].  I will go through loading the example "OP_1".  Each image stack in this data set is distributed as a directory of TIFF files, one per slice.  To load such a stack, go to "File > Import > Image Sequence" and select the file "1.tif".  You should be shown a dialog like this:

[[Image:Diadem_Challenge_Data-1.png]]

These default options should be fine - as you can see from the dialog it will have worked out that there are 60 image slices in that directory to be imported.  If you click OK you should get a normal image stack:

[[Image:Diadem_Challenge_Data-2.png]]

Unfortunately these TIFF files do not have the separation of these slices encoded correctly, so you should correct this manually.  If you go to "Image > Properties" you will see that the pixel width, pixel height and voxel depth are all set to the same value (0.3296485).  The [http://www.diademchallenge.org/olfactory_projection_fibers_readme.html page with information about the data set] tells us that the z-separation should be three times the x and y separation, so correct the voxel depth to 3 times 0.3296485, like this:

[[Image:Diadem_Challenge_Data-4.png]]

... and then press "OK".  To save yourself from having to re-enter this calibration information, and to be able to open the stack from the "Recent Files" menu, etc. I think it's helpful to now save this stack as a single TIFF.  So, I would go to "File > Save As > Tiff ..." and save this as OP_1.tif in the directory above the one with individual slices.

Now start the tracing plugin by going to "Plugins > Segmentation > Simple Neurite Tracer".  If you keep the default options, you should see a display like this:

[[Image:Diadem_Challenge_Data-6.png|750px]]

To load the SWC file with the supplied traces, click on "Load Traces / SWC File" and navigate to OP_1.swc.  When you have selected this file, you will see the following options dialog:

[[Image:Diadem_Challenge_Data-7.png]]

The important setting here is that you should have the "Ignore calibration" option selected.  You should not apply an offset or scale for this data set.  When you click OK you should see that the traces are overlayed in the stack window and in the 3D viewer:

[[Image:Diadem_Challenge_Data-8.png|750px]]

You may wish at this point to adjust the viewing options in the tracer's dialog to examine the tracings in detail:

[[Image:Diadem_Challenge_Data-9.png|750px]]

== Diadem Neocortical Layer 6 Axons ==

[http://www.diademchallenge.org/neocortical_layer_6_axons_readme.html The Neocortical Layer 6 Axons] data set is based on a set of image stacks that need to be stitched together.  The key point here is that you must use the offsets supplied by the Diadem challenge rather than allowing Fiji to stitch the automatically - the stitching will be subtly different.

Firstly, however, it will help to load each image sequence and save out the stack to a single TIFF image stack file.  For each of the 6 directories, do the following: go to "File > Import > Image sequence" and select the first file in the directory (01.tif).  After opening with the default options, save this out into the parent directory with the following names:

   directory 01 -> Tile_01_02.tif
   directory 02 -> Tile_02_02.tif
   directory 03 -> Tile_03_02.tif
   directory 04 -> Tile_03_01.tif
   directory 05 -> Tile_02_01.tif
   directory 06 -> Tile_01_01.tif

Now create a text file in the same directory called TileConfiguration.txt with the following contents, but changing the directory path to whereever these files are on your computer:

    # Define the number of dimensions we are working on
    dim = 3
    
    # Define the image coordinates
    /home/mark/diadem-examples/Neocortical/Tile_01_01.tif; ; (0.0, 0.0, 0.0)
    /home/mark/diadem-examples/Neocortical/Tile_02_01.tif; ; (468.0, -14.0, -1.0)
    /home/mark/diadem-examples/Neocortical/Tile_03_01.tif; ; (924.0, 3.0, -19.0)
    /home/mark/diadem-examples/Neocortical/Tile_01_02.tif; ; (73.0, 507.0, -5.0)
    /home/mark/diadem-examples/Neocortical/Tile_02_02.tif; ; (526.0, 484.0, 11.0)
    /home/mark/diadem-examples/Neocortical/Tile_03_02.tif; ; (952.0, 462.0, -21.0)

These offset values are taken from [http://www.diademchallenge.org/neocortical_layer_6_axons_readme.html the official page describing the data set].

Now you can stitch together the images using these offsets by going to "Plugins > Stitching > Stitch Collection of Images", browsing to the TileConfiguration.txt file you've just created and making sure you uncheck the box "compute overlap".  It should look something like this:

[[Image:Diadem_Neocortical_Layer_6_Axons-1.png]]

After clicking OK, this should stitch together all those stacks into one huge stack.  (If there are problems, you should see details of them in the log window.)

[[Image:Diadem_Neocortical_Layer_6_Axons-2.png|750px]]

Next, you should correct the Z-calibration of the stitched stack.  The data set page tells us that the z separation is 3.03 pixels, so open up "Image > Properties" and set the Voxel Depth to 3.03 times the Pixel Width:

[[Image:Diadem_Neocortical_Layer_6_Axons-3.png]]

Now you should save the stitched stack, and work from that from now on.  (Since the stitched stack isn't very large (156MB) one wonders why this wasn't distributed already stitched.)  Save the stack with "File > Save As > Tiff...".

To load the SWC files, start up the tracer with "Plugins > Segmentation > Simple Neurite Tracer".  You should see something like this after it has started, with the stack rendered in the 3D Viewer:

[[Image:Diadem_Neocortical_Layer_6_Axons-4.png|750px]]

You might have noticed that the offsets used in stitching above had some negative Y and Z values.  This means that when you load in the SWC files, you will need to apply an offset to compensate for this.  (0,0,0) in the stitched image will be at (0,-14,-21) in the space of the tracings, so when you click on "Import traces / SWC file" and have chosen (for example) NC_14.swc, you should expand the "Apply offset to SWC file co-ordinates" option and fill in these values:

[[Image:Diadem_Neocortical_Layer_6_Axons-7.png]]

Then the traces should load in the correct position with those offsets:

[[Image:Diadem_Neocortical_Layer_6_Axons-6.png|750px]]

== Cerebellar Climbing Fibers ==

We will go through loading in the CF_1 image stack from the [http://www.diademchallenge.org/cerebellar_climbing_fibers_readme.html Cerebellar Climbing Fibers] data set.  The raw data for this image is stored in RGB and about 3.4GB in size, so for convenience you may wish to load this as a virtual stack (i.e. one where the slices are loaded from disk as required), convert it to 8-bit and resave the file first.  In any case, I would recommend using a machine with 2GB of RAM (at the very least) to deal with these files.

To load the files as a virtual stack, go to "File > Import > Image Sequence ..." and select the first file in the sequence, "01.tif".  You will be presented with the import dialog, in which you should make sure that "Use virtual stack" is selected.

[[Image:Diadem_Cerebellar-1.png]]

(Note that the number of slices in the directory (34) was automatically set.)  You should now be able to browse through the stack:

[[Image:Diadem_Cerebellar-2.png|750px]]

After loading this you need to convert this to 8-bit.  You can do this in any number of ways, and if you're actively working on a tracing task with this data you will probably want to do this in such a way that picks out the brown coloured neuronal processes.  However, a simple way just for viewing purposes is to use the "Image > Color > RGB to Luminance" option.  (Another option is to use "Image > Type > 8-bit".)  This will produce results like this:

[[Image:Diadem_Cerebellar-3.png|750px]]

You can close the original virtual stack now.

It is a good idea to invert this image, since the 3D Viewer will make the low values of the image more transparent, and Simple Neurite Tracer assumes that neurons are brighter than their background.  So, go to "Edit > Invert" and select "Yes" in response to the question about whether to process all 34 images.  The results should look like this:

[[Image:Diadem_Cerebellar-4.png|750px]]

Before saving this out as a single 862MB stack, it is a good idea to correct the calibration of the image.  The [http://www.diademchallenge.org/cerebellar_climbing_fibers_readme.html data set web page] tells us that the separation between slices is 8.08 pixels.  So, if you bring up the "Image > Properties" dialog, then you can correct the voxel depth to be 8.08 times the pixel width:

[[Image:Diadem_Cerebellar-5.png]]

Now save this as a single TIFF stack called CF_1.tif by going to "File > Save As > Tiff ...", saving it in the directory above the one with the slices, to avoid confusion.

You can now start the tracer with Plugins > Segmentation > Simple Neurite Tracer.  This may take some time, since there is a lot of data to load in to the 3D viewer.  The result should look like this:

[[Image:Diadem_Cerebellar-6.png|750px]]

You may wish to adjust the transparency in the 3D viewer by selecting the image volume (left click on the image in the 3D viewer) and then going to "Edit > Attributes > Change Transparency...":

[[Image:Diadem_Cerebellar-7.png]]

Now, to load the traces click on "Load Traces / SWC File" and select CF_1.swc.  You will be presented with an options box like this:

[[Image:Diadem_Cerebellar-7b.png]]

Make sure that "Ignore calibration" is selected (as in that screenshot) and that there is no offset or scale set.  Once loaded you should be able to see the traces as here:

[[Image:Diadem_Cerebellar-8.png|750px]]

== Hippocampal CA3 Interneuron ==

FIXME: do a tutorial for this data set

== Neuromuscular Projection Fibers ==

FIXME: do a tutorial for this data set

[[Category:Tutorials]]
