{{Infobox
| software               = Fiji
| name                   = Atlas Toolkit
| author                 = [http://www.grocottlab.com GrocottLab]
| maintainer             = Timothy Grocott ([mailto:t.grocott@uea.ac.uk t.grocott@uea.ac.uk])
| filename               = Atlas_Toolkit_1.0-SNAPSHOT.jar
| source                 = {{GitHub|org=GrocottLab|repo=Atlas-Toolkit}}
| released               = November 16<sup>th</sup>, 2015
| latest version         = 1.0, May 6<sup>th</sup>, 2015
| status                 = stable, active
| category               = [[:Category:Registration|Registration]]
| website                = [http://www.grocottlab.com/software www.grocottlab.com]
}}The Atlas Toolkit plugin is a collection of tools developed to achieve group-wise elastic registration of 3D objects by decomposing the alignment problem into a sequence of orthogonal 2D elastic registrations, for which each object is registered to every other. These 2D elastic registrations are powered by the [[BUnwarpJ]] plugin, and registration is guided by the gross morphology of the corresponding 3D objects, which can be defined using the [[Segmentation Editor]] plugin.

==Installation of the plugin==
The plugin can be quickly installed via the project's update site. Please refer to the [[Update_Sites | '''tutorial''']] on how to add our update site to your Fiji installation.
Our update site has the following URL:

  '''<code><nowiki>http://sites.imagej.net/GrocottLab/</nowiki></code>'''

==What's in the toolkit?==
Atlas Toolkit includes a number of different tools to help building atlases. Many of these will be of limited use/interest.

For those interested in 3D image registration, the most important tools will be [[#Label Registration 3D|Label Registration 3D]] and [[#Apply Label Registration|Apply Label Registration]].

This complete list of tools is as follows:

- Extract Nuclear Signal

- Project to Segment Label

- [[#Label Registration 3D|Label Registration 3D]]

- [[#Apply Label Registration|Apply Label Registration]]

- Merge Registered Volumes

- Sample Volumes for Clustering

- Cluster Viewer

==Label Registration 3D==
===Video demonstration===
The following screencast demonstrates Label Registration 3D in use.

  '''<code><nowiki>https://www.youtube.com/watch?v=paUFYucNHa4</nowiki></code>'''

===Before starting...===
You will begin with a number of image stacks that you want to register together.

Prior to registration, the particular tissue(s) or object(s) of interest must be distinguished from the rest of their image stack through the process of manual segmentation. This involves generating a new 8-bit image stack (a '.label' file) in which each tissue or region of interest is represented by a unique numerical value, usually visualised by a unique colour.

The [[Segmentation Editor]] plugin is a convenient tool for efficiently segmenting multiple tissues of interest from a single image stack.

The resulting ‘.label’ files can then be used to perform non-rigid registration of equivalent tissues or objects from different image stacks [[#Using "Label Registration 3D"|using Label Registration 3D]].

===Using "Label Registration 3D"===
Once you have your '.label' files, you can use Label Registration 3D to register them together.

When you run this tool, it will keep prompting you for '.label' files. When you have told it where to find the last '.label' file, just click 'Cancel' to proceed to the registration.

You will then be prompted to select some basic parameters:

[[File:LabelRegistration3D-1.png]]

- "Select Channel (0 - 255):" allows you to select which of the labels (tissues/objects) within the '.label' files should be registered. Empty space/background will have a value of '0', while the first (possibly only) label will have a value of '1' and this is the default setting.

- "Number of iterations:" determines how many times the tool will attempt to register the '.label' files. More complex or dissimilar tissues/objects may require more iterations. Similarly, the more '.label' files you are registering, the more iterations may be required.

- "First Orthogonal Plane:" allows you to tell the tool which direction it should start from. Some tissues/objects may be more asymmetric in one particular plane and it may be advantageous to perform the first 2D registration in that plane.

On clicking "OK" the tool will register the specified '.label' files, displaying its progress as it does so.

Once the registration is complete, you will be prompted for a folder in which to store the results.

The results consist of the following files:

- Multiple '.tif' files, each containing a transformed version of one tissue/object.

- A single 'consensus.tif' file, which contains the consensus morphology for all registered tissue/objects.

- Multiple '.ots' files, each containing instructions for reproducing the transformation of a particular tissue/object. These '.ots' files can be used with the [[#Apply Label Registration|Apply Label Registration]] tool in order to reproduce a particular transformation, for example on the corresponding original image stack.

==Apply Label Registration==
Once a set of ‘.label’ files has been registered using [[#Label Registration 3D|Label Registration 3D]], the resulting ‘.ots’ files can be used to transform the original image stacks towards their shared consensus tissue/object morphology.

===Video demonstration===
The following screencast demonstrates Apply Label Registration in use.

  '''<code><nowiki>https://www.youtube.com/watch?v=2JwRZm5dst8</nowiki></code>'''

== Reference ==
Please cite the following article in which the Atlas Toolkit is described:

* Grocott, T. et al. Atlas Toolkit: Fast registration of 3D morphological datasets in the absence of landmarks. Sci. Rep. 6, 20732; doi: 10.1038/srep20732 (2016).

== License ==
This program is '''free software'''; you can redistribute it and/or modify it under the terms of the '''GNU General Public License''' as published by the Free Software Foundation ([http://www.gnu.org/licenses/gpl.txt http://www.gnu.org/licenses/gpl.txt]).

This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License for more details.  
----
[[Category:Plugins]]
[[Category:Registration]]
