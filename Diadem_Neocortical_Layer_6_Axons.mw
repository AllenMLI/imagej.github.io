== Diadem Neocortical Layer 6 Axons ==

[http://www.diademchallenge.org/neocortical_layer_6_axons_readme.html The Neocortical Layer 6 Axons] data set is based on a set of image stacks that need to be stitched together.  The key point here is that you must use the offsets supplied by the Diadem challenge rather than allowing Fiji to stitch the automatically - the stitching will be subtly different.

Firstly, however, it will help to load each image sequence and save out the stack to a single TIFF image stack file.  For each of the 6 directories, do the following: go to "File > Import > Image sequence" and select the first file in the directory (01.tif).  After opening with the default options, save this out into the parent directory with the following names:

   directory 01 -> Tile_01_02.tif
   directory 02 -> Tile_02_02.tif
   directory 03 -> Tile_03_02.tif
   directory 04 -> Tile_03_01.tif
   directory 05 -> Tile_02_01.tif
   directory 06 -> Tile_01_01.tif

Now create a text file in the same directory called TileConfiguration.txt with the following contents, but changing the directory path to whereever these files are on your computer:

    # Define the number of dimensions we are working on
    dim = 3
    
    # Define the image coordinates
    /home/mark/diadem-examples/Neocortical/Tile_01_01.tif; ; (0.0, 0.0, 0.0)
    /home/mark/diadem-examples/Neocortical/Tile_02_01.tif; ; (468.0, -14.0, -1.0)
    /home/mark/diadem-examples/Neocortical/Tile_03_01.tif; ; (924.0, 3.0, -19.0)
    /home/mark/diadem-examples/Neocortical/Tile_01_02.tif; ; (73.0, 507.0, -5.0)
    /home/mark/diadem-examples/Neocortical/Tile_02_02.tif; ; (526.0, 484.0, 11.0)
    /home/mark/diadem-examples/Neocortical/Tile_03_02.tif; ; (952.0, 462.0, -21.0)

These offset values are taken from [http://www.diademchallenge.org/neocortical_layer_6_axons_readme.html the official page describing the data set].

Now you can stitch together the images using these offsets by going to "Plugins > Stitching > Stitch Collection of Images", browsing to the TileConfiguration.txt file you've just created and making sure you uncheck the box "compute overlap".  It should look something like this:

[[Image:Diadem_Neocortical_Layer_6_Axons-1.png]]

After clicking OK, this should stitch together all those stacks into one huge stack.  (If there are problems, you should see details of them in the log window.)

[[Image:Diadem_Neocortical_Layer_6_Axons-2.png|750px]]

Next, you should correct the Z-calibration of the stitched stack.  The data set page tells us that the z separation is 3.03 pixels, so open up "Image > Properties" and set the Voxel Depth to 3.03 times the Pixel Width:

[[Image:Diadem_Neocortical_Layer_6_Axons-3.png]]

Now you should save the stitched stack, and work from that from now on.  (Since the stitched stack isn't very large (156MB) one wonders why this wasn't distributed already stitched.)  Save the stack with "File > Save As > Tiff...".

To load the SWC files, start up the tracer with "Plugins > Segmentation > Simple Neurite Tracer".  You should see something like this after it has started, with the stack rendered in the 3D Viewer:

[[Image:Diadem_Neocortical_Layer_6_Axons-4.png|750px]]

You might have noticed that the offsets used in stitching above had some negative Y and Z values.  This means that when you load in the SWC files, you will need to apply an offset to compensate for this.  (0,0,0) in the stitched image will be at (0,-14,-21) in the space of the tracings, so when you click on "Import traces / SWC file" and have chosen (for example) NC_14.swc, you should expand the "Apply offset to SWC file co-ordinates" option and fill in these values:

[[Image:Diadem_Neocortical_Layer_6_Axons-7.png]]

Then the traces should load in the correct position with those offsets:

[[Image:Diadem_Neocortical_Layer_6_Axons-6.png|750px]]

[[Category:Tutorials]]
