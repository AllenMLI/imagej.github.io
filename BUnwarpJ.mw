{{Infobox
| software               = Fiji
| name                   = bUnwarpJ
| author                 = {{Person|Iarganda}}
| maintainer             = Ignacio Arganda-Carreras ([mailto:iargandacarreras@gmail.com iargandacarreras@gmail.com])
| filename               = {{Maven | g=sc.fiji | a=bUnwarpJ_}}
| source                 = {{GitHub|org=fiji|repo=bUnwarpJ}}
| released               = July 20<sup>th</sup>, 2006
| latest version         = 2.6.3, June 25<sup>th</sup>, 2015
| status                 = stable, active
| category               = [[:Category:Registration|Registration]]
| website                = [http://biocomp.cnb.csic.es/~iarganda/bUnwarpJ/ bUnwarpJ]
}}{|
|style="vertical-align:top" |[[Image:BUnwarpJ_scheme.png|390px|bUnwarpJ scheme: bidirectional Unwarping in Java.]]
|}

This ImageJ/Fiji plugin performs '''2D image registration based on elastic deformations''' represented by B-splines. The invertibility of the deformations is enforced through a consistency restriction. 

For a quick start, you can have a look at the [http://imagejdocu.tudor.lu/doku.php?id=video:aligning:bunwarpj_basic_tutorial video tutorial] (awarded at the Second ImageJ User & Developer Conference).


== General Description ==
[[bUnwarpJ]] is an algorithm for '''elastic and consistent image registration''' developed as an ImageJ plugin. It performs a simultaneous registration of two images, A and B. Image A is elastically deformed in order to look as similar as possible to image B, and, at the same time, the "inverse" transformation (from B to A) is also calculated so a pseudo-invertibility of the final deformation could be guaranteed. Two images are given as a result: the deformed versions of A and B images.
== Technical Explanations ==
This image registration algorithm is based on the minimization of an energy functional that includes the dissimilarity between the source and target images -in both directions- <math>E_{img}</math>, an optional landmark constraint <math>E_{\mu}</math>, a regularization term <math>(E_{div} + E_{rot})</math>, and an energy term <math>E_{cons}</math> that accounts for the geometrical consistency between the elastic deformation in both directions. Namely, the energy function is given by

:::::<math> E = w_iE_{img} + w_{\mu}E_{\mu} + (w_dE_{div} + w_rE_{rot}) + w_cE_{cons} </math>

Where the weights of every term are set by the user in the main window of the plugin. The optimization process is a [https://en.wikipedia.org/wiki/Levenberg%E2%80%93Marquardt_algorithm Levenberg-Marquardt] minimization enhanced by a [https://en.wikipedia.org/wiki/Broyden%E2%80%93Fletcher%E2%80%93Goldfarb%E2%80%93Shanno_algorithm Broyden-Fletcher-Goldfarb-Shanno (BFGS)] estimate of the local Hessian of the goal function, and both, images and deformations are represented by [https://en.wikipedia.org/wiki/B-spline cubic B-splines].

== Downloads ==
The latest stable distribution of bUnwarpJ can always be found included within Fiji and the '''latest released JARs are available in the''' [https://github.com/fiji/bUnwarpJ/releases GitHub repository]. If you detect any bug, please feel free to contact the maintainer. Any feedback will be very appreciated.
=== API documentation ===
The API documentation can be reached [http://javadoc.imagej.net/Fiji/bunwarpj/package-summary.html online].
=== Installation ===
In Fiji, [[bUnwarpJ]] comes installed by default. In ImageJ, you must simply download the latest bUnwarpJ_.jar to the Plugins folder of ImageJ, restart ImageJ and there will be a new "Registration > bUnwarpJ" command in the Plugins menu.

To execute bUnwarpJ as a macro or from the command line, see the description in the User Manual.

== Documentation ==
* Main site's [http://biocomp.cnb.csic.es/~iarganda/bUnwarpJ/index.html#User_manual user manual]
* [http://biocomp.cnb.csic.es/~iarganda/bUnwarpJ/API/index.html API documentation]

== References ==
The algorithm implemented on bUnwarpJ and its technical explanations are detailed on the paper:
* I. Arganda-Carreras, C. O. S. Sorzano, R. Marabini, J.-M. Carazo, C. Ortiz-de Solorzano, and J. Kybic, [http://cmp.felk.cvut.cz/ftp/articles/kybic/Arganda-CVAMIA2006.pdf "Consistent and Elastic Registration of Histological Sections using Vector-Spline Regularization,"] Lecture Notes in Computer Science, Springer Berlin / Heidelberg, volume 4241/2006, CVAMIA: Computer Vision Approaches to Medical Image Analysis, pages 85-95, 2006.

The related paper of the previous work ([[UnwarpJ]]) is:
* C.Ó. Sánchez Sorzano, P. Thévenaz, M. Unser, "Elastic Registration of Biological Images Using Vector-Spline Regularization", IEEE Transactions on Biomedical Engineering, vol. 52, no. 4, pp. 652-663, April 2005.

== License ==
This program is '''free software'''; you can redistribute it and/or modify it under the terms of the '''GNU General Public License''' as published by the Free Software Foundation ([http://www.gnu.org/licenses/gpl.txt http://www.gnu.org/licenses/gpl.txt]).

This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License for more details.  
----
[[Category:Plugins]]
[[Category:Registration]]
