<tt>!!Work in Progress!! 

This page centralizes documentation and current performance of the morphological operation package in imglib2. As the package is under development, the information here might be irrelevant or useless</tt>


== Rectangular structuring element ==

=== Decomposition ===

A rectangle can be decomposed in a series of orthogonal lines, in any dimensions, considerably diminishing the number of pixels to iterate. 

==== 2D case ====

If the image has <code>M</code> pixels, and that the rectangle is a square of side 
<code>R</code>, then the non-optimized case should have a processing time proportional to <code>M × R²</code>. The optimized case replace iterating over the square by iterating twice over a line of length <code>R</code>. Therefore its processing time should be proportional to <code> 2 × M × R</code>. 

The performance improvement should therefore be equal to <code>R / 2</code>. A linear fit of the actual curve rather shows that the law is <code> 0.73 × R + 0.37</code>. This extra benefit - I don't why it's there. 

<gallery heights="300" widths="300" mode="packed-hover">
File:RectangleStrel2DPerformance.png|Processing time for the dilation of a 100x100 image.
File:RectangleStrel2DPerformanceComparison.png|Processing time ratio.
</gallery>

==== 3D case ====

Here the standard case takes a time proportional to <code>M × R³</code>, and the optimized case a time proportional to <code> 3 × M × R</code>. Therefore the performance ratio should be  <code>R² / 3</code>. A fit shows that this ratio follows <code>0.63 × R² + 0.57 × R + 0.48</code>.

<gallery heights="300" widths="300" mode="packed-hover">
File:RectangleStrel3DPerformance.png|Processing time for the dilation of a 40x40x40 image.
File:RectangleStrel3DPerformanceComparison.png|Processing time ratio.
</gallery>


== Diamond structuring element ==

=== Shape ===

A diamond strel has the following shape in 2D, for instance with a radius of 3 (It extends over 7 pixels wide):
<pre>┌───────┐
│   █   │
│  ███  │
│ █████ │
│███████│
│ █████ │
│  ███  │
│   █   │
└───────┘</pre>

And in 3D:
<pre>Z = 0:    Z = 1:    Z = 2:    Z = 3:    Z = 4:    Z = 5:    Z = 6:    
┌───────┐ ┌───────┐ ┌───────┐ ┌───────┐ ┌───────┐ ┌───────┐ ┌───────┐ 
│       │ │       │ │       │ │   █   │ │       │ │       │ │       │ 
│       │ │       │ │   █   │ │  ███  │ │   █   │ │       │ │       │ 
│       │ │   █   │ │  ███  │ │ █████ │ │  ███  │ │   █   │ │       │ 
│   █   │ │  ███  │ │ █████ │ │███████│ │ █████ │ │  ███  │ │   █   │ 
│       │ │   █   │ │  ███  │ │ █████ │ │  ███  │ │   █   │ │       │ 
│       │ │       │ │   █   │ │  ███  │ │   █   │ │       │ │       │ 
│       │ │       │ │       │ │   █   │ │       │ │       │ │       │ 
└───────┘ └───────┘ └───────┘ └───────┘ └───────┘ └───────┘ └───────┘ </pre>

It is the crudest approximation of a sphere.

=== Decomposition ===

The diamond strel can be effectively decomposed in 2D (and 1D) using the logarithmic decomposition in extreme sets, as explained in <ref name="BoomgardVanBalen">Rein van den Boomgard and Richard van Balen, [http://www.sciencedirect.com/science/article/pii/1049965292900553.htm Methods for Fast Morphological Image Transforms Using Bitmapped Binary Images], CVGIP: Models and Image Processing, vol. 54, no. 3, May 1992, pp. 252-254.</ref>. The shape is then decomposed in a minimal series of smaller diamond and diamond tips. The decomposition is exact, giving the same result that of the non-decomposed version. 

In 3D and higher dimensionalities, the logarithmic decomposition cannot be done, and we rely on a more classical linear decomposition (also well explained in <ref name="BoomgardVanBalen"/>). Here is a comparison on how the decomposed version performs versus the non-decomposed one.

==== 2D performance ====

<gallery heights="300" widths="300" mode="packed-hover">
File:DiamondStrel2DPerformance.png|Processing time for the dilation of a 100x100 image.
File:DiamondStrel2DPerformanceComparison.png|Processing time ratio.
</gallery>

It is worth using a decomposition above a radius of 4.

==== 3D performance ====


<gallery heights="300" widths="300" mode="packed-hover">
File:DiamondStrel3DPerformance.png|Processing time for the dilation of a 40x40x40 image.
File:DiamondStrel3DPerformanceComparison.png|Processing time ratio.
</gallery>

It is worth using a decomposition in almost any cases.







<references/>
