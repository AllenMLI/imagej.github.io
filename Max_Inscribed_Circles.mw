{{Infobox
| name                   = Max Inscribed Circles
| software               = Fiji
| author                 = Olivier Burri, Romain Guiet
| maintainer             = Olivier Burri
| filename               = Max_Inscribed_Circle.jar
| released               = August 2015
| latest version         = July 2016
| source                 = {{GitHub|org=ptbiop|repo=ijp-max-inscribed-circles}}
| status                 = stable
| website                = [http://biop.epfl.ch/INFO_Facility.html#staff BIOP Staff Page]
}}

== Purpose ==
This is an implementation of the Largest Inscribed Circle algorithm using an euclidean distance map. The algorithm is looped until a circle diameter smaller than the defined minimum diameter is found. 
The code for this plugin was inspired by this [http://www.mathworks.ch/matlabcentral/fileexchange/30805-maximum-inscribed-circle-using-distance-transform Matlab Central function]

[[File:Max_largest_circ_dialog2.png |500px|thumb|right|Plugin Dialog choices]]

== Details ==
As of July 26th 2016, the plugin has been rewritten with a new algorithm to make it run much faster.. See the faster implementation details figure.  
[[File:Max-Circles-Algorithm-Overview.png|400px|thumb|right|Faster implementation details]]

The previous implementation would calculate a distance map, then find the max value, place a circle and repeat. This was making it very slow for small circle diameters or large images as it needed to make one distance map calculation per circle on the whole image. 

By using a Local Maxima Finder, we can draw multiple circles on a single pass, provided that these are 
# The largest distances on the distance map image
# Not overlapping with one another

That way when there are plenty of circles that are the same size, we can draw them all at the same time. 
== Installation == 
This plugin is available from the {{ListOfUpdateSites|BIOP Update Site}}
This places it in a "BIOP" Folder in the plugins directory of Fiji/ImageJ

== Use ==
Call up the plugin using ''Plugins->BIOP->Max Inscribed Circles...''.

You can select the smallest circle diameter after which it will stop looking, and whether you want the plugin to run on the current selection or the current image mask. 

It will add all the found circles to the ROI Manager.

Setting the Minimum Disk Diameter to 0 will return a single ROI with the largest inscribed circle.

[[File:Max_largest_circ_beforeafter.png|400px|thumb|right|Result of Plugin on whole image]]


== Macro Recordable ==

Making use of the GenericDialog class, the plugin is macro-recordable.
<source lang="java">
run("Max Inscribed Circles...", "minimum=20");
</source>

== Running from a Plugin == 
What you need to run this in a plugin is 
<source lang="java">
import ch.epfl.biop.MaxInscribedCircles;
</source>

And then call the static method
<source lang="java">
//imp must be an 8-bit binary image
ArrayList<Roi> circles = MaxInscribedCircles.findCircles(ImagePlus imp, double minD, boolean isSelectionOnly);
</source>

Set the last argument <pre>isSelectionOnly</pre> to true if you want to fit circles in the current selection. If you'd like to use the pixel mask, set it to false.


== Notes ==

The accuracy is not perfect as we are using the distance map which has finite values. But for most practical purposes (Circles larger than 2 pixels in diameter), it should be sufficient.

[[Category:Plugins]]
