{{Infobox Plugin
| name                   = Blob Tracking
| software               = Fiji
| author                 = [[User:Alex-krull | Alexander Krull]],  [[User:damienrj | Damien Ramunno-Johnson]]
| maintainer             = [[User:Alex-krull|Alexander Krull]],  [[User:damienrj | Damien Ramunno-Johnson]]
| source                 = https://github.com/alex-krull/fiji
| released               = April ?<sup>th</sup>, 2013
| latest version         = April ?<sup>st</sup>, 2013
| status                 = PreRelease, active
| category               = [[:Category:Tracking|Tracking]]
}}

This software is a tool for the tracking of low-light sub-resolution objects in fluorescent microscopy. It can be applied in other fields as well. The plugin implements the localization algorithm described in the following paper:
"A Divide and Conquer Strategy for the Maximum Likelihood localization of Low Intensity Objects" By Alexander Krull et al, 2013 (Final Journal).

==Installation of the plugin== 
The plugin can be easily installed via the projects update site.

===Add the project's update site===
Please refer to the [[Update_Sites | tutorial]] on how to add our update site to your Fiji installation.  
Our update site has the following URL:

  '''<code><nowiki>http://sites.imagej.net/Alex-krull/</nowiki></code>'''

[[File:LLTT_Install4.jpg]]

===Install the required files===
[[File:LLTT_Install5.jpg]]

Install or update all 6 items shown above by hitting '''Apply changes'''.
Please restart Fiji afterwards.

==Load the data==
[[Image:OpenData.png]]

Load the image stack or hyper stack to be tracked. Use whichever method you prefer in Fiji.

==Starting the Plugin==

[[Image:LLTT_Start1.jpg]]

After the data is loaded, start the plugin by clicking:

'''plugins->Tracking->Low Light Tracking Tool'''

==2D Data==

[[Image:LLTT_GlobalOptions2d.jpg]]

You will be asked to enter three values. Cameras used in microscopy often add a bias or '''Intensity Offset''' in order to avoid negative values caused by read out noise. This quantity should be specified here, in order to obtain optimal tracking results. If you are using an EMCCD camera you should specify the mean '''EMCCD gain''' that was used. Otherwise set it to ''1.0''. Finally you have to provide the ratio ('''Electrons per A/D count''') at which the analog digital unit in your camera converts photo electrons into A/D counts. Please consult you camera's specs sheet to obtain this information.

[[Image:Opendatasmall.png]]

When the plugin starts you have three windows.  The main data window lets you move through the slices like normal. On the sides you see the two kymographs, which make is easier to see movement over time. 

[[Image:Opendatalarge.png]]

If you would like the windows to become larger or smaller, change the size of the data window and then select arrange windows, from the view menu. Or use Ctrl-W.  Arrange windows, will also organize the windows if they have become scattered.

[[Image:Controlwindownew.png]]

The control panel is the other window you will see that will allow you to do the tracking.

==Navigation==
The yellow lines in the kymographs indicate what frame you are currently working on. If you work with 3D data yellow lines in the side projections indicate what slice you are looking at. 
You have three ways of navigating through your stack or hyper stack:
* You can use ImageJ/Fiji slider controls below the main window.
* You can set frame number, slice number and channel number in the control window.
* You can use your middle mouse button to directly click into one of the kymographs to set the frame number. If you are working with 3D data you can click into one of the side projections with your middle mouse button to set the slice number.

===Create Session===

[[Image:NewSession.png]]

Click on the New Session button, or select from the menu.  The New session window opens.  Here you can pick a name for the session, your tracking method, and which channel you want to track.  

====Tracking Methods====

===Pick Session Options===

[[Image:SessionOptions.png]]

After clicking Ok, a new window will open. In this window you can choose a manual sigma, or select automatic sigma.  Min and Max are only used if automatic is selected. 

You also can set your quality threshold.  Smaller numbers are higher quality, while larger numbers are lower quality but faster. 

Automatic sigma can also be slower, this is more so for 3D data.

This can be changed from the Session Options menu, under edit.

===Select Objects to Track===
To track an object, make sure the cross hair icon in the Fiji toolbar is selected and then double click roughly on the object you would like to track in the main window. This will create a new trace which is shown a circle. An accordant entry will appear in the table in the control panel. You can select the traces by clicking on them here or directly in the main window to move them around or edit them. Multiple traces can be selected by holding the shift or control key when selecting.

[[Image:CreateDots.png]]

You can change a trace's label by clicking on the text in the label field, or change the color by clicking on the colored area.

===Edit Dots===

[[Image:ObjectOption.png]]

If at this point you find that the parameters you picked were less ideal you can change the parameters. If you change the session options, that only affects new selections. So you have two options, delete the old ones, or change their parameters with the edit Object selection from the edit menu.

===Start Tracking===

Only the highlighted objects will be tracked.  So in this example, both are highlighted and will be tracked at the same time.

At this point you have three options.  

First, if you have automatic sigma selected you can use the optimize button. This will optimize the sigma value, and then you can turn off automatic sigma for each object. This will make the tracking faster.

Second, if you try to track fast moving objects you can select the Multiscale method. This will use iterative smoothing in each frame to find the object. You can change the default behavior in the edit menu.

[[Image:MScaleOptions.png]]

Third, click on Start Tracking.

===Result===

[[Image:Result1.png]]

You can watch the trace fill in the kymograph line as the tracking is in progress.  If you see the tracking looks incorrect and lost the object, you can click on Stop Tracking and adjust the object location and the software will resume from the new starting point.

[[Image:Result2.png]]

The table now contains more information, with the first frame of the trace, and the last frame.  Double clicking on the ID# of the object will jump the frame number to the beginning and end of the trace. 

The tracking results are already saved automatically by default. You can turn that off by unchecking the Auto Save box. The results can than be saved using the save button.
They by default stored in the directory of the image stack you are working on.
The file format is described [[Low_Light_Tracking_Tool#File_format | below]].

You can also reload previously tracked data and undo any unsaved changes by pressing the reload button. If you want to open data which is stored in a different location you can load it by clicking on the address bar and navigating to the data's location. You can then re-track, or examine the data.

==3D Data==

When working with 3D data you will be asked to provide the ''Î”Z ratio'' in addition to the three other values. 

The z ratio, is the slice thickness, divided by the pixel width. This value is only used for 3D data.
Example: My pixel size for my data is 100 nm, and my slice thickness is 200 nm. I would then enter a value of 2.

[[Image:NewWindows.jpg]]

3D data is very similar to 2D data, there are just a few more windows that open when you start. The data window, and the kymographs appears, but a second set of windows appear.  A max Z projection window, and max Y and X projects. The side projections are useful to place your starting tracking in the correct slice. So before clicking on the object in the data window, change the z to the correct plane first. 

Otherwise, tracking function is the same. It is best to optimize the sigma value for 3D tracking, and then use a fixed value to increase speed.

[[Image:NewWithDot.jpg]]

==Tips==

* If you have multichannel data, each channel needs its own session.  You can select which sessions are visible by checking their boxes in the Visible Sessions list. You can use the current session drop down menu to switch between sessions. 
* Using the Merge, Split, Trim, and Delete buttons allows you to edit your traces by combining or deleting them. One useful example is if your object disappears periodically but you know that it is not a new object, and would like to combine the two separate traces you create. 
* You can zoom into the kymographs by moving the cursor over the kymograph window and holding down shift, while using the scroll wheel on the mouse.

==File format==
The tracking results are stored in text files with the ending '.trcT'. Each file holds the result of one trace. The structure of the file name is the following:

<name of image file>_<name of session>_<label of trace>_<id of trace>.trcT

The files are created in the working directory. Each file begins with some lines starting with '#'. These lines store information for the tracking program they will be ignored by most programs like matlab or gnuplot potentially used to further analyze the data.
This meta information is followed by columns of data holding the actual tracking results. 
The columns have the following meaning:
* column 1 frame number
* column 2 trace id
* column 3 x-position in pixels
* column 4 y-position in pixels
* column 5 z-position in pixels
* column 6 the standard deviation (in x and y) of the Gaussian used as Point Spread Function PSF
* column 7 the standard deviation (in z) of the Gaussian used as Point Spread Function PSF
* column 8 the maximum value of sigma in case sigma is determined automatically
* column 9 boolean value indicating if sigma was fixed (1) or determined automatically (0)
* column 10 boolean value indicating if object was assumed to be coupled (assumed to have the same flux and sigma) with others.
* column 11 the estimated flux
* column 12 the estimated background flux per pixel
* column 13 the total estimated background flux in the considered window
* column 14 the number of pixels in the considered window
* column 15 the fraction of flux in the considered window assumed to belong to the tracked object
* column 16 the total estimated flux in the considered window

== License ==
This program is free software; you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation (http://www.gnu.org/licenses/gpl.txt).
 

This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.
[[Category:Tutorials]]
