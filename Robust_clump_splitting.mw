{{Infobox
| software               = Fiji
| name                   = Robust Clump Splitting
| author                 = {{Person|LouiseBloch}}, {{Person|Twagner}}
| maintainer             = {{Person|LouiseBloch}}, {{Person|Twagner}}
| filename               = ij_robust_split.jar []
| source                 = Github [https://github.com/thorstenwagner/ij-robust-split]
| latest version         = v1.0.0 (04 Sep 2016)
| status                 = active 
}}


== Purpose ==
This plugin is an implementation for concavity-based clump splitting of the algorithms described in:

''Kumar, S., Ong, S.-H., Ranganath, S., Ong, T., und Cheq, F.
(2005). A rule based Approach for robust clump splitting. Pattern Recognition,
39(6), pp.1088–1098.
''

''Farhan, M., Yli-Harja, O., und Niemistö, A. (2013). A novel
method for splitting clumps of convex objects incorporating image intensity and
using rectangular window-based concavity point-pair search. Pattern Recognition,
46(3), pp.741–751.''
 
and

''Wang, H., Zhang, H., und Nilanjan, R. (2011). Clump splitting via
bottleneck detection. IEEE International Conference Image Processing, 2, pp.61–64.''

It depends on the [http://imagej.net/IJ_Blob IJ-Blob] library, the [https://github.com/hharrison/vecmath Vecmath] library, the [https://www.csie.ntu.edu.tw/~cjlin/libsvm/ LIBSVM] library and the [http://java-ml.sourceforge.net/ JavaML] library.
== Examples ==

==Plugin usage ==
If you start the plugin you can choose between two main uses. Choose if you either want to split clumps of an image or want to train SVM to optimize parameters <math>c_1</math> and <math>c_2</math>. To train the SVM you need to have input data.

[[File:Eingabemaske2.png]]
===Detection Types===
The plugin supports different types of split lines, concavity region detection and concavity pixel detection. If you want to split a clump you have to choose, what kind of detection you want to use.

[[File:PluginScreenshot1.png]]
====Split Lines====
The plugin supports different split line types which should be specified:

'''Straight Split Line:''' The straight split Line is a straight line between two concavity pixels. Use it, if no intensity information for better split lines is available.

[[File:StraightSplitline.png]]

'''Geodesic Distance Split Line:''' The geodesic distance split line uses the path of maximum intensity change between two concavity pixels. It is detected by the algorithm of ''Wang et al.'' Use it, if the individual objects can be distinguished by intensity and the split lines are not too convex.

[[File:GeodesicDistanceSplitLine.png]]

'''Maximum Intensity Split Line:''' The maximum intensity split line uses the path of maximum intensity between two concavity pixels. It is detected by the algorithm of ''Wang et al.'' Use it, if the intensity of the individual objects have higher at the edge, than in the center and the split lines are not too convex.

[[File:MaximumIntensitySplitLine.png]]

'''Minimum Intensity Split Line:''' The minimum intensity split line uses the path of minimum intensity between two concavity pixels. It is detected by the algorithm of ''Wang et al.'' Use it, if the intensity of the individual objects is lower at the edge, than in the center and the split lines are not too convex.

[[File:MinimumIntensitySplitLine.png]]

'''Maximum Intensity Split Line Farhan:''' The maximum intensity split line uses the path of maximum intensity between two concavity pixels. It is detected by the algorithm of ''Wang et al.'' Use it, if the intensity of the individual objects have higher at the edge, than in the center and there are no clumps without intensity information, and the split line does not often change orientation.

[[File:MaximumIntensitySplitLine.png]]

'''Minimum Intensity Split Line Farhan:''' The minimum intensity split line uses the path of minimum intensity between two concavity pixels. It is detected by the algorithm of ''Farhan et al.'' Use it, if the intensity of the individual objects is lower at the edge, than in the center and there are no clumps without intensity information, and the split line does not often change orientation.

[[File:MinimumIntensitySplitLine.png]]
====Concavity Region Detection====
The plugin supports different concavity region detection types. It specifies, in which way a concavity region is detected.

'''Detect outer concavity regions by convex hull:''' The concavity region detection by convex hull corresponds to the algorithm of ''Kumar et al.'' Concavity regions are detected, if there is a difference between convex hull and contour of the clump. Use this detection, if there are few clumps with less complex concavity regions.

[[File:ConvexHull.png]]

'''Detect outer concavity regions locally:''' The local concavity region detection follows algorithm of ''Farhan et al.'' Concavity regions are detected, by iterate along the contour and look for local concavity regions. Use this detection, if there are complex clumps containing of many individual objects.

[[File:Farhan.png]]

====Concavity Pixel Detection====
The plugin supports different concavity pixel detection types. The chosen type specifies which and how many concavity pixels can be detected.

'''Detect all concavity pixels:''' If all concavity pixels should be detected, the plugin is looking for all local concavity pixels. Use it, if you have choosen the concavity region detection by convex hull.

[[File:AllPixels.png]]


'''Detect all concavity pixels with largest concavity depth:'''
If all concavity pixel with largest concavity depth should be detected, the plugin is looking for the global concavity pixels of a concavity region. Use it, if you have choosen the local concavity region detection.

[[File:LargestPixels.png]]
===SVM===
==Parameters==
As already mentioned the main algorithm follows the publication of ''Kumar et al.'' The presented algorithm to specify a valid split line depends on lots of parameters, as you can see below. Not every parameter is needed for every split line type and concavity region detection

[[File:PluginScreenshot3.png]]

'''background color:''' Choose the color of your background. Choose white, if objects are darker than the background, and black if objects are lighter than the background.

'''is already preprocessed''' Choose if your picture is already preprocessed. If it is unchecked, preprocessing will be executed before the algorithm is started. The default-preprocessing is: binarization, erosion, gaussian blur (<math>\sigma=2</math>), dilation

'''Show concavity regions''' If it is checked, an overlay shows detected concavity regions, this could help to detect good thresholds and to detect mistakes in detection.

[[File:ConcavityRegions.png]]

'''Show concavity pixels and split points''' If it is checked, an overlay shows detected concavity pixels, this could help to detect good thresholds and to detect mistakes in detection.

[[File:ConcavityPixels.png]]

'''write data in file to train SVM''' If it is checked, data for the SVM-Model is written in a file you can choose.

'''binarization threshold''' Threshold to binarize an image. Default: Detected value for the image by ImageJ default method.

'''concavity-depth threshold''' Largest distance of a concavity region in pixels <math>CD_i</math>. Threshold should be smaller than smallest concavity-depth value of a valid concavity pixel. 

'''saliency-threshold''' The ratio of concavity-depth and distance of two concavity pixels, increase, if less split lines are detected.
<math>SA_{i,j}=\frac{\min(CD_i,CD_j)}{\min(CD_i,CD_j)+ d(C_i,C_j)}</math>

'''concavity-concavity-alignment-threshold''' Angle between orientation of the two concavity regions. <math>CC_{ij}= \pi - \cos^{-1}(v_i \cdot v_j)</math>. Threshold should be greater than <math>\max{|180-|\theta_i-\theta_j||}</math> of all valid split lines.

'''concavity-line-alignment-threshold''' Angle between orientation of the concavity pixel of a split line and the split line. <math>CL_{ij}=\max{\cos^{-1}(v_i \cdot u_{ij}),\cos^{-1}(v_j \cdot (-u_{ij})))}</math> 

'''concavity-angle-threshold''' Angle of a concavity region. <math>CA=\angle C_{i1}C_iC_{i2}</math> Threshold should be larger, than the largest angle of a concavity region where a split line between concavity pixel and contour point is expected.

'''concavity-ratio-threshold''' Ratio between largest and second largest concavity region. <math>CR=\frac{CD_m}{CD_n}</math> Threshold should be smaller than the largest ratio of valid split line between concavity pixel and contour point.

'''inner-contour-parameter''' Sampe constant for inner contour, if the inner contour is large and round, choose a large constant, else choose a small constant.

'''outer-contour-parameter''' Sampe constant for outer contour. If concavity regions are big, choose a large value, otherwise choose a small value.

'''picture section for intensity''' For split line detection of ''Wang et al.'' you need to determine a picture section, where the split line should be detected. Choose a large value if clumps and split lines are large and a small value if clumps and split lines are small.

'''<math>c_1</math>''' Parameter to validate a splitline, for an optimal value train SVM.

'''<math>c_2</math>''' Parameter to validate a splitline, for an optimal value train SVM.

'''<math>\chi</math>-threshold''' Parameter to validate a splitline. <math>\chi = \frac{c_1*CD_i+c_1*CD_j+c_2}{d(C_i,C_j)+c_1*CD_i+ c_1*CD_j+c_2}</math> Decrease threshold value if there are less split lines.

=Installation=

=How to cite=
