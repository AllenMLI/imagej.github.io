== TUNEL Cell Counter ==
 <span style="color: red">'''THIS PAGE IS CURRENTLY UNDER CONSTRUCTION.'''
{{Infobox
| logo                   = [[Image:fiji-icon.png|96px]]
| software               = Fiji
| name                   = TUNEL Cell Counter
| author                  = [[User:Daniel E. Maidana| '''Daniel E. Maidana, M.D.''']] <br> [https://connects.catalyst.harvard.edu/Profiles/display/Person/39774 '''Demetrios G. Vavvas, M.D., Ph.D.''']
| maintainer           = '''Daniel E. Maidana, M.D.''' <br> Angiogenesis Laboratory <br>Massachusetts Eye and Ear Infirmary <br> Harvard Medical School ([mailto:Daniel_Maidana@MEEI.HARVARD.EDU Daniel_Maidana@meei.harvard.edu])
| filename              = [https://github.com/DanielMaidana/TUNEL_Cell_Counter/archive/master.zip TUNEL Cell Counter]
| source                 = [https://github.com/DanielMaidana/TUNEL_Cell_Counter/blob/master/TUNEL%20Cell%20Counter.ijm TUNEL Cell Counter Code]
| released              = August 8<sup>th</sup>, 2015
| latest version      = August 8<sup>th</sup>, 2015
| status                  = Stable, active, and validated
| category               =[[:Category:Plugins|Plugins]]
| website                = [https://github.com/DanielMaidana/TUNEL_Cell_Counter TUNEL Cell Counter at GitHub]
}}<br>
'''TUNEL Cell Counter''' is a free, open source plugin created for ImageJ 2 and FIJI, developed by Daniel E. Maidana, M.D. and Demetrios G. Vavvas, M.D., Ph.D. at the Angiogenesis Laboratory, Massachusetts Eye and Ear Infirmary, Harvard Medical School. TUNEL Cell Counter has been validated for TUNEL assay quantitation in retinal cryo-sections. TUNEL Cell Counter is able to analyze digital images obtained from fluorescent microscopes, segment the outer nuclear (ONL) and inner nuclear layer (INL), and count TUNEL-positive (TUNEL<sup>+</sup>) cells in each retinal layer. After analysis, TUNEL Cell Counter generates an array with several output variables. Additionally, the macro generates a merged image with segmented layers and quantitated cells, for visual assessment of macro performance. 
__TOC__

== Overview ==
TUNEL Cell Counter is a custom-built and validated ImageJ macro that processes digital images from retinal TUNEL assay. It segments retinal outer nuclear (ONL) and inner nuclear layers (INL) and quantitates TUNEL+ cells in these layers. A detailed validation of this macro has been submitted for publication and is currently under peer review.

== Before You Start ==
Please read carefully before using this macro.
You will need the following information before you start quantitating images.
=== Microscope Calibration ===
[[File:Scale.png|250px|thumb|right|Replace the value 3095.975 in the source code with your microscope spatial scale.]]
To convert pixels to mm<sup>2</sup>, the image spatial scale is required. This can be found in the image metadata or in the microscope's bundled software.
:For validation purposes, we acquired images with Axio Imager M2 fluorescence microscope (Carl Zeiss Inc., NY) using a 20x/0.8 air objective. The spatial scale was: 3095.975 pixels/mm.
<source lang="java">
  run("Set Scale...", "distance=3095.975 known=1 pixel=1 unit=mm global");
</source>
:Replace the value 3095.975 in code line 32 with your microscope spatial scale.

=== Image Acquisition ===
This macro was designed for images acquired with fluorescence microscopes using a 20x/0.8 air objective. 
We considered this magnification the most suitable to assess a reasonably large area without missing out on details in cell morphology. 
=== Image Processing ===
We suggest to perform consistent post-processing for all images. Regarding the blue channel, avoid saturating pixels, as this will interfere with nuclei identification. As for the green channel, reduce background as much as possible and increase exposure without saturating fragments.

=== Validated Dataset ===
The original ONL and INL image datasets used for validation purposes are available to download. These images have been accurately segmented and quantitated, and their values were validated by observers. {{Notice |''' We strongly recommend to download and revise these images beforehand, to have a rough estimate on acquisition and post-processing parameters.'''}}

=== Datasets Links ===
:*[https://www.dropbox.com/sh/yq7d6pac61niav9/AABw9L29qWfDAYH5K2SAaVUma?dl=0 ONL Dataset] 
:*[https://www.dropbox.com/sh/lu6qojkte1z41pf/AABJHv2uptUaWfx-mGUmn1nJa?dl=0 INL Dataset]

== Download & Install ==
=== TUNEL Cell Counter Setup ===
#Download the macro from the GitHub link.<br>
#Go to ''Plugins > Macros > Install'' and select the downloaded '''.ijm''' file.

== TUNEL Cell Counter ==
[[File:Stack - Macro.gif|250px|thumb|Representative animation of Macro Mode. Processing time is ~14 seconds/image.]]
[[File:Stack - Batch.gif|250px|thumb|Representative animation of Batch Mode. Processing time is ~2.7 seconds/image.]]
=== Segmentation ===
The following processes are executed by the macro:
*'''ONL Segmentation'''
#Blue channel extracted from the RGB native image.
#Gaussian blur filter to reduce noise and detail.
#Contrast enhancement.
#Tsai moment-preserving thresholding. 
#Erosion iteration to achieve a fitted segmentation.
#Outlier pixels removed to a specific radius.
#Fill holes function to consolidate a solid area.
#Analyze particles function to measure the ONL area.

*'''INL Segmentation'''
#ONL ROI subtracted from the Gaussian filtered blue channel.
#Tsai moment-preserving thresholding. 
#Erosion iterations to achieve a fitted segmentation.
#Outlier pixels removed to a specific radius.
#Fill holes function used to consolidate a solid area.
#Analyze particles function to measure the ONL area.

=== Total Cells Quantitation ===
:Find Maxima function to detect nuclei located in the ONL and INL ROIs.

=== TUNEL Cells Quantitation ===
#Green channel extracted from the RGB native image.
#Tsai moment-preserving thresholding.
#Watershed function to separate contiguous cells.
#Analyze particles function to count cells.
=== Macro Mode vs. Batch Mode ===
TUNEL Cell Counter can be executed either as a macro or as batch process, with the same results. We suggest Batch Mode processing for faster results. <br>

To execute in Macro Mode:
#Open an image or ''drag-and-drop'' to the application window. 
#Go to ''Process > Macro > TUNEL Cell Counter. 
#After processing, select "Results" window and go to ''File > Save as'', and save results as '''.csv''' file.

To execute in Batch Mode:
#Inspect the macro source code from the GitHub link.<br>
#Copy the whole code to the clipboard.
#Go to ''Process > Batch > Macro'' and paste the content in the macro box.
#Correct microscope spatial scale in line 32 of the code, if necessary.
#Select ''Input'' as the folder were original images are located.
#Select ''Output'' as the folder were processed images will be saved.
#Choose JPEG as "Output Format" (recommended).
#Click on "Process".
#After processing, select "Summary" window and go to ''File > Save as'', and save summary as '''.csv''' file.

== Macro Output ==
=== Qualitative ===
[[File:Montage.jpg|right|250px|thumb|Example of an original TUNEL assay image (top) after macro processing (bottom).]]
:A JPEG image is created to visualize ONL and INL segmentation and TUNEL<sup>+</sup> cell count, as an overlay.
=== Quantitative ===
When executed as a macro, the output variables are:
:'''Outer Nuclear Layer'''
:*ONL Area (mm<sup>2</sup>)
:*ONL Total Cells (count)
:*ONL TUNEL<sup>+</sup> Cells (count)
:*Ratio TUNEL<sup>+</sup> Cells/ONL Area (count/mm<sup>2</sup>)
:*Percentage TUNEL<sup>+</sup> Cells/ONL Total Cells (%)<br>

:'''Inner Nuclear Layer'''
:*INL Area (mm<sup>2</sup>)
:*INL Total Cells (count)
:*INL TUNEL<sup>+</sup> Cells (count)
:*Ratio TUNEL<sup>+</sup> Cells/INL Area (count/mm<sup>2</sup>)
:*Percentage TUNEL<sup>+</sup> Cells/INL Total Cells (%)<br>
[[File:Bar.png|right|250px|thumb|A new window is generated with the output variables.]]
When executed as Batch Mode, ONL and INL Area, and ONL and INL TUNEL<sup>+</sup> cells are reported.
Ratio of TUNEL<sup>+</sup> Cells can be calculated by any spreadsheet or statistics package.

== Limitations == 
#Acquisition: The macro was designed for images acquired with a 20x/0.8 air objective. Images with higher or lower magnification will not be successfully segmented. We considered this magnification was the most suitable to assess a reasonably large area without missing out cell morphology details.
#TUNEL staining quality: Images need to have an intense cell staining and low background noise.
#Image Focus: Uneven image focus will render incomplete layer segmentation.
# Indistinguishable Retinal Layers: The macro cannot distinguish between the ONL and INL if you can't!
#Uncentered Image: For best results, try to acquire images centered in frame.
# Significant Shadowing: Shadowing will render incomplete layer segmentation.

== FAQs ==
# Q: Can I modify the source code?
#*A: ''Yes. You can modify the code to develop new macros or plugins. Please acknowledge previous work that helped or inspired you, and share your contribution with the scientific community!''<br>
# Q: I used this tool for my research. How should I acknowledge it?
#*A: ''Please cite or reference this work as follows: Maidana DE, Tsoka P, Tian B, Dib B, Matsumoto H, Kataoka K, Lin H, Miller JW, Vavvas DG (2015) A Novel ImageJ Macro for Automated Cell Death Quantitation in the Retina. Currently under revision.'' <br>
# Q: I cannot get accurate segmentation or counting. Any advice?
#*A: ''Check your acquisition and post-processing parameters. Try to keep background at minimum, and avoid saturating pixels especially in the green channel. This will balance any large fragment or noise signal to a real cell. Finally, as a rule of thumb, best performances are obtained with less saturated images.'' <br>

== Future Development ==
Yes, we know there is a lot to improve! <br> 
We are currently working on the following issues:
*Image acquisition: We are working on images obtained with a 10x objective magnification.
*Variables in Batch Processing mode: We are trying to report the complete variable list. 

== Version History ==

:v1.1: In progress.
:v1.0: First and validated working version.

== External Links ==
http://www.masseyeandear.org
== References ==
#Maidana DE, Tsoka P, Tian B, Dib B, Matsumoto H, Kataoka K, Lin H, Miller JW, Vavvas DG (2015) A Novel ImageJ Macro for Automated Cell Death Quantitation in the Retina. Currently under revision.''

[[Category:Development]]
[[Category:Plugins]]
