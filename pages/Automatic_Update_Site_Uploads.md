---
autogenerated: true
title: Automatic Update Site Uploads
breadcrumb: Automatic Update Site Uploads
layout: page
author: test author
categories: 
description: test description
---

# Requirements

  - An open-source project hosted on [GitHub](GitHub "wikilink")
  - Logging in to [Travis CI](https://travis-ci.org/auth) with your
    corresponding GitHub account
  - [Travis command line
    tools](https://github.com/travis-ci/travis.rb#installation)
  - An [account on this wiki](Special:CreateAccount "wikilink")
  - An [initialized upload
    password](Special:ChangeUploadPassword "wikilink"). (**NOTE** -
    *not* necessarily the same as your Wiki password)

# Additional resources

  - [Travis CI user
    guide](https://docs.travis-ci.com/user/getting-started/)

# Automatic Uploads via Travis CI

Travis CI can be used to automatically build a repository in response to
code changes. To ease the maintenance of ImageJ update sites, we can use
Travis to automatically upload the latest version of a site. This is
done by creating a `.travis.yml` file in your update site's GitHub
repository that does the following:

1.  Create a fresh ImageJ.app
2.  Build the update site's repository and move the required artifacts
    (e.g. `.jars`) to their intended locations in the ImageJ.app
3.  Upload the local update site state to your Wiki update site

As a starting point you can copy the following `.travis.yml` :

``` yaml
language: java
sudo: false

cache:
  directories:
    - $HOME/.m2/

install:
  - mvn package

script:
  - ./.travis-deploy.sh

branches:
  only:
    - master
```

and this script `.travis-deploy.sh` :

``` bash
#!/usr/bin/env sh
set -e

# Define some variables
export USER="Username"
export UPDATE_SITE="Update_Site"

export IJ_PATH="$HOME/Fiji.app"
export URL="http://sites.imagej.net/$UPDATE_SITE/"
export IJ_LAUNCHER="$IJ_PATH/ImageJ-linux64"
export PATH="$IJ_PATH:$PATH"

# Install ImageJ
mkdir -p $IJ_PATH/
cd $HOME/
wget --no-check-certificate https://downloads.imagej.net/fiji/latest/fiji-linux64.zip
unzip fiji-linux64.zip

# Install the package
cd $TRAVIS_BUILD_DIR/
mvn clean install -Dscijava.app.directory=$IJ_PATH -Ddelete.other.versions=true

# Deploy the package
# Deploy the package
$IJ_LAUNCHER --update edit-update-site $UPDATE_SITE $URL "webdav:$USER:$WIKI_UPLOAD_PASS" .
$IJ_LAUNCHER --update update
$IJ_LAUNCHER --update upload --update-site $UPDATE_SITE --force-shadow jars/YOUR-FILE.jar
```

Don't forget to replace

    export USER="Username"
    export UPDATE_SITE="Update_Site"

by your informations.

## Encrypting your password

To upload to your wiki update site, you will need to provide Travis CI
with a `WIKI_UPLOAD_PASS` environment variable, which should evaluate to
the [upload password](Special:ChangeUploadPassword "wikilink") of the
Wiki account performing the upload. To do so securely, follow the
instructions on the [encrypting environment
variables](https://docs.travis-ci.com/user/environment-variables/#Encrypting-Variables-Using-a-Public-Key).

Note that when you run:

``` bash
$ travis encrypt WIKI_UPLOAD_PASS=super_secret --add env.matrix
```

in your repository, the `.travis.yml` will automatically be updated
appropriately. You can simply commit and push the changes.

## Non-Mavenized Files

Travis CI is capable of building many languages besides Java. If you
cannot use Maven with a `scijava.app.directory` then you need to replace
the following line of your `.travis.yml`:

``` yaml
  - mvn clean install -Dscijava.app.directory="$(pwd)" -Ddelete.other.versions=true
```

with a sequence of commands that will move your build artifacts to the
appropriate `/jars` or `/plugins` directory, as appropriate for your
update site.

This is also true if you have custom scripts, macros, etc... if these
files are not present in the correct locations of the local ImageJ.app,
they will appear to have been deleted.

# Caveats

# See Also

  - [Travis use](Travis "wikilink")
# Requirements

  - An open-source project hosted on [GitHub](GitHub "wikilink")
  - Logging in to [Travis CI](https://travis-ci.org/auth) with your
    corresponding GitHub account
  - [Travis command line
    tools](https://github.com/travis-ci/travis.rb#installation)
  - An [account on this wiki](Special:CreateAccount "wikilink")
  - An [initialized upload
    password](Special:ChangeUploadPassword "wikilink"). (**NOTE** -
    *not* necessarily the same as your Wiki password)

# Additional resources

  - [Travis CI user
    guide](https://docs.travis-ci.com/user/getting-started/)

# Automatic Uploads via Travis CI

Travis CI can be used to automatically build a repository in response to
code changes. To ease the maintenance of ImageJ update sites, we can use
Travis to automatically upload the latest version of a site. This is
done by creating a `.travis.yml` file in your update site's GitHub
repository that does the following:

1.  Create a fresh ImageJ.app
2.  Build the update site's repository and move the required artifacts
    (e.g. `.jars`) to their intended locations in the ImageJ.app
3.  Upload the local update site state to your Wiki update site

As a starting point you can copy the following `.travis.yml` :

``` yaml
language: java
sudo: false

cache:
  directories:
    - $HOME/.m2/

install:
  - mvn package

script:
  - ./.travis-deploy.sh

branches:
  only:
    - master
```

and this script `.travis-deploy.sh` :

``` bash
#!/usr/bin/env sh
set -e

# Define some variables
export USER="Username"
export UPDATE_SITE="Update_Site"

export IJ_PATH="$HOME/Fiji.app"
export URL="http://sites.imagej.net/$UPDATE_SITE/"
export IJ_LAUNCHER="$IJ_PATH/ImageJ-linux64"
export PATH="$IJ_PATH:$PATH"

# Install ImageJ
mkdir -p $IJ_PATH/
cd $HOME/
wget --no-check-certificate https://downloads.imagej.net/fiji/latest/fiji-linux64.zip
unzip fiji-linux64.zip

# Install the package
cd $TRAVIS_BUILD_DIR/
mvn clean install -Dscijava.app.directory=$IJ_PATH -Ddelete.other.versions=true

# Deploy the package
# Deploy the package
$IJ_LAUNCHER --update edit-update-site $UPDATE_SITE $URL "webdav:$USER:$WIKI_UPLOAD_PASS" .
$IJ_LAUNCHER --update update
$IJ_LAUNCHER --update upload --update-site $UPDATE_SITE --force-shadow jars/YOUR-FILE.jar
```

Don't forget to replace

    export USER="Username"
    export UPDATE_SITE="Update_Site"

by your informations.

## Encrypting your password

To upload to your wiki update site, you will need to provide Travis CI
with a `WIKI_UPLOAD_PASS` environment variable, which should evaluate to
the [upload password](Special:ChangeUploadPassword "wikilink") of the
Wiki account performing the upload. To do so securely, follow the
instructions on the [encrypting environment
variables](https://docs.travis-ci.com/user/environment-variables/#Encrypting-Variables-Using-a-Public-Key).

Note that when you run:

``` bash
$ travis encrypt WIKI_UPLOAD_PASS=super_secret --add env.matrix
```

in your repository, the `.travis.yml` will automatically be updated
appropriately. You can simply commit and push the changes.

## Non-Mavenized Files

Travis CI is capable of building many languages besides Java. If you
cannot use Maven with a `scijava.app.directory` then you need to replace
the following line of your `.travis.yml`:

``` yaml
  - mvn clean install -Dscijava.app.directory="$(pwd)" -Ddelete.other.versions=true
```

with a sequence of commands that will move your build artifacts to the
appropriate `/jars` or `/plugins` directory, as appropriate for your
update site.

This is also true if you have custom scripts, macros, etc... if these
files are not present in the correct locations of the local ImageJ.app,
they will appear to have been deleted.

# Caveats

# See Also

  - [Travis use](Travis "wikilink")
